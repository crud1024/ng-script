class DropdownMenu{constructor(container,options={}){if(this.options=this.mergeOptions(options),"string"==typeof container){if(this.container=document.querySelector(container),!this.container)return void console.error(`未找到ID为"${container}"的元素`)}else{if(!(container instanceof HTMLElement))return void console.error("container参数必须是元素ID或DOM元素");this.container=container}this.isOpen=!1,this.eventLog=[],this.svgIcons=this.createSvgIconLibrary(),this.init()}mergeOptions(userOptions){return{triggerStyle:"button-style",showIcons:!0,showGroups:!0,menuItems:[],onMainButtonClick:null,position:"bottom-left",zIndex:1e3,animation:!0,closeOnClickOutside:!0,closeOnItemClick:!0,...userOptions}}createSvgIconLibrary(){return{edit:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>',delete:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>',copy:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>',share:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/></svg>',download:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>',user:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>',settings:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19.14 12.94c.04-.3.06-.61.06-.94s-.02-.64-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.71 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.3-.06.61-.06.94s.02.64.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>',help:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg>',plus:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>',file:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>',folder:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/></svg>',link:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>',envelope:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>',cog:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19.14 12.94c.04-.3.06-.61.06-.94s-.02-.64-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.71 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.3-.06.61-.06.94s.02.64.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>',sliders:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 10c0 .55.45 1 1 1h14c.55 0 1-.45 1-1s-.45-1-1-1H5c-.55 0-1 .45-1 1zm10.5.5h5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5h-5c-.28 0-.5.22-.5.5s.22.5.5.5zm-7 0H5c-.28 0-.5.22-.5.5s.22.5.5.5h2.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5zm8.5 0h3c.28 0 .5-.22.5-.5s-.22-.5-.5-.5h-3c-.28 0-.5.22-.5.5s.22.5.5.5zM6 15h12c.55 0 1-.45 1-1s-.45-1-1-1H6c-.55 0-1 .45-1 1s.45 1 1 1zm2.5-1.5h-3c-.28 0-.5.22-.5.5s.22.5.5.5h3c.28 0 .5-.22.5-.5s-.22-.5-.5-.5zm8.5 0h3c.28 0 .5-.22.5-.5s-.22-.5-.5-.5h-3c-.28 0-.5.22-.5.5s.22.5.5.5z"/></svg>',chevronDown:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/></svg>',chevronRight:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>'}}init(){this.container.innerHTML="";const wrapper=document.createElement("div");wrapper.className="dropdown-wrapper",this.container.appendChild(wrapper),this.wrapper=wrapper,this.renderTrigger(),this.renderMenu(),this.bindEvents(),this.addStyles()}renderTrigger(){const{triggerStyle:triggerStyle}=this.options;let triggerHtml="";triggerHtml="split-button"===triggerStyle?`\n                    <div class="dropdown-trigger ${triggerStyle}">\n                        <span class="split-button-main">操作</span>\n                        <div class="split-button-divider-wrapper">\n                            <div class="split-button-divider"></div>\n                        </div>\n                        <span class="split-button-dropdown">\n                            <span class="dropdown-icon">${this.svgIcons.chevronDown}</span>\n                        </span>\n                    </div>\n                `:`\n                    <div class="dropdown-trigger ${triggerStyle}">\n                        <span>下拉菜单</span>\n                        <span class="dropdown-icon">${this.svgIcons.chevronDown}</span>\n                    </div>\n                `,this.wrapper.innerHTML=triggerHtml,this.trigger=this.wrapper.querySelector(".dropdown-trigger"),"split-button"===triggerStyle&&(this.mainButton=this.wrapper.querySelector(".split-button-main"),this.dropdownButton=this.wrapper.querySelector(".split-button-dropdown"))}renderMenu(){const menu=document.createElement("div");menu.className="dropdown-menu",menu.setAttribute("data-position",this.options.position),menu.innerHTML=this.buildMenuHTML(this.options.menuItems),this.wrapper.appendChild(menu),this.menu=menu,this.menu.style.zIndex=this.options.zIndex}buildMenuHTML(menuItems,isSubmenu=!1){let html="",currentGroup=null;return menuItems.forEach((item,index)=>{if(item.group&&item.group!==currentGroup&&this.options.showGroups?(null!==currentGroup&&(html+='<div class="dropdown-item divider"></div>'),html+=`<div class="dropdown-item group-title">${item.group}</div>`,currentGroup=item.group):item.group||null===currentGroup||(currentGroup=null),"divider"===item.type)html+='<div class="dropdown-item divider"></div>';else{const hasSubmenu=item.children&&item.children.length>0,disabledClass=item.disabled?"disabled":"";html+=`\n                        <div class="dropdown-item ${disabledClass} ${hasSubmenu?"has-submenu":""}" \n                             data-index="${index}"\n                             ${item.id?`data-id="${item.id}"`:""}>\n                            ${this.options.showIcons&&item.icon?this.getIconHTML(item.icon):""}\n                            <span>${item.text}</span>\n                            ${hasSubmenu?this.buildSubmenuHTML(item.children,index):""}\n                        </div>\n                    `}}),html}buildSubmenuHTML(children,parentIndex){return`\n                <div class="submenu">\n                    ${this.buildMenuHTML(children,!0)}\n                </div>\n            `}getIconHTML(iconConfig){return"string"==typeof iconConfig?this.svgIcons[iconConfig]?`<div class="dropdown-icon">${this.svgIcons[iconConfig]}</div>`:`<i class="${iconConfig}"></i>`:iconConfig.svg?`<div class="dropdown-icon">${iconConfig.svg}</div>`:""}bindEvents(){const{triggerStyle:triggerStyle,closeOnClickOutside:closeOnClickOutside}=this.options;"split-button"===triggerStyle?(this.mainButton&&this.mainButton.addEventListener("click",e=>{e.stopPropagation(),this.handleMainButtonClick()}),this.dropdownButton&&this.dropdownButton.addEventListener("click",e=>{e.stopPropagation(),this.toggleMenu()})):this.trigger.addEventListener("click",e=>{e.stopPropagation(),this.toggleMenu()}),this.menu.addEventListener("click",e=>{const menuItem=e.target.closest(".dropdown-item:not(.disabled):not(.divider):not(.group-title)");if(!menuItem)return;e.stopPropagation();const index=menuItem.dataset.index,id=menuItem.dataset.id,menuItemConfig=this.findMenuItem(this.options.menuItems,index);if(menuItemConfig){if(menuItemConfig.children&&menuItemConfig.children.length>0)return;this.handleItemClick(menuItemConfig,id)}this.options.closeOnItemClick&&this.closeMenu()}),closeOnClickOutside&&document.addEventListener("click",()=>{this.closeMenu()}),this.menu.addEventListener("mouseenter",e=>{e.target.classList.contains("dropdown-item")&&(this.menu.querySelectorAll(".dropdown-item").forEach(item=>{item!==e.target&&item.classList.remove("active")}),e.target.classList.add("active"))}),window.addEventListener("resize",()=>this.adjustMenuPosition()),window.addEventListener("scroll",()=>this.adjustMenuPosition(),!0)}handleMainButtonClick(){const event=new CustomEvent("main-button-click",{bubbles:!0,detail:{source:"main-button"}});this.container.dispatchEvent(event),this.options.onMainButtonClick&&"function"==typeof this.options.onMainButtonClick&&this.options.onMainButtonClick()}findMenuItem(menuItems,index){let currentIndex=0;for(const item of menuItems)if("divider"!==item.type){if(currentIndex==index)return item;if(currentIndex++,item.children&&item.children.length>0){const found=this.findMenuItem(item.children,index);if(found)return found}}return null}handleItemClick(item,id){const eventDetail={item:item,id:id,text:item.text,timestamp:(new Date).toLocaleTimeString()},event=new CustomEvent("menu-item-click",{detail:eventDetail,bubbles:!0});this.container.dispatchEvent(event),item.onClick&&"function"==typeof item.onClick&&item.onClick(item)}adjustMenuPosition(){if(!this.menu||!this.menu.classList.contains("show"))return;const menuRect=this.menu.getBoundingClientRect(),triggerRect=this.trigger.getBoundingClientRect(),viewportHeight=window.innerHeight,viewportWidth=window.innerWidth;let top=triggerRect.bottom+5,left=triggerRect.left;menuRect.height+triggerRect.bottom>viewportHeight-20&&triggerRect.top>menuRect.height+20&&(top=triggerRect.top-menuRect.height-5),menuRect.width+triggerRect.left>viewportWidth-20&&(left=Math.max(10,viewportWidth-menuRect.width-20)),this.menu.style.top=`${top}px`,this.menu.style.left=`${left}px`,this.menu.style.position="fixed"}toggleMenu(){this.isOpen?this.closeMenu():this.openMenu()}openMenu(){this.menu.classList.add("show"),"text-only"!==this.options.triggerStyle&&this.trigger.classList.add("active"),this.isOpen=!0,setTimeout(()=>{this.adjustMenuPosition()},10)}closeMenu(){this.menu.classList.remove("show"),this.trigger.classList.remove("active"),this.menu.querySelectorAll(".dropdown-item.active").forEach(item=>{item.classList.remove("active")}),this.isOpen=!1}updateOptions(newOptions){this.options={...this.options,...newOptions},this.init()}setMenuItems(menuItems){this.options.menuItems=menuItems,this.menu&&(this.menu.innerHTML=this.buildMenuHTML(menuItems))}addStyles(){if(document.getElementById("dropdown-menu-styles"))return;const style=document.createElement("style");style.id="dropdown-menu-styles",style.textContent="\n                .dropdown-wrapper {\n                    position: relative;\n                    display: inline-block;\n                }\n                \n                .dropdown-trigger {\n                    display: inline-flex;\n                    align-items: center;\n                    justify-content: center;\n                    gap: 8px;\n                    background-color: #fff;\n                    border: 1px solid #d9d9d9;\n                    border-radius: 4px;\n                    padding: 8px 15px;\n                    font-size: 14px;\n                    color: #262626;\n                    cursor: pointer;\n                    transition: all 0.3s;\n                    user-select: none;\n                    height: 32px;\n                    line-height: 1;\n                }\n                \n                .dropdown-trigger:hover {\n                    border-color: #1890ff;\n                    color: #1890ff;\n                }\n                \n                .dropdown-trigger:active,\n                .dropdown-trigger.active {\n                    border-color: #1890ff;\n                    box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);\n                }\n                \n                .dropdown-trigger.text-only {\n                    border: none;\n                    padding: 8px 5px;\n                    color: #1890ff;\n                    background-color: transparent;\n                    height: auto;\n                }\n                \n                .dropdown-trigger.text-only:active,\n                .dropdown-trigger.text-only.active {\n                    border: none;\n                    box-shadow: none;\n                    background-color: transparent;\n                }\n                \n                .dropdown-trigger.button-style {\n                    background-color: #1890ff;\n                    color: white;\n                    border-color: #1890ff;\n                }\n                \n                .dropdown-trigger.button-style:hover {\n                    background-color: #40a9ff;\n                    border-color: #40a9ff;\n                }\n                \n                .dropdown-trigger.split-button {\n                    padding: 0;\n                    overflow: hidden;\n                    display: inline-flex;\n                    align-items: stretch;\n                    height: 32px;\n                    gap: 0;\n                }\n                \n                .split-button-main {\n                    padding: 0 15px;\n                    background-color: #1890ff;\n                    color: white;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    font-size: 14px;\n                    transition: all 0.3s;\n                    min-width: 70px;\n                }\n                \n                .split-button-main:hover {\n                    background-color: #40a9ff;\n                }\n                \n                /* 分割线容器 */\n.split-button-divider-wrapper {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 1px;\n    position: relative;\n    overflow: hidden;\n}\n\n/* 上蓝白蓝线条100%：上蓝20%，白60%，下蓝20% */\n.split-button-divider {\n    width: 100%;\n    height: 100%;\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    background-color: #1890ff;\n    overflow: hidden;\n}\n\n/* 上蓝部分（20%） */\n.split-button-divider::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 20%;\n    background-color: #1890ff;\n}\n\n/* 中间白部分（60%） */\n.split-button-divider::after {\n    content: '';\n    position: absolute;\n    top: 20%;\n    left: 0;\n    width: 100%;\n    height: 60%;\n    background-color: rgba(255, 255, 255, 0.3);\n}\n\n/* 下蓝部分（20%） */\n.split-button-divider span {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    height: 20%;\n    background-color: #1890ff;\n}\n                \n                .split-button-main,\n                .split-button-dropdown {\n                    margin: 0;\n                    flex-shrink: 0;\n                }\n                \n                .split-button-dropdown {\n                    padding: 0 10px;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    background-color: #1890ff;\n                    color: white;\n                    transition: all 0.3s;\n                    min-width: 32px;\n                }\n                \n                .split-button-dropdown:hover {\n                    background-color: #40a9ff;\n                }\n                \n                .dropdown-icon {\n                    width: 16px;\n                    height: 16px;\n                    display: inline-flex;\n                    align-items: center;\n                    justify-content: center;\n                    flex-shrink: 0;\n                }\n                \n                .dropdown-icon svg {\n                    width: 100%;\n                    height: 100%;\n                    fill: currentColor;\n                }\n                \n                .dropdown-trigger.split-button.active .dropdown-icon svg {\n                    transform: rotate(180deg);\n                    transition: transform 0.3s;\n                }\n                \n                .dropdown-menu {\n                    position: absolute;\n                    top: 100%;\n                    left: 0;\n                    min-width: 180px;\n                    background-color: white;\n                    border-radius: 4px;\n                    box-shadow: 0 3px 6px -4px rgba(0, 0, 0, 0.12),\n                                0 6px 16px 0 rgba(0, 0, 0, 0.08),\n                                0 9px 28px 8px rgba(0, 0, 0, 0.05);\n                    opacity: 0;\n                    visibility: hidden;\n                    transform: translateY(-10px);\n                    transition: all 0.3s;\n                    padding: 8px 0;\n                    margin-top: 5px;\n                }\n                \n                .dropdown-menu.show {\n                    opacity: 1;\n                    visibility: visible;\n                    transform: translateY(0);\n                }\n                \n                .dropdown-item {\n                    padding: 8px 16px;\n                    cursor: pointer;\n                    display: flex;\n                    align-items: center;\n                    gap: 10px;\n                    color: #262626;\n                    font-size: 14px;\n                    transition: all 0.3s;\n                    position: relative;\n                    min-height: 32px;\n                }\n                \n                .dropdown-item:hover {\n                    background-color: #f5f5f5;\n                }\n                \n                .dropdown-item.has-submenu::after {\n                    content: \">\";\n                    position: absolute;\n                    right: 12px;\n                    font-size: 12px;\n                    color: #999;\n                }\n                \n                .dropdown-item.disabled {\n                    color: #bfbfbf;\n                    cursor: not-allowed;\n                }\n                \n                .dropdown-item.disabled:hover {\n                    background-color: transparent;\n                }\n                \n                /* 优化分隔线高度 - 减少高度占用 */\n                .dropdown-item.divider {\n                    border-bottom: 1px solid #e8e8e8;\n                    margin: 4px 0;\n                    padding: 0;\n                    height: 1px;\n                    min-height: 1px;\n                    cursor: default;\n                }\n                \n                .dropdown-item.divider:hover {\n                    background-color: transparent;\n                }\n                \n                .dropdown-item.group-title {\n                    color: #8c8c8c;\n                    font-size: 12px;\n                    padding: 5px 16px;\n                    cursor: default;\n                    min-height: 24px;\n                    line-height: 1.2;\n                }\n                \n                .dropdown-item.group-title:hover {\n                    background-color: transparent;\n                }\n                \n                .submenu {\n                    position: absolute;\n                    top: -8px;\n                    left: 100%;\n                    min-width: 180px;\n                    background-color: white;\n                    border-radius: 4px;\n                    box-shadow: 0 3px 6px -4px rgba(0, 0, 0, 0.12),\n                                0 6px 16px 0 rgba(0, 0, 0, 0.08),\n                                0 9px 28px 8px rgba(0, 0, 0, 0.05);\n                    opacity: 0;\n                    visibility: hidden;\n                    transform: translateX(-10px);\n                    transition: all 0.3s;\n                    padding: 8px 0;\n                }\n                \n                .dropdown-item:hover > .submenu {\n                    opacity: 1;\n                    visibility: visible;\n                    transform: translateX(5px);\n                }\n            ",document.head.appendChild(style)}destroy(){document.removeEventListener("click",()=>this.closeMenu()),window.removeEventListener("resize",()=>this.adjustMenuPosition()),window.removeEventListener("scroll",()=>this.adjustMenuPosition(),!0),this.container&&this.wrapper&&this.container.removeChild(this.wrapper)}}"undefined"!=typeof module&&module.exports?module.exports=DropdownMenu:"function"==typeof define&&define.amd?define([],function(){return DropdownMenu}):window.DropdownMenu=DropdownMenu;class FullConfigNGCarousel{static styleInjected=!1;constructor(selector,options={}){this.container="string"==typeof selector?document.querySelector(selector):selector,this.container?(this.config={items:options.items||[],autoplay:!1!==options.autoplay,interval:options.interval||3e3,dotPosition:options.dotPosition||"bottom",dotStyle:options.dotStyle||"circle",lineDotWidth:options.lineDotWidth||24,lineDotHeight:options.lineDotHeight||4,showArrows:!1!==options.showArrows,showDots:!1!==options.showDots,showIndicator:!1!==options.showIndicator,arrowBackground:!1!==options.arrowBackground,arrowStyle:options.arrowStyle||"solid",effect:options.effect||"fade",speed:options.speed||500,infinite:!1!==options.infinite,draggable:!1!==options.draggable,pauseOnHover:!1!==options.pauseOnHover,progressDots:!1!==options.progressDots,colors:{dotColor:options.colors?.dotColor||"rgba(255, 255, 255, 0.5)",dotActiveColor:options.colors?.dotActiveColor||"#1890ff",dotHoverColor:options.colors?.dotHoverColor||"rgba(255, 255, 255, 0.7)",progressColor:options.colors?.progressColor||"#1890ff",arrowColor:options.colors?.arrowColor||"#ffffff",arrowHoverColor:options.colors?.arrowHoverColor||"#40a9ff",arrowBackgroundColor:options.colors?.arrowBackgroundColor||"rgba(0, 0, 0, 0.5)",arrowHoverBackgroundColor:options.colors?.arrowHoverBackgroundColor||"rgba(0, 0, 0, 0.8)",arrowBorderColor:options.colors?.arrowBorderColor||"rgba(255, 255, 255, 0.8)",arrowHoverBorderColor:options.colors?.arrowHoverBorderColor||"#ffffff",indicatorBackground:options.colors?.indicatorBackground||"rgba(0, 0, 0, 0.5)",indicatorColor:options.colors?.indicatorColor||"#ffffff",themePrimary:options.colors?.themePrimary||"#1890ff",themeSecondary:options.colors?.themeSecondary||"#40a9ff"}},this.currentIndex=0,this.totalItems=this.config.items.length,this.isAnimating=!1,this.timer=null,this.progressTimer=null,this.dragStartX=0,this.dragEndX=0,this.isDragging=!1,this.startTime=0,this.instanceId="ng-carousel-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),this.injectStyles(),this.init()):console.error("FullConfigNGCarousel: 未找到目标元素")}injectStyles(){if(!FullConfigNGCarousel.styleInjected){const globalStyle=document.createElement("style");globalStyle.textContent=this.getGlobalStyles(),document.head.appendChild(globalStyle),FullConfigNGCarousel.styleInjected=!0}this.injectInstanceStyles()}getGlobalStyles(){return"\n            /* 基础样式 */\n            .ng-carousel {\n                position: relative;\n                width: 100%;\n                overflow: hidden;\n                user-select: none;\n            }\n\n            .ng-carousel-slides {\n                position: relative;\n                width: 100%;\n                height: 100%;\n            }\n\n            .ng-carousel-slide {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                opacity: 0;\n                transition: opacity 0.5s ease-in-out;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .ng-carousel-slide.ng-carousel-slide-active {\n                opacity: 1;\n            }\n\n            /* 箭头样式 - 基础 */\n            .ng-carousel-arrow {\n                position: absolute;\n                top: 50%;\n                transform: translateY(-50%);\n                width: 40px;\n                height: 40px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                cursor: pointer;\n                z-index: 10;\n                transition: all 0.3s ease;\n                user-select: none;\n                font-size: 20px;\n            }\n\n            /* 箭头样式 - 实心背景 */\n            .ng-carousel-arrow.ng-arrow-solid {\n                border-radius: 50%;\n            }\n\n            /* 箭头样式 - 轮廓 */\n            .ng-carousel-arrow.ng-arrow-outline {\n                background: transparent;\n                border: 2px solid;\n                border-radius: 50%;\n            }\n\n            /* 箭头样式 - 简约 */\n            .ng-carousel-arrow.ng-arrow-minimal {\n                background: transparent;\n                width: 60px;\n                height: 60px;\n                font-size: 24px;\n            }\n\n            .ng-carousel-arrow-prev {\n                left: 20px;\n            }\n\n            .ng-carousel-arrow-next {\n                right: 20px;\n            }\n\n            /* 无背景箭头 */\n            .ng-carousel-arrow.ng-arrow-no-bg {\n                background: transparent !important;\n                font-size: 32px;\n                text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\n            }\n\n            /* 指示点容器 */\n            .ng-carousel-dots {\n                position: absolute;\n                z-index: 10;\n                display: flex;\n                gap: 8px;\n                padding: 10px;\n            }\n\n            .ng-carousel-dots-bottom {\n                bottom: 0;\n                left: 50%;\n                transform: translateX(-50%);\n            }\n\n            .ng-carousel-dots-top {\n                top: 0;\n                left: 50%;\n                transform: translateX(-50%);\n            }\n\n            .ng-carousel-dots-left {\n                left: 20px;\n                top: 50%;\n                transform: translateY(-50%);\n                flex-direction: column;\n            }\n\n            .ng-carousel-dots-right {\n                right: 20px;\n                top: 50%;\n                transform: translateY(-50%);\n                flex-direction: column;\n            }\n\n            /* 圆形指示点样式 */\n            .ng-carousel-dot-circle {\n                width: 10px;\n                height: 10px;\n                border-radius: 50%;\n                cursor: pointer;\n                transition: all 0.3s ease;\n                position: relative;\n                overflow: hidden;\n            }\n\n            /* 条形指示点样式 */\n            .ng-carousel-dot-line {\n                width: 24px;\n                height: 4px;\n                border-radius: 2px;\n                cursor: pointer;\n                transition: all 0.3s ease;\n                position: relative;\n                overflow: hidden;\n            }\n\n            /* 指示点进度条 */\n            .ng-carousel-dot-progress {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 0%;\n                height: 100%;\n            }\n\n            /* 圆形指示点进度条 */\n            .ng-carousel-dot-circle .ng-carousel-dot-progress {\n                border-radius: 50%;\n            }\n\n            /* 条形指示点进度条 */\n            .ng-carousel-dot-line .ng-carousel-dot-progress {\n                border-radius: 2px;\n            }\n\n            .ng-carousel-slide-content {\n                width: 100%;\n                height: 100%;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                text-align: center;\n            }\n\n            .ng-carousel-indicator {\n                position: absolute;\n                bottom: 30px;\n                right: 30px;\n                padding: 4px 12px;\n                border-radius: 12px;\n                font-size: 14px;\n                z-index: 10;\n            }\n\n            /* 响应式 */\n            @media (max-width: 768px) {\n                .ng-carousel-arrow {\n                    width: 32px;\n                    height: 32px;\n                    font-size: 16px;\n                }\n\n                .ng-carousel-arrow.ng-arrow-minimal {\n                    width: 50px;\n                    height: 50px;\n                    font-size: 20px;\n                }\n\n                .ng-carousel-arrow.ng-arrow-no-bg {\n                    font-size: 24px;\n                }\n\n                .ng-carousel-arrow-prev {\n                    left: 10px;\n                }\n\n                .ng-carousel-arrow-next {\n                    right: 10px;\n                }\n\n                .ng-carousel-dot-line {\n                    width: 20px;\n                    height: 3px;\n                }\n            }\n        "}injectInstanceStyles(){const oldStyle=document.getElementById(this.instanceId+"-styles");oldStyle&&oldStyle.remove();const style=document.createElement("style");style.id=this.instanceId+"-styles",style.textContent=this.getInstanceStyles(),document.head.appendChild(style)}getInstanceStyles(){const colors=this.config.colors;return`\n            /* ${this.instanceId} 特定颜色样式 */\n            .${this.instanceId} .ng-carousel-arrow.ng-arrow-solid {\n                background: ${colors.arrowBackgroundColor};\n                color: ${colors.arrowColor};\n            }\n\n            .${this.instanceId} .ng-carousel-arrow.ng-arrow-solid:hover {\n                background: ${colors.arrowHoverBackgroundColor};\n                color: ${colors.arrowHoverColor};\n                transform: translateY(-50%) scale(1.1);\n            }\n\n            .${this.instanceId} .ng-carousel-arrow.ng-arrow-outline {\n                border-color: ${colors.arrowBorderColor};\n                color: ${colors.arrowColor};\n            }\n\n            .${this.instanceId} .ng-carousel-arrow.ng-arrow-outline:hover {\n                background: rgba(255, 255, 255, 0.1);\n                border-color: ${colors.arrowHoverBorderColor};\n                color: ${colors.arrowHoverColor};\n                transform: translateY(-50%) scale(1.1);\n            }\n\n            .${this.instanceId} .ng-carousel-arrow.ng-arrow-minimal {\n                color: ${colors.arrowColor};\n            }\n\n            .${this.instanceId} .ng-carousel-arrow.ng-arrow-minimal:hover {\n                color: ${colors.arrowHoverColor};\n                transform: translateY(-50%) scale(1.2);\n            }\n\n            .${this.instanceId} .ng-carousel-arrow.ng-arrow-no-bg {\n                color: ${colors.arrowColor};\n            }\n\n            .${this.instanceId} .ng-carousel-arrow.ng-arrow-no-bg:hover {\n                color: ${colors.arrowHoverColor};\n                transform: translateY(-50%) scale(1.2);\n            }\n\n            /* 指示点颜色 */\n            .${this.instanceId} .ng-carousel-dot-circle {\n                background: ${colors.dotColor};\n            }\n\n            .${this.instanceId} .ng-carousel-dot-circle:hover {\n                transform: scale(1.2);\n                background: ${colors.dotHoverColor};\n            }\n\n            .${this.instanceId} .ng-carousel-dot-circle.ng-carousel-dot-active {\n                background: ${colors.dotActiveColor};\n            }\n\n            .${this.instanceId} .ng-carousel-dot-line {\n                background: ${colors.dotColor};\n            }\n\n            .${this.instanceId} .ng-carousel-dot-line:hover {\n                background: ${colors.dotHoverColor};\n                transform: scale(1.1);\n            }\n\n            .${this.instanceId} .ng-carousel-dot-line.ng-carousel-dot-active {\n                background: ${colors.dotActiveColor};\n            }\n\n            /* 进度条颜色 */\n            .${this.instanceId} .ng-carousel-dot-progress {\n                background: ${colors.progressColor};\n            }\n\n            /* 指示器颜色 */\n            .${this.instanceId} .ng-carousel-indicator {\n                background: ${colors.indicatorBackground};\n                color: ${colors.indicatorColor};\n            }\n        `}init(){this.container.innerHTML="",this.container.classList.add("ng-carousel",this.instanceId),this.slidesContainer=document.createElement("div"),this.slidesContainer.className="ng-carousel-slides",this.slidesContainer.style.height="400px",this.container.appendChild(this.slidesContainer),this.createSlides(),this.config.showArrows&&this.totalItems>1&&this.createArrows(),this.config.showDots&&this.totalItems>1&&this.createDots(),this.config.showIndicator&&this.createIndicator(),this.config.draggable&&this.setupDraggable(),this.config.pauseOnHover&&this.setupHoverEvents(),this.config.autoplay&&this.totalItems>1&&this.startAutoplay()}createSlides(){this.items=this.config.items.map((item,index)=>{const slide=document.createElement("div");slide.className="ng-carousel-slide "+(0===index?"ng-carousel-slide-active":""),slide.dataset.index=index;const content=document.createElement("div");return content.className="ng-carousel-slide-content","string"==typeof item?content.innerHTML=item:item instanceof HTMLElement?content.appendChild(item.cloneNode(!0)):item.content?"string"==typeof item.content?content.innerHTML=item.content:item.content instanceof HTMLElement&&content.appendChild(item.content.cloneNode(!0)):content.innerHTML=`<div style="padding: 20px; font-size: 18px;">Slide ${index+1}</div>`,slide.appendChild(content),this.slidesContainer.appendChild(slide),slide})}createArrows(){const prevArrow=document.createElement("div");prevArrow.className="ng-carousel-arrow ng-carousel-arrow-prev",prevArrow.innerHTML="❮",this.config.arrowBackground?(prevArrow.classList.add(`ng-arrow-${this.config.arrowStyle}`),"minimal"===this.config.arrowStyle&&(prevArrow.style.width="60px",prevArrow.style.height="60px",prevArrow.style.fontSize="24px")):prevArrow.classList.add("ng-arrow-no-bg"),prevArrow.addEventListener("click",e=>{e.stopPropagation(),this.prev()});const nextArrow=document.createElement("div");nextArrow.className="ng-carousel-arrow ng-carousel-arrow-next",nextArrow.innerHTML="❯",this.config.arrowBackground?(nextArrow.classList.add(`ng-arrow-${this.config.arrowStyle}`),"minimal"===this.config.arrowStyle&&(nextArrow.style.width="60px",nextArrow.style.height="60px",nextArrow.style.fontSize="24px")):nextArrow.classList.add("ng-arrow-no-bg"),nextArrow.addEventListener("click",e=>{e.stopPropagation(),this.next()}),this.container.appendChild(prevArrow),this.container.appendChild(nextArrow),this.prevArrow=prevArrow,this.nextArrow=nextArrow}createDots(){this.dotsContainer=document.createElement("div"),this.dotsContainer.className=`ng-carousel-dots ng-carousel-dots-${this.config.dotPosition}`,this.dots=this.items.map((_,index)=>{const dot=document.createElement("div"),dotClass="line"===this.config.dotStyle?"ng-carousel-dot-line":"ng-carousel-dot-circle";if(dot.className=`${dotClass} ${0===index?"ng-carousel-dot-active":""}`,dot.dataset.index=index,"line"===this.config.dotStyle&&(dot.style.width=`${this.config.lineDotWidth}px`,dot.style.height=`${this.config.lineDotHeight}px`),this.config.progressDots){const progress=document.createElement("div");progress.className="ng-carousel-dot-progress",dot.appendChild(progress),dot.progressElement=progress}return dot.addEventListener("click",e=>{e.stopPropagation(),this.goTo(index)}),this.dotsContainer.appendChild(dot),dot}),this.container.appendChild(this.dotsContainer)}createIndicator(){this.indicator&&this.indicator.remove(),this.indicator=document.createElement("div"),this.indicator.className="ng-carousel-indicator",this.updateIndicator(),this.container.appendChild(this.indicator)}updateIndicator(){this.indicator&&this.config.showIndicator&&(this.indicator.textContent=`${this.currentIndex+1} / ${this.totalItems}`)}setupDraggable(){let startX=0,isDragging=!1;const handleDragStart=e=>{startX=e.type.includes("mouse")?e.clientX:e.touches[0].clientX,isDragging=!0,this.pauseAutoplay()},handleDragMove=e=>{if(!isDragging)return;const currentX=e.type.includes("mouse")?e.clientX:e.touches[0].clientX,diff=startX-currentX;Math.abs(diff)>50&&(diff>0?this.next():this.prev(),isDragging=!1)},handleDragEnd=()=>{isDragging=!1,this.config.autoplay&&this.startAutoplay()};this.container.addEventListener("mousedown",handleDragStart),this.container.addEventListener("mousemove",handleDragMove),this.container.addEventListener("mouseup",handleDragEnd),this.container.addEventListener("mouseleave",handleDragEnd),this.container.addEventListener("touchstart",handleDragStart),this.container.addEventListener("touchmove",handleDragMove),this.container.addEventListener("touchend",handleDragEnd)}setupHoverEvents(){this.container.addEventListener("mouseenter",()=>{this.pauseAutoplay()}),this.container.addEventListener("mouseleave",()=>{this.config.autoplay&&this.startAutoplay()})}goTo(index){if(this.isAnimating||index===this.currentIndex)return;this.isAnimating=!0,this.config.infinite?(index<0&&(index=this.totalItems-1),index>=this.totalItems&&(index=0)):index=Math.max(0,Math.min(index,this.totalItems-1));const oldIndex=this.currentIndex;this.currentIndex=index,this.items[oldIndex].classList.remove("ng-carousel-slide-active"),this.items[index].classList.add("ng-carousel-slide-active"),this.dots&&(this.dots[oldIndex].classList.remove("ng-carousel-dot-active"),this.dots[index].classList.add("ng-carousel-dot-active"),this.config.progressDots&&(this.resetProgress(),this.startProgress())),this.updateIndicator(),this.triggerEvent("slideChange",{previousIndex:oldIndex,currentIndex:index,total:this.totalItems}),setTimeout(()=>{this.isAnimating=!1},this.config.speed)}next(){const nextIndex=this.currentIndex+1;nextIndex>=this.totalItems&&!this.config.infinite||this.goTo(nextIndex)}prev(){const prevIndex=this.currentIndex-1;prevIndex<0&&!this.config.infinite||this.goTo(prevIndex)}startAutoplay(){this.pauseAutoplay(),this.config.autoplay&&this.totalItems>1&&(this.timer=setInterval(()=>{this.next()},this.config.interval),this.config.progressDots&&this.startProgress())}pauseAutoplay(){clearInterval(this.timer),clearInterval(this.progressTimer)}startProgress(){if(!this.dots||!this.config.progressDots)return;const currentDot=this.dots[this.currentIndex];currentDot&&currentDot.progressElement&&(currentDot.progressElement.style.transition=`width ${this.config.interval}ms linear`,currentDot.progressElement.style.width="100%")}resetProgress(){this.dots&&this.config.progressDots&&this.dots.forEach(dot=>{dot.progressElement&&(dot.progressElement.style.transition="none",dot.progressElement.style.width="0%",dot.progressElement.offsetWidth)})}updateColors(newColors){Object.assign(this.config.colors,newColors),this.injectInstanceStyles(),this.triggerEvent("colorsUpdated",{colors:this.config.colors})}updateIndicatorVisibility(show){this.config.showIndicator=show,show&&!this.indicator?this.createIndicator():!show&&this.indicator&&(this.indicator.remove(),this.indicator=null)}addItem(item){const index=this.totalItems,slide=document.createElement("div");slide.className="ng-carousel-slide",slide.dataset.index=index;const content=document.createElement("div");content.className="ng-carousel-slide-content","string"==typeof item?content.innerHTML=item:item instanceof HTMLElement?content.appendChild(item.cloneNode(!0)):item.content&&("string"==typeof item.content?content.innerHTML=item.content:item.content instanceof HTMLElement&&content.appendChild(item.content.cloneNode(!0))),slide.appendChild(content),this.slidesContainer.appendChild(slide),this.items.push(slide),this.totalItems++,this.config.showDots&&(this.dotsContainer?.remove(),this.createDots()),this.config.showArrows&&2===this.totalItems&&this.createArrows(),this.updateIndicator()}addItemsBySelector(selector){document.querySelectorAll(selector).forEach(element=>{this.addItem(element)})}updateConfig(newConfig){const currentIndex=this.currentIndex;this.pauseAutoplay(),newConfig.colors&&(this.updateColors(newConfig.colors),delete newConfig.colors),void 0!==newConfig.showIndicator&&this.updateIndicatorVisibility(newConfig.showIndicator),Object.assign(this.config,newConfig),this.container.classList.remove(this.instanceId),this.instanceId="ng-carousel-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),this.container.classList.add(this.instanceId),this.injectInstanceStyles(),this.prevArrow&&this.prevArrow.remove(),this.nextArrow&&this.nextArrow.remove(),this.config.showArrows&&this.totalItems>1&&this.createArrows(),this.dotsContainer&&this.dotsContainer.remove(),this.config.showDots&&this.totalItems>1&&this.createDots(),this.indicator&&this.indicator.remove(),this.indicator=null,this.config.showIndicator&&this.createIndicator(),this.currentIndex=Math.min(currentIndex,this.totalItems-1),this.items.forEach((slide,index)=>{slide.classList.toggle("ng-carousel-slide-active",index===this.currentIndex)}),this.dots&&this.dots.forEach((dot,index)=>{dot.classList.toggle("ng-carousel-dot-active",index===this.currentIndex)}),this.updateIndicator(),this.config.autoplay&&this.totalItems>1&&this.startAutoplay(),this.triggerEvent("configUpdated",{config:this.config})}getColors(){return{...this.config.colors}}setTheme(themeName){const themes={light:{dotColor:"rgba(0, 0, 0, 0.3)",dotActiveColor:"#1890ff",dotHoverColor:"rgba(0, 0, 0, 0.5)",progressColor:"#1890ff",arrowColor:"#333333",arrowHoverColor:"#1890ff",arrowBackgroundColor:"rgba(255, 255, 255, 0.8)",arrowHoverBackgroundColor:"rgba(255, 255, 255, 1)",arrowBorderColor:"rgba(0, 0, 0, 0.3)",arrowHoverBorderColor:"#1890ff",indicatorBackground:"rgba(255, 255, 255, 0.8)",indicatorColor:"#333333"},dark:{dotColor:"rgba(255, 255, 255, 0.3)",dotActiveColor:"#40a9ff",dotHoverColor:"rgba(255, 255, 255, 0.5)",progressColor:"#40a9ff",arrowColor:"#ffffff",arrowHoverColor:"#40a9ff",arrowBackgroundColor:"rgba(0, 0, 0, 0.5)",arrowHoverBackgroundColor:"rgba(0, 0, 0, 0.8)",arrowBorderColor:"rgba(255, 255, 255, 0.5)",arrowHoverBorderColor:"#40a9ff",indicatorBackground:"rgba(0, 0, 0, 0.5)",indicatorColor:"#ffffff"},blue:{dotColor:"rgba(255, 255, 255, 0.5)",dotActiveColor:"#096dd9",dotHoverColor:"rgba(255, 255, 255, 0.7)",progressColor:"#096dd9",arrowColor:"#ffffff",arrowHoverColor:"#69c0ff",arrowBackgroundColor:"rgba(24, 144, 255, 0.7)",arrowHoverBackgroundColor:"rgba(24, 144, 255, 0.9)",arrowBorderColor:"#91d5ff",arrowHoverBorderColor:"#69c0ff",indicatorBackground:"rgba(24, 144, 255, 0.8)",indicatorColor:"#ffffff"},green:{dotColor:"rgba(255, 255, 255, 0.5)",dotActiveColor:"#52c41a",dotHoverColor:"rgba(255, 255, 255, 0.7)",progressColor:"#52c41a",arrowColor:"#ffffff",arrowHoverColor:"#73d13d",arrowBackgroundColor:"rgba(82, 196, 26, 0.7)",arrowHoverBackgroundColor:"rgba(82, 196, 26, 0.9)",arrowBorderColor:"#95de64",arrowHoverBorderColor:"#73d13d",indicatorBackground:"rgba(82, 196, 26, 0.8)",indicatorColor:"#ffffff"},purple:{dotColor:"rgba(255, 255, 255, 0.5)",dotActiveColor:"#722ed1",dotHoverColor:"rgba(255, 255, 255, 0.7)",progressColor:"#722ed1",arrowColor:"#ffffff",arrowHoverColor:"#9254de",arrowBackgroundColor:"rgba(114, 46, 209, 0.7)",arrowHoverBackgroundColor:"rgba(114, 46, 209, 0.9)",arrowBorderColor:"#b37feb",arrowHoverBorderColor:"#9254de",indicatorBackground:"rgba(114, 46, 209, 0.8)",indicatorColor:"#ffffff"}};themes[themeName]&&this.updateColors(themes[themeName])}triggerEvent(eventName,detail){const event=new CustomEvent(`ng.carousel.${eventName}`,{detail:detail,bubbles:!0});this.container.dispatchEvent(event)}getState(){return{currentIndex:this.currentIndex,totalItems:this.totalItems,config:{...this.config},isPlaying:!!this.timer}}destroy(){this.pauseAutoplay(),this.container.innerHTML="",this.container.classList.remove("ng-carousel",this.instanceId);const style=document.getElementById(this.instanceId+"-styles");style&&style.remove()}}"undefined"!=typeof module&&module.exports?module.exports=FullConfigNGCarousel:"function"==typeof define&&define.amd?define([],function(){return FullConfigNGCarousel}):window.FullConfigNGCarousel=FullConfigNGCarousel;class NGCollapse{constructor(container,options={}){this.container=this._validateContainer(container),this.config={accordion:!1,activeKey:null,defaultActiveKey:null,bordered:!0,ghost:!1,size:"default",expandIconPosition:"start",collapsible:"header",destroyInactivePanel:!1,onChange:null,expandIcon:null,collapseIcon:null,classNames:{},styles:{},iconProps:{width:16,height:16,strokeWidth:2,stroke:"rgba(0, 0, 0, 0.45)",fill:"none",style:{}},items:[],forceRender:!1,showArrow:!0,...options},this.state={activeKeys:this._getInitialActiveKeys(),panels:this._normalizePanels(this.config.items||[]),isFirstRender:!0},this._init()}_validateContainer(container){if("string"==typeof container){const elem=document.querySelector(container);if(!elem)throw new Error(`未找到容器元素: ${container}`);return elem}if(container instanceof HTMLElement)return container;throw new Error("容器必须是选择器字符串或DOM元素")}_getInitialActiveKeys(){let keys=[];return null!==this.config.activeKey&&void 0!==this.config.activeKey?keys=Array.isArray(this.config.activeKey)?[...this.config.activeKey]:[this.config.activeKey]:null!==this.config.defaultActiveKey&&void 0!==this.config.defaultActiveKey&&(keys=Array.isArray(this.config.defaultActiveKey)?[...this.config.defaultActiveKey]:[this.config.defaultActiveKey]),keys}_normalizePanels(items){return items.map((item,index)=>({key:item.key||`panel-${index}`,label:item.label||item.header||`Panel ${index+1}`,children:item.children||item.content||"",className:item.className||"",style:item.style||{},disabled:item.disabled||!1,showArrow:void 0!==item.showArrow?item.showArrow:this.config.showArrow,extra:item.extra||null,collapsible:item.collapsible||this.config.collapsible,forceRender:item.forceRender||this.config.forceRender,destroyInactivePanel:void 0!==item.destroyInactivePanel?item.destroyInactivePanel:this.config.destroyInactivePanel,expandIcon:item.expandIcon,collapseIcon:item.collapseIcon,iconProps:{...this.config.iconProps,...item.iconProps||{}}}))}_init(){this._injectNGStyles(),this._setupContainer(),this._render(),this._bindEvents(),this.state.isFirstRender=!1}_injectNGStyles(){if(document.getElementById("ng-collapse-styles"))return;const style=document.createElement("style");style.id="ng-collapse-styles",style.textContent=this._getNGStyles(),document.head.appendChild(style)}_getNGStyles(){return"\n        /* ========== NG Design Collapse 样式 ========== */\n        \n        /* 基础容器 */\n        .ng-collapse {\n            box-sizing: border-box;\n            margin: 0;\n            padding: 0;\n            color: rgba(0, 0, 0, 0.88);\n            font-size: 14px;\n            line-height: 1.5714285714285714;\n            list-style: none;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n            background-color: #ffffff;\n            border-radius: 8px;\n            width: 100%;\n        }\n        \n        /* 有边框模式 */\n        .ng-collapse-borderless {\n            background-color: transparent;\n            border: 0;\n        }\n        \n        .ng-collapse-borderless > .ng-collapse-item {\n            border-bottom: 1px solid #d9d9d9;\n        }\n        \n        .ng-collapse-borderless > .ng-collapse-item:last-child,\n        .ng-collapse-borderless > .ng-collapse-item:last-child .ng-collapse-header {\n            border-radius: 0;\n        }\n        \n        /* 幽灵模式 */\n        .ng-collapse-ghost {\n            background-color: transparent;\n            border: 0;\n        }\n        \n        .ng-collapse-ghost > .ng-collapse-item {\n            border-bottom: 0;\n        }\n        \n        .ng-collapse-ghost > .ng-collapse-item > .ng-collapse-content {\n            background-color: transparent;\n            border-top: 0;\n        }\n        \n        .ng-collapse-ghost > .ng-collapse-item > .ng-collapse-content > .ng-collapse-content-box {\n            padding-top: 4px;\n        }\n        \n        /* Collapse项 */\n        .ng-collapse-item {\n            border-bottom: 1px solid #d9d9d9;\n        }\n        \n        .ng-collapse-item:last-child {\n            border-bottom: 0;\n        }\n        \n        .ng-collapse-item-disabled > .ng-collapse-header,\n        .ng-collapse-item-disabled > .ng-collapse-header > .arrow {\n            color: rgba(0, 0, 0, 0.25);\n            cursor: not-allowed;\n        }\n        \n        /* 头部 */\n        .ng-collapse-header {\n            position: relative;\n            display: flex;\n            flex-wrap: nowrap;\n            align-items: center;\n            padding: 12px 16px;\n            color: rgba(0, 0, 0, 0.88);\n            line-height: 1.5714285714285714;\n            cursor: pointer;\n            transition: all 0.3s, visibility 0s;\n            background-color: #fafafa;\n        }\n        \n        .ng-collapse-header:hover:not(.ng-collapse-header-disabled) {\n            background-color: #f5f5f5;\n        }\n        \n        .ng-collapse-header:focus:not(.ng-collapse-header-disabled) {\n            outline: none;\n            background-color: #f5f5f5;\n        }\n        \n        .ng-collapse-item-active > .ng-collapse-header {\n            background-color: #f0f7ff;\n        }\n        \n        .ng-collapse-header-disabled {\n            cursor: not-allowed !important;\n            opacity: 0.4;\n        }\n        \n        /* 箭头图标区域 */\n        .ng-collapse-expand-icon {\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            flex-shrink: 0;\n            transition: all 0.3s;\n            color: rgba(0, 0, 0, 0.45);\n            line-height: 1;\n        }\n        \n        .ng-collapse-expand-icon.ng-collapse-expand-icon-start {\n            margin-right: 12px;\n        }\n        \n        .ng-collapse-expand-icon.ng-collapse-expand-icon-end {\n            margin-left: auto;\n            margin-right: 0;\n        }\n        \n        .ng-collapse-expand-icon svg {\n            display: block;\n            transition: transform 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);\n            width: 16px;\n            height: 16px;\n            flex-shrink: 0;\n        }\n        \n        .ng-collapse-item-active .ng-collapse-expand-icon svg {\n            transform: rotate(90deg);\n        }\n        \n        /* 图标位置配置 */\n        .ng-collapse-icon-position-start .ng-collapse-expand-icon {\n            order: 0;\n        }\n        \n        .ng-collapse-icon-position-start .ng-collapse-header-text {\n            order: 1;\n        }\n        \n        .ng-collapse-icon-position-start .ng-collapse-extra {\n            order: 2;\n            margin-left: auto;\n        }\n        \n        .ng-collapse-icon-position-end .ng-collapse-header-text {\n            order: 0;\n            flex: 1;\n        }\n        \n        .ng-collapse-icon-position-end .ng-collapse-extra {\n            order: 1;\n            margin-right: 12px;\n        }\n        \n        .ng-collapse-icon-position-end .ng-collapse-expand-icon {\n            order: 2;\n        }\n        \n        /* 标题 */\n        .ng-collapse-header-text {\n            flex: 1;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n        }\n        \n        /* 额外内容 */\n        .ng-collapse-extra {\n            font-size: 12px;\n            color: rgba(0, 0, 0, 0.45);\n            margin-left: 8px;\n        }\n        \n        /* 内容区域 */\n        .ng-collapse-content {\n            color: rgba(0, 0, 0, 0.88);\n            background-color: #ffffff;\n            border-top: 1px solid #d9d9d9;\n            overflow: hidden;\n            transition: height 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);\n        }\n        \n        .ng-collapse-content-hidden {\n            display: none;\n        }\n        \n        .ng-collapse-content-box {\n            padding: 16px;\n            font-size: 14px;\n            line-height: 1.5714285714285714;\n        }\n        \n        /* 尺寸 */\n        .ng-collapse-small > .ng-collapse-item > .ng-collapse-header {\n            padding: 8px 12px;\n            font-size: 13px;\n        }\n        \n        .ng-collapse-small > .ng-collapse-item > .ng-collapse-content > .ng-collapse-content-box {\n            padding: 12px;\n            font-size: 13px;\n        }\n        \n        .ng-collapse-large > .ng-collapse-item > .ng-collapse-header {\n            padding: 16px 20px;\n            font-size: 16px;\n        }\n        \n        .ng-collapse-large > .ng-collapse-item > .ng-collapse-content > .ng-collapse-content-box {\n            padding: 20px;\n            font-size: 16px;\n        }\n        \n        /* 手风琴模式 */\n        .ng-collapse-accordion .ng-collapse-item-active .ng-collapse-header {\n            border-bottom-color: transparent;\n        }\n        \n        /* 无箭头 */\n        .ng-collapse-no-arrow .ng-collapse-expand-icon {\n            display: none;\n        }\n        \n        /* 响应式 */\n        @media (max-width: 768px) {\n            .ng-collapse-header {\n                padding: 10px 12px;\n            }\n            \n            .ng-collapse-content-box {\n                padding: 12px;\n            }\n        }\n    "}_setupContainer(){if(this.container.className="ng-collapse",!1===this.config.bordered&&this.container.classList.add("ng-collapse-borderless"),this.config.ghost&&this.container.classList.add("ng-collapse-ghost"),"default"!==this.config.size&&this.container.classList.add(`ng-collapse-${this.config.size}`),this.container.classList.add(`ng-collapse-icon-position-${this.config.expandIconPosition}`),this.config.accordion&&this.container.classList.add("ng-collapse-accordion"),this.config.classNames.container){(Array.isArray(this.config.classNames.container)?this.config.classNames.container:[this.config.classNames.container]).forEach(className=>{className&&this.container.classList.add(className)})}this.config.styles.container&&Object.assign(this.container.style,this.config.styles.container)}_render(){this.container.innerHTML="",this.state.panels.forEach(panel=>{const panelElement=this._createPanelElement(panel);this.container.appendChild(panelElement)}),this._updatePanelsState()}_createPanelElement(panel){const panelElem=document.createElement("div");if(panelElem.className="ng-collapse-item",panel.disabled&&panelElem.classList.add("ng-collapse-item-disabled"),panel.className&&panelElem.classList.add(panel.className),this.config.classNames.item){(Array.isArray(this.config.classNames.item)?this.config.classNames.item:[this.config.classNames.item]).forEach(className=>{className&&panelElem.classList.add(className)})}this.config.styles.item&&Object.assign(panelElem.style,this.config.styles.item),Object.assign(panelElem.style,panel.style);const header=this._createPanelHeader(panel);panelElem.appendChild(header);const content=this._createPanelContent(panel);return panelElem.appendChild(content),panelElem}_createPanelHeader(panel){const header=document.createElement("div");if(header.className="ng-collapse-header",header.dataset.key=panel.key,header.tabIndex=panel.disabled?-1:0,panel.disabled&&header.classList.add("ng-collapse-header-disabled"),this.config.classNames.header){(Array.isArray(this.config.classNames.header)?this.config.classNames.header:[this.config.classNames.header]).forEach(className=>{className&&header.classList.add(className)})}this.config.styles.header&&Object.assign(header.style,this.config.styles.header);const iconArea=this._createExpandIcon(panel);header.appendChild(iconArea);const title=this._createTitle(panel);if(header.appendChild(title),panel.extra){const extra=this._createExtraContent(panel);header.appendChild(extra)}return header}_createExpandIcon(panel){const iconArea=document.createElement("div");if(iconArea.className=`ng-collapse-expand-icon ng-collapse-expand-icon-${this.config.expandIconPosition}`,!panel.showArrow)return iconArea.classList.add("ng-collapse-no-arrow"),iconArea;const isActive=this.state.activeKeys.includes(panel.key),icon=this._createIconElement(isActive,panel.iconProps);return iconArea.appendChild(icon),iconArea}_createIconElement(isActive,iconProps){const{width:width=16,height:height=16,strokeWidth:strokeWidth=2,stroke:stroke="rgba(0, 0, 0, 0.45)",fill:fill="none",style:style={}}=iconProps,svg=document.createElementNS("http://www.w3.org/2000/svg","svg");svg.setAttribute("viewBox","0 0 24 24"),svg.setAttribute("width",width.toString()),svg.setAttribute("height",height.toString()),svg.setAttribute("aria-hidden","true"),svg.setAttribute("focusable","false"),Object.assign(svg.style,{display:"block",transition:"transform 0.3s cubic-bezier(0.645, 0.045, 0.355, 1)",...style});const path=document.createElementNS("http://www.w3.org/2000/svg","path");return path.setAttribute("d","M9 6l6 6-6 6"),path.setAttribute("stroke",stroke),path.setAttribute("stroke-width",strokeWidth.toString()),path.setAttribute("fill",fill),path.setAttribute("stroke-linecap","round"),path.setAttribute("stroke-linejoin","round"),svg.appendChild(path),isActive&&(svg.style.transform="rotate(90deg)"),svg}_createTitle(panel){const title=document.createElement("div");return title.className="ng-collapse-header-text",title.textContent=panel.label,title}_createExtraContent(panel){const extra=document.createElement("div");if(extra.className="ng-collapse-extra","string"==typeof panel.extra)extra.innerHTML=panel.extra;else if(panel.extra instanceof HTMLElement)extra.appendChild(panel.extra);else if("function"==typeof panel.extra){const extraContent=panel.extra();"string"==typeof extraContent?extra.innerHTML=extraContent:extraContent instanceof HTMLElement&&extra.appendChild(extraContent)}return extra}_createPanelContent(panel){const content=document.createElement("div");if(content.className="ng-collapse-content",content.dataset.key=panel.key,this.config.classNames.content){(Array.isArray(this.config.classNames.content)?this.config.classNames.content:[this.config.classNames.content]).forEach(className=>{className&&content.classList.add(className)})}this.config.styles.content&&Object.assign(content.style,this.config.styles.content);const contentBox=document.createElement("div");if(contentBox.className="ng-collapse-content-box",this.config.classNames.contentBox){(Array.isArray(this.config.classNames.contentBox)?this.config.classNames.contentBox:[this.config.classNames.contentBox]).forEach(className=>{className&&contentBox.classList.add(className)})}return this.config.styles.contentBox&&Object.assign(contentBox.style,this.config.styles.contentBox),(panel.forceRender||this.state.activeKeys.includes(panel.key)||!panel.destroyInactivePanel)&&this._renderPanelContent(panel,contentBox),content.appendChild(contentBox),content}_renderPanelContent(panel,container){if(container.innerHTML="",panel.children)if("string"==typeof panel.children)container.innerHTML=panel.children;else if(panel.children instanceof HTMLElement)container.appendChild(panel.children.cloneNode(!0));else if("function"==typeof panel.children){const content=panel.children();"string"==typeof content?container.innerHTML=content:content instanceof HTMLElement&&container.appendChild(content)}}_updatePanelsState(){this.container.querySelectorAll(".ng-collapse-item").forEach(panel=>{const key=panel.querySelector(".ng-collapse-header")?.dataset.key;if(!key)return;panel.querySelector(".ng-collapse-header");const content=panel.querySelector(".ng-collapse-content"),contentBox=panel.querySelector(".ng-collapse-content-box"),expandIcon=panel.querySelector(".ng-collapse-expand-icon"),svg=expandIcon?.querySelector("svg"),isActive=this.state.activeKeys.includes(key),panelConfig=this.state.panels.find(p=>p.key===key);if(isActive){if(panel.classList.add("ng-collapse-item-active"),svg&&(svg.style.transform="rotate(90deg)"),content&&(content.classList.remove("ng-collapse-content-hidden"),contentBox&&panelConfig&&!panelConfig.forceRender)){const height=contentBox.scrollHeight;content.style.height=`${height}px`,setTimeout(()=>{"0px"!==content.style.height&&(content.style.height="auto")},300)}!panelConfig||!panelConfig.forceRender&&panelConfig.destroyInactivePanel||this._renderPanelContent(panelConfig,contentBox)}else{if(panel.classList.remove("ng-collapse-item-active"),svg&&(svg.style.transform="rotate(0deg)"),content)if(contentBox&&!panelConfig?.forceRender){const height=contentBox.scrollHeight;content.style.height=`${height}px`,content.offsetHeight,content.style.height="0px",setTimeout(()=>{this.state.activeKeys.includes(key)||(content.classList.add("ng-collapse-content-hidden"),content.style.height="")},300)}else content.classList.add("ng-collapse-content-hidden");panelConfig&&panelConfig.destroyInactivePanel&&!panelConfig.forceRender&&(contentBox.innerHTML="")}})}_bindEvents(){this.container.addEventListener("click",e=>{this._handleCollapseClick(e)}),this.container.addEventListener("keydown",e=>{if("Enter"===e.key||" "===e.key){e.preventDefault();const header=e.target.closest(".ng-collapse-header");header&&this._togglePanelByHeader(header)}})}_handleCollapseClick(e){const header=e.target.closest(".ng-collapse-header");header&&this._togglePanelByHeader(header)}_togglePanelByHeader(header){const panel=header.closest(".ng-collapse-item"),key=header.dataset.key,panelConfig=this.state.panels.find(p=>p.key===key);if(!panel.classList.contains("ng-collapse-item-disabled")&&!header.classList.contains("ng-collapse-header-disabled")){if(panelConfig){const isIconClick=event.target.closest(".ng-collapse-expand-icon");if("icon"===panelConfig.collapsible&&!isIconClick)return;if("disabled"===panelConfig.collapsible)return}this._togglePanel(key)}}_togglePanel(key){const wasActive=this.state.activeKeys.includes(key);let newActiveKeys;newActiveKeys=this.config.accordion?wasActive?[]:[key]:wasActive?this.state.activeKeys.filter(k=>k!==key):[...this.state.activeKeys,key],this.state.activeKeys=newActiveKeys,this._updatePanelsState(),this.config.onChange&&(this.config.accordion?this.config.onChange(newActiveKeys.length>0?newActiveKeys[0]:void 0):this.config.onChange(newActiveKeys))}addPanel(panelConfig,index=-1){const normalizedPanel={key:panelConfig.key||`panel-${this.state.panels.length}`,label:panelConfig.label||panelConfig.header||`Panel ${this.state.panels.length+1}`,children:panelConfig.children||panelConfig.content||"",className:panelConfig.className||"",style:panelConfig.style||{},disabled:panelConfig.disabled||!1,showArrow:void 0!==panelConfig.showArrow?panelConfig.showArrow:this.config.showArrow,extra:panelConfig.extra||null,collapsible:panelConfig.collapsible||this.config.collapsible,forceRender:panelConfig.forceRender||this.config.forceRender,destroyInactivePanel:void 0!==panelConfig.destroyInactivePanel?panelConfig.destroyInactivePanel:this.config.destroyInactivePanel,expandIcon:panelConfig.expandIcon,collapseIcon:panelConfig.collapseIcon,iconProps:{...this.config.iconProps,...panelConfig.iconProps||{}}};return-1===index||index>=this.state.panels.length?this.state.panels.push(normalizedPanel):this.state.panels.splice(index,0,normalizedPanel),this._render(),normalizedPanel.key}removePanel(key){const index=this.state.panels.findIndex(p=>p.key===key);return-1!==index&&(this.state.panels.splice(index,1),this.state.activeKeys=this.state.activeKeys.filter(k=>k!==key),this._render(),!0)}updatePanel(key,updates){const index=this.state.panels.findIndex(p=>p.key===key);return-1!==index&&(this.state.panels[index]={...this.state.panels[index],...updates,key:key},this._render(),!0)}expandPanel(key){this.state.activeKeys.includes(key)||(this.config.accordion?this.state.activeKeys=[key]:this.state.activeKeys.push(key),this._updatePanelsState(),this.config.onChange&&(this.config.accordion?this.config.onChange(key):this.config.onChange([...this.state.activeKeys])))}collapsePanel(key){this.state.activeKeys.includes(key)&&(this.state.activeKeys=this.state.activeKeys.filter(k=>k!==key),this._updatePanelsState(),this.config.onChange&&(this.config.accordion?this.config.onChange(void 0):this.config.onChange([...this.state.activeKeys])))}expandAll(){this.config.accordion||(this.state.activeKeys=this.state.panels.filter(p=>!p.disabled&&"disabled"!==p.collapsible).map(p=>p.key),this._updatePanelsState(),this.config.onChange&&this.config.onChange([...this.state.activeKeys]))}collapseAll(){this.state.activeKeys=[],this._updatePanelsState(),this.config.onChange&&this.config.onChange(this.config.accordion?void 0:[])}getActiveKey(){return this.config.accordion?this.state.activeKeys.length>0?this.state.activeKeys[0]:void 0:[...this.state.activeKeys]}getPanel(key){return this.state.panels.find(p=>p.key===key)}getPanels(){return[...this.state.panels]}updateConfig(newConfig){this.config={...this.config,...newConfig},this._setupContainer(),this._render()}forceUpdate(){this._updatePanelsState()}updateIconConfig(key,iconConfig){const panel=this.state.panels.find(p=>p.key===key);return!!panel&&(panel.iconProps={...panel.iconProps,...iconConfig},this._render(),!0)}updateAllIcons(iconConfig){this.config.iconProps={...this.config.iconProps,...iconConfig},this.state.panels.forEach(panel=>{panel.iconProps={...panel.iconProps,...iconConfig}}),this._render()}setCustomIcon(key,iconType="chevron"){const panel=this.state.panels.find(p=>p.key===key);return!!panel&&(delete panel.expandIcon,delete panel.collapseIcon,"chevron"===iconType?panel.iconProps={...panel.iconProps,strokeWidth:2,stroke:"rgba(0, 0, 0, 0.45)"}:"caret"===iconType?panel.iconProps={...panel.iconProps,strokeWidth:1.5,stroke:"rgba(0, 0, 0, 0.6)"}:"plus"===iconType&&(panel.expandIcon=isActive=>{const svg=document.createElementNS("http://www.w3.org/2000/svg","svg");svg.setAttribute("viewBox","0 0 24 24"),svg.setAttribute("width","16"),svg.setAttribute("height","16"),svg.setAttribute("aria-hidden","true");const path=document.createElementNS("http://www.w3.org/2000/svg","path");return isActive?path.setAttribute("d","M5 12h14"):path.setAttribute("d","M12 5v14M5 12h14"),path.setAttribute("stroke","rgba(0, 0, 0, 0.45)"),path.setAttribute("stroke-width","2"),path.setAttribute("fill","none"),path.setAttribute("stroke-linecap","round"),path.setAttribute("stroke-linejoin","round"),svg.appendChild(path),svg}),this._render(),!0)}destroy(){this.container.innerHTML="",this.container.className="",this.container.style="",this.container.replaceWith(this.container.cloneNode(!0)),this.state={activeKeys:[],panels:[],isFirstRender:!0}}}function getFormAttachmentInfo(params){return new Promise((resolve,reject)=>{const{phidValue:phidValue,busType:busType,tableName:tableName,mainTableNames:mainTableNames,detailTablePrefixes:detailTablePrefixes}=params;let fromObj={},mainInfo={};$NG.execServer("selectFromMainAttachmentInfo",{table:tableName,phid:phidValue,bus:busType},function(res){if(console.log(res),0==res.count)return void reject(new Error("未找到主表附件信息"));const data=JSON.parse(res.data);if(0==data.length)return void reject(new Error("主表数据为空"));const{extendObjects:extendObjects}=data[0];mainInfo=extendObjects,console.log("主表信息:",mainInfo),$NG.request.get({url:`/sup/customServer/getInfo?id=${phidValue}&oType=view&customBusCode=${busType}&encryptPrimaryKey=${$NG.CryptoJS.encode(phidValue)}`}).then(res=>{console.log("明细表响应:",res),fromObj=processResponseData(res,mainTableNames,detailTablePrefixes),fromObj={...fromObj,...mainInfo},console.log("最终结果:",fromObj),resolve(fromObj)}).catch(error=>{reject(error)})})})}function processResponseData(responseData,mainTableNames,detailTablePrefixes){const fromObj={};for(const mainTableName of mainTableNames){const mainTable=responseData.data[mainTableName];if(mainTable&&mainTable.u_file){fromObj.mGuid=mainTable.u_file.replace(/@@\d+$/,"");break}}for(const detailPrefix of detailTablePrefixes){const detailTables=Object.keys(responseData.data).filter(key=>key.startsWith(detailPrefix)).map(key=>({tableName:key,suffix:key.replace(detailPrefix,"")}));for(const{tableName:tableName,suffix:suffix}of detailTables){const detailTable=responseData.data[tableName];if(Array.isArray(detailTable)){fromObj[suffix?`d${suffix}Guids`:"dGuids"]=detailTable.map(item=>{const fileValue=item.u_file||item.u_body_file;return fileValue?fileValue.replace(/@@\d+$/,""):null}).filter(file=>null!=file)}}}return fromObj}async function exampleUsage(phidValue,busType,tableName,dTableName){try{const params={phidValue:phidValue,busType:busType,tableName:tableName,mainTableNames:[tableName],detailTablePrefixes:[dTableName]},fromObj=await getFormAttachmentInfo(params);return console.log("获取到的附件信息:",fromObj),fromObj}catch(error){throw console.error("获取附件信息失败:",error),error}}function exampleUsagePromise(phidValue,busType,tableName,dTableName){return getFormAttachmentInfo({phidValue:phidValue,busType:busType,tableName:tableName,mainTableNames:[tableName],detailTablePrefixes:[dTableName]}).then(fromObj=>(console.log("获取到的附件信息:",fromObj),fromObj)).catch(error=>{throw console.error("获取附件信息失败:",error),error})}function getElementValue(parentId,childSelector,valueType="text",timeout=5e3){return new Promise((resolve,reject)=>{const startTime=Date.now();!function tryGetElement(){const parent=document.getElementById(parentId);if(!parent)return Date.now()-startTime>timeout?void reject(`未找到ID为${parentId}的元素`):void setTimeout(tryGetElement,100);const child=parent.querySelector(childSelector);if(child)resolve("html"===valueType?child.innerHTML.trim():child.textContent.trim());else{if(Date.now()-startTime>timeout)return void reject(`在${parentId}中未找到${childSelector}元素`);setTimeout(tryGetElement,100)}}()})}function loadJSZip(){return new Promise((resolve,reject)=>{if("undefined"!=typeof JSZip)return void resolve(JSZip);const script=document.createElement("script");script.src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js",script.onload=()=>resolve(JSZip),script.onerror=()=>reject(new Error("Failed to load JSZip")),document.head.appendChild(script)})}function downloadFileAsBlob(config){const{downloadUrl:downloadUrl,dbToken:dbToken,requestData:requestData,fileName:fileName}=config;return new Promise((resolve,reject)=>{downloadUrl?(console.log(`开始下载文件: ${fileName}`,requestData),$NG.request.post({url:downloadUrl,headers:{dbToken:dbToken,"Content-Type":"application/json"},data:JSON.stringify(requestData)}).then(res=>{if(console.log("下载响应:",res),res.data&&res.data[requestData.asrFids[0]]){const fileDownloadUrl=res.data[requestData.asrFids[0]];console.log("获取到下载URL:",fileDownloadUrl),fetch(fileDownloadUrl,{headers:{dbToken:dbToken}}).then(response=>{if(!response.ok)throw new Error(`HTTP error! status: ${response.status}`);return response.blob()}).then(blob=>{blob&&blob.size>0?(console.log(`文件下载成功: ${fileName}, 大小: ${blob.size} bytes`),resolve({blob:blob,fileName:fileName})):(console.error(`文件Blob无效: ${fileName}, 大小: ${blob.size}`),reject(new Error(`文件Blob无效: ${fileName}`)))}).catch(error=>{console.error("获取文件内容失败:",error),reject(error)})}else console.error("未获取到有效的下载URL",res),reject(new Error("未获取到有效的下载URL"))}).catch(error=>{console.error("下载请求失败:",error),reject(error)})):reject(new Error("缺少必要参数：downloadUrl"))})}function decodeFileName(fileName){try{return decodeURIComponent(fileName)}catch(e){return console.warn("文件名解码失败，使用原文件名:",fileName),fileName}}async function downloadAllAttachmentsAsZipOldSingle(attachmentData,options={}){try{const JSZip=await loadJSZip(),config={downloadUrl:options.downloadUrl||"JFileSrv/api/getDownloadUrlByAsrFids",dbToken:options.dbToken||"0001",parentFolderName:options.parentFolderName||"测试单据业务",wmDisabled:options.wmDisabled||"0",billWM:options.billWM||"YEIG",orgId:options.orgId||"0"},zip=new JSZip,parentFolder=zip.folder(config.parentFolderName);let attachmentRecordList;if(attachmentData.data&&attachmentData.data.attachmentRecordList)attachmentRecordList=attachmentData.data.attachmentRecordList;else if(Array.isArray(attachmentData))attachmentRecordList=attachmentData;else{if(!attachmentData.attachmentRecordList)throw new Error("无法识别的附件数据结构");attachmentRecordList=attachmentData.attachmentRecordList}if(!attachmentRecordList||0===attachmentRecordList.length)throw new Error("未找到附件数据");console.log(`开始处理 ${attachmentRecordList.length} 个附件`,config);const downloadPromises=attachmentRecordList.map(record=>{const folderName=record.typeName||"未分类",fileName=decodeFileName(record.asrName);return downloadFileAsBlob({downloadUrl:config.downloadUrl,dbToken:config.dbToken,requestData:{asrFids:[record.asrFid],loginId:record.asrFill,orgId:config.orgId,busTypeCode:record.bustypecode,wmDisabled:config.wmDisabled,billWM:config.billWM},fileName:fileName}).then(fileData=>{let folder=parentFolder.folder(folderName);return folder||(folder=parentFolder.folder(folderName)),folder.file(fileName,fileData.blob),console.log(`已添加文件到文件夹: ${folderName}/${fileName}`),{folderName:folderName,fileName:fileName,success:!0}}).catch(error=>(console.error(`下载文件失败: ${folderName}/${fileName}`,error),{folderName:folderName,fileName:fileName,success:!1,error:error.message}))}),results=await Promise.allSettled(downloadPromises),successfulDownloads=results.filter(result=>"fulfilled"===result.status&&result.value.success).length,failedDownloads=results.length-successfulDownloads;if(console.log(`下载完成: 成功 ${successfulDownloads} 个, 失败 ${failedDownloads} 个`),0===successfulDownloads)throw new Error("所有文件下载都失败了，请检查网络连接和参数配置");const zipBlob=await zip.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}});console.log(`ZIP文件生成完成，大小: ${zipBlob.size} bytes`);const downloadUrl=URL.createObjectURL(zipBlob),a=document.createElement("a");return a.href=downloadUrl,a.download=`${config.parentFolderName}_附件包.zip`,document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(()=>{URL.revokeObjectURL(downloadUrl)},1e3),console.log(`ZIP文件已生成: ${config.parentFolderName}_附件包.zip`),{success:!0,total:attachmentRecordList.length,successful:successfulDownloads,failed:failedDownloads,zipFileName:`${config.parentFolderName}_附件包.zip`,config:config,results:results.map((result,index)=>({record:attachmentRecordList[index],status:result.status,value:"fulfilled"===result.status?result.value:result.reason}))}}catch(error){return console.error("下载所有附件失败:",error),{success:!1,error:error.message}}}async function downloadAllAttachmentsAsZip(attachmentData,options={}){try{const JSZip=await loadJSZip(),config={downloadUrl:options.downloadUrl||"JFileSrv/api/getDownloadUrlByAsrFids",dbToken:options.dbToken||"0001",parentFolderName:options.parentFolderName||"测试单据业务",wmDisabled:options.wmDisabled||"0",billWM:options.billWM||"YEIG",orgId:options.orgId||"0"},zip=new JSZip,parentFolder=zip.folder(config.parentFolderName);let allAttachmentRecords=[];if(Array.isArray(attachmentData))console.log(`检测到 ${attachmentData.length} 个对象`),attachmentData.forEach((item,index)=>{let records=[];item.data&&item.data.attachmentRecordList?records=item.data.attachmentRecordList:item.attachmentRecordList?records=item.attachmentRecordList:Array.isArray(item)&&(records=item),console.log(`对象 ${index+1} 包含 ${records.length} 个附件`),allAttachmentRecords=allAttachmentRecords.concat(records)});else if(console.log("检测到单个对象"),attachmentData.data&&attachmentData.data.attachmentRecordList)allAttachmentRecords=attachmentData.data.attachmentRecordList;else if(attachmentData.attachmentRecordList)allAttachmentRecords=attachmentData.attachmentRecordList;else{if(!Array.isArray(attachmentData))throw new Error("无法识别的附件数据结构");allAttachmentRecords=attachmentData}if(!allAttachmentRecords||0===allAttachmentRecords.length)throw new Error("未找到附件数据");console.log(`总共处理 ${allAttachmentRecords.length} 个附件`);const groupedAttachments={};allAttachmentRecords.forEach(record=>{const folderName=record.typeName||"未分类";groupedAttachments[folderName]||(groupedAttachments[folderName]=[]),groupedAttachments[folderName].push(record)}),console.log("附件分组情况:",Object.keys(groupedAttachments).map(key=>({"文件夹":key,"文件数":groupedAttachments[key].length})));const downloadPromises=[];Object.keys(groupedAttachments).forEach(folderName=>{groupedAttachments[folderName].forEach(record=>{const fileName=decodeFileName(record.asrName),promise=downloadFileAsBlob({downloadUrl:config.downloadUrl,dbToken:config.dbToken,requestData:{asrFids:[record.asrFid],loginId:record.asrFill,orgId:config.orgId,busTypeCode:record.bustypecode,wmDisabled:config.wmDisabled,billWM:config.billWM},fileName:fileName}).then(fileData=>{let folder=parentFolder.folder(folderName);return folder||(folder=parentFolder.folder(folderName)),folder.file(fileName,fileData.blob),console.log(`已添加文件到文件夹: ${folderName}/${fileName}`),{folderName:folderName,fileName:fileName,success:!0,record:record}}).catch(error=>(console.error(`下载文件失败: ${folderName}/${fileName}`,error),{folderName:folderName,fileName:fileName,success:!1,error:error.message,record:record}));downloadPromises.push(promise)})});const results=await Promise.allSettled(downloadPromises),successfulDownloads=results.filter(result=>"fulfilled"===result.status&&result.value.success).length,failedDownloads=results.length-successfulDownloads;if(console.log(`下载完成: 成功 ${successfulDownloads} 个, 失败 ${failedDownloads} 个`),0===successfulDownloads)throw new Error("所有文件下载都失败了，请检查网络连接和参数配置");const zipBlob=await zip.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}});console.log(`ZIP文件生成完成，大小: ${zipBlob.size} bytes`);const downloadUrl=URL.createObjectURL(zipBlob),a=document.createElement("a");return a.href=downloadUrl,a.download=`${config.parentFolderName}_附件包.zip`,document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(()=>{URL.revokeObjectURL(downloadUrl)},1e3),console.log(`ZIP文件已生成: ${config.parentFolderName}_附件包.zip`),{success:!0,total:allAttachmentRecords.length,successful:successfulDownloads,failed:failedDownloads,zipFileName:`${config.parentFolderName}_附件包.zip`,groups:Object.keys(groupedAttachments).map(key=>({groupName:key,fileCount:groupedAttachments[key].length})),config:config,results:results.map((result,index)=>({record:allAttachmentRecords[index],status:result.status,value:"fulfilled"===result.status?result.value:result.reason}))}}catch(error){return console.error("下载所有附件失败:",error),{success:!1,error:error.message}}}function createDownloadButton(attachmentData,buttonOptions={}){const button=document.createElement("button");button.textContent=buttonOptions.text||"下载所有附件",button.style.cssText=buttonOptions.style||"\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        z-index: 999;\n        padding: 10px 20px;\n        background: #1890ff;\n        color: white;\n        border: none;\n        border-radius: 4px;\n        cursor: pointer;\n        font-size: 14px;\n    ",button.addEventListener("click",async()=>{if(button.disabled)return;button.disabled=!0;const originalText=button.textContent;button.textContent="下载中...";try{const result=await downloadAllAttachmentsAsZip(attachmentData,buttonOptions);result.success?alert(`下载完成！成功: ${result.successful} 个文件, 失败: ${result.failed} 个文件`):alert("下载失败: "+result.error)}catch(error){alert("下载过程出错: "+error.message)}finally{button.disabled=!1,button.textContent=originalText}});return(buttonOptions.container||document.body).appendChild(button),button}async function originalDownloadFunction(){return downloadAllAttachmentsAsZip(window.mAttachfromObj||getResponseData())}function initAttachmentDownloader(config){const cfg={tableName:"",busType:"",FormName:"",sFormGroupKeys:[],dFormFormKeys:[],sFormName:[],dFormName:[],mFormName:"表头",...config},phidValue=$NG.getCmpApi(cfg.tableName).getValues().phid;let treeStructure={},NuTreeStructure={},editTreeStructure={},downloadConfig={},currentTreeType=!1;function getFormAttachmentInfo(params){return new Promise((resolve,reject)=>{const{phidValue:phidValue,busType:busType,tableName:tableName,mainTableNames:mainTableNames}=params;let fromObj={},mainInfo={};$NG.execServer("selectFromMainAttachmentInfo",{table:tableName,phid:phidValue,bus:busType},function(res){if(console.log("主表附件信息查询结果:",res),0!=res.count&&res.data)try{const data=JSON.parse(res.data);if(0==data.length)console.log("主表数据为空，继续处理其他附件"),mainInfo={};else{const{extendObjects:extendObjects}=data[0];mainInfo=extendObjects||{},console.log("主表信息:",mainInfo)}}catch(e){console.error("解析主表数据失败:",e),mainInfo={}}else console.log("未找到主表附件信息，继续处理其他附件"),mainInfo={};$NG.request.get({url:`/sup/customServer/getInfo?id=${phidValue}&oType=view&customBusCode=${busType}&encryptPrimaryKey=${$NG.CryptoJS.encode(phidValue)}`}).then(res=>{console.log("明细表响应:",res),fromObj=function(responseData,mainTableNames){const fromObj={};for(const mainTableName of mainTableNames){const mainTable=responseData.data[mainTableName];if(mainTable&&(fromObj.mGuids=[],cfg.sFormGroupKeys.forEach((fieldName,index)=>{if(mainTable[fieldName]){const fileValue=mainTable[fieldName];fromObj.mGuids.push({fieldName:fieldName,guid:fileValue.replace(/@@\d+$/,""),formName:cfg.sFormName[index]||fieldName}),console.log(`找到主表附件字段: ${fieldName} -> ${cfg.sFormName[index]}`)}}),fromObj.mGuids.length>0))break}return fromObj.detailGuids={},cfg.dFormFormKeys.forEach((detailTableName,index)=>{const detailTable=responseData.data[detailTableName];if(Array.isArray(detailTable)){const formName=cfg.dFormName[index]||detailTableName;fromObj.detailGuids[formName]=detailTable.map(item=>{const fileValue=item.u_file||item.u_body_file||item.u_file1;return fileValue?fileValue.replace(/@@\d+$/,""):null}).filter(file=>null!=file),console.log(`明细表 ${detailTableName} 找到 ${fromObj.detailGuids[formName].length} 个附件`)}}),fromObj}(res,mainTableNames),fromObj={...fromObj,...mainInfo},console.log("最终结果:",fromObj),resolve(fromObj)}).catch(error=>{console.error("获取明细表信息失败:",error),fromObj={...mainInfo},resolve(fromObj)})})})}function buildTreeStructureWithRowFolder(downloadConfig){const treeStructure={root:{name:`${cfg.FormName}`,type:"root",level:0,path:"/",children:[],fileCount:0,id:generateId(),collapsed:!1},totalFiles:0,totalFolders:0,buildTime:(new Date).toISOString(),type:!0},rootNode=treeStructure.root;if(downloadConfig.mainAttachment&&downloadConfig.mFormName){const mainFormNode={name:downloadConfig.mFormName,type:"folder",level:1,path:`/${downloadConfig.mFormName}`,children:[],fileCount:0,id:generateId(),collapsed:!1},mainAttachments=downloadConfig.mainAttachment[downloadConfig.mFormName];if(mainAttachments&&mainAttachments.data&&mainAttachments.data.attachmentRecordList){const attachments=mainAttachments.data.attachmentRecordList,attachmentsByType={};attachments.forEach(attachment=>{const typeName=attachment.typeName||"未分类";attachmentsByType[typeName]||(attachmentsByType[typeName]=[]),attachmentsByType[typeName].push(attachment)}),Object.keys(attachmentsByType).forEach(typeName=>{const typeNode={name:typeName,type:"folder",level:2,path:`/${downloadConfig.mFormName}/${typeName}`,children:[],fileCount:attachmentsByType[typeName].length,id:generateId(),collapsed:!1};attachmentsByType[typeName].forEach(attachment=>{const fileNode={name:decodeFileName(attachment.asrName),type:"file",level:3,path:`/${downloadConfig.mFormName}/${typeName}/${decodeFileName(attachment.asrName)}`,fileInfo:{...attachment,asrFid:attachment.asrFid,asrName:attachment.asrName,fileSize:attachment.fileSize,uploadTime:attachment.uploadTime,typeName:attachment.typeName,asrRemark:attachment.asrRemark||"",asrSessionGuid:attachment.asrSessionGuid,bustypecode:attachment.bustypecode},id:generateId()};typeNode.children.push(fileNode),treeStructure.totalFiles++}),mainFormNode.children.push(typeNode),mainFormNode.fileCount+=typeNode.fileCount,treeStructure.totalFolders++})}rootNode.children.push(mainFormNode),treeStructure.totalFolders++}return downloadConfig.groupAttachments&&downloadConfig.sFormName&&downloadConfig.sFormName.forEach(formName=>{if(downloadConfig.groupAttachments[formName]){const groupFormNode={name:formName,type:"folder",level:1,path:`/${formName}`,children:[],fileCount:0,id:generateId(),collapsed:!1},groupAttachments=downloadConfig.groupAttachments[formName];if(groupAttachments.data&&groupAttachments.data.attachmentRecordList){const attachments=groupAttachments.data.attachmentRecordList,attachmentsByType={};attachments.forEach(attachment=>{const typeName=attachment.typeName||"未分类";attachmentsByType[typeName]||(attachmentsByType[typeName]=[]),attachmentsByType[typeName].push(attachment)}),Object.keys(attachmentsByType).forEach(typeName=>{const typeNode={name:typeName,type:"folder",level:2,path:`/${formName}/${typeName}`,children:[],fileCount:attachmentsByType[typeName].length,id:generateId(),collapsed:!1};attachmentsByType[typeName].forEach(attachment=>{const fileNode={name:decodeFileName(attachment.asrName),type:"file",level:3,path:`/${formName}/${typeName}/${decodeFileName(attachment.asrName)}`,fileInfo:{...attachment,asrFid:attachment.asrFid,asrName:attachment.asrName,fileSize:attachment.fileSize,uploadTime:attachment.uploadTime,typeName:attachment.typeName,asrRemark:attachment.asrRemark||"",asrSessionGuid:attachment.asrSessionGuid,bustypecode:attachment.bustypecode},id:generateId()};typeNode.children.push(fileNode),treeStructure.totalFiles++}),groupFormNode.children.push(typeNode),groupFormNode.fileCount+=typeNode.fileCount,treeStructure.totalFolders++})}rootNode.children.push(groupFormNode),treeStructure.totalFolders++}}),downloadConfig.detailAttachments&&downloadConfig.dFormName&&downloadConfig.dFormName.forEach(formName=>{if(downloadConfig.detailAttachments[formName]){const detailFormNode={name:formName,type:"folder",level:1,path:`/${formName}`,children:[],fileCount:0,id:generateId(),collapsed:!1},detailAttachments=downloadConfig.detailAttachments[formName];Array.isArray(detailAttachments)&&detailAttachments.forEach((detailItem,rowIndex)=>{if(200===detailItem.code&&detailItem.data&&detailItem.data.attachmentRecordList){const rowNode={name:`行${rowIndex+1}`,type:"folder",level:2,path:`/${formName}/行${rowIndex+1}`,children:[],fileCount:0,id:generateId(),collapsed:!1},attachments=detailItem.data.attachmentRecordList,attachmentsByType={};attachments.forEach(attachment=>{const typeName=attachment.typeName||"未分类";attachmentsByType[typeName]||(attachmentsByType[typeName]=[]),attachmentsByType[typeName].push(attachment)}),Object.keys(attachmentsByType).forEach(typeName=>{const typeNode={name:typeName,type:"folder",level:3,path:`/${formName}/行${rowIndex+1}/${typeName}`,children:[],fileCount:attachmentsByType[typeName].length,id:generateId(),collapsed:!0};attachmentsByType[typeName].forEach(attachment=>{const fileNode={name:decodeFileName(attachment.asrName),type:"file",level:4,path:`/${formName}/行${rowIndex+1}/${typeName}/${decodeFileName(attachment.asrName)}`,fileInfo:{...attachment,asrFid:attachment.asrFid,asrName:attachment.asrName,fileSize:attachment.fileSize,uploadTime:attachment.uploadTime,typeName:attachment.typeName,asrRemark:attachment.asrRemark||"",asrSessionGuid:attachment.asrSessionGuid,bustypecode:attachment.bustypecode},id:generateId()};typeNode.children.push(fileNode),treeStructure.totalFiles++}),rowNode.children.push(typeNode),rowNode.fileCount+=typeNode.fileCount,treeStructure.totalFolders++}),detailFormNode.children.push(rowNode),detailFormNode.fileCount+=rowNode.fileCount,treeStructure.totalFolders++}}),rootNode.children.push(detailFormNode),treeStructure.totalFolders++}}),rootNode.fileCount=treeStructure.totalFiles,console.log("带行标识树形结构构建完成:",treeStructure),treeStructure}function buildTreeStructureWithoutRowFolder(downloadConfig){const treeStructure={root:{name:`${cfg.FormName}`,type:"root",level:0,path:"/",children:[],fileCount:0,id:generateId(),collapsed:!1},totalFiles:0,totalFolders:0,buildTime:(new Date).toISOString(),type:!1},rootNode=treeStructure.root;if(downloadConfig.mainAttachment&&downloadConfig.mFormName){const mainFormNode={name:downloadConfig.mFormName,type:"folder",level:1,path:`/${downloadConfig.mFormName}`,children:[],fileCount:0,id:generateId(),collapsed:!1},mainAttachments=downloadConfig.mainAttachment[downloadConfig.mFormName];if(mainAttachments&&mainAttachments.data&&mainAttachments.data.attachmentRecordList){const attachments=mainAttachments.data.attachmentRecordList,attachmentsByType={};attachments.forEach(attachment=>{const typeName=attachment.typeName||"未分类";attachmentsByType[typeName]||(attachmentsByType[typeName]=[]),attachmentsByType[typeName].push(attachment)}),Object.keys(attachmentsByType).forEach(typeName=>{const typeNode={name:typeName,type:"folder",level:2,path:`/${downloadConfig.mFormName}/${typeName}`,children:[],fileCount:attachmentsByType[typeName].length,id:generateId(),collapsed:!1};attachmentsByType[typeName].forEach(attachment=>{const fileNode={name:decodeFileName(attachment.asrName),type:"file",level:3,path:`/${downloadConfig.mFormName}/${typeName}/${decodeFileName(attachment.asrName)}`,fileInfo:{...attachment,asrFid:attachment.asrFid,asrName:attachment.asrName,fileSize:attachment.fileSize,uploadTime:attachment.uploadTime,typeName:attachment.typeName,asrRemark:attachment.asrRemark||"",asrSessionGuid:attachment.asrSessionGuid,bustypecode:attachment.bustypecode},id:generateId()};typeNode.children.push(fileNode),treeStructure.totalFiles++}),mainFormNode.children.push(typeNode),mainFormNode.fileCount+=typeNode.fileCount,treeStructure.totalFolders++})}rootNode.children.push(mainFormNode),treeStructure.totalFolders++}return downloadConfig.groupAttachments&&downloadConfig.sFormName&&downloadConfig.sFormName.forEach(formName=>{if(downloadConfig.groupAttachments[formName]){const groupFormNode={name:formName,type:"folder",level:1,path:`/${formName}`,children:[],fileCount:0,id:generateId(),collapsed:!1},groupAttachments=downloadConfig.groupAttachments[formName];if(groupAttachments.data&&groupAttachments.data.attachmentRecordList){const attachments=groupAttachments.data.attachmentRecordList,attachmentsByType={};attachments.forEach(attachment=>{const typeName=attachment.typeName||"未分类";attachmentsByType[typeName]||(attachmentsByType[typeName]=[]),attachmentsByType[typeName].push(attachment)}),Object.keys(attachmentsByType).forEach(typeName=>{const typeNode={name:typeName,type:"folder",level:2,path:`/${formName}/${typeName}`,children:[],fileCount:attachmentsByType[typeName].length,id:generateId(),collapsed:!1};attachmentsByType[typeName].forEach(attachment=>{const fileNode={name:decodeFileName(attachment.asrName),type:"file",level:3,path:`/${formName}/${typeName}/${decodeFileName(attachment.asrName)}`,fileInfo:{...attachment,asrFid:attachment.asrFid,asrName:attachment.asrName,fileSize:attachment.fileSize,uploadTime:attachment.uploadTime,typeName:attachment.typeName,asrRemark:attachment.asrRemark||"",asrSessionGuid:attachment.asrSessionGuid,bustypecode:attachment.bustypecode},id:generateId()};typeNode.children.push(fileNode),treeStructure.totalFiles++}),groupFormNode.children.push(typeNode),groupFormNode.fileCount+=typeNode.fileCount,treeStructure.totalFolders++})}rootNode.children.push(groupFormNode),treeStructure.totalFolders++}}),downloadConfig.detailAttachments&&downloadConfig.dFormName&&downloadConfig.dFormName.forEach(formName=>{if(downloadConfig.detailAttachments[formName]){const detailFormNode={name:formName,type:"folder",level:1,path:`/${formName}`,children:[],fileCount:0,id:generateId(),collapsed:!1},detailAttachments=downloadConfig.detailAttachments[formName];if(Array.isArray(detailAttachments)){const allAttachments=[];detailAttachments.forEach(detailItem=>{200===detailItem.code&&detailItem.data&&detailItem.data.attachmentRecordList&&allAttachments.push(...detailItem.data.attachmentRecordList)});const attachmentsByType={};allAttachments.forEach(attachment=>{const typeName=attachment.typeName||"未分类";attachmentsByType[typeName]||(attachmentsByType[typeName]=[]),attachmentsByType[typeName].push(attachment)}),Object.keys(attachmentsByType).forEach(typeName=>{const typeNode={name:typeName,type:"folder",level:2,path:`/${formName}/${typeName}`,children:[],fileCount:attachmentsByType[typeName].length,id:generateId(),collapsed:!1};attachmentsByType[typeName].forEach(attachment=>{const fileNode={name:decodeFileName(attachment.asrName),type:"file",level:3,path:`/${formName}/${typeName}/${decodeFileName(attachment.asrName)}`,fileInfo:{...attachment,asrFid:attachment.asrFid,asrName:attachment.asrName,fileSize:attachment.fileSize,uploadTime:attachment.uploadTime,typeName:attachment.typeName,asrRemark:attachment.asrRemark||"",asrSessionGuid:attachment.asrSessionGuid,bustypecode:attachment.bustypecode},id:generateId()};typeNode.children.push(fileNode),treeStructure.totalFiles++}),detailFormNode.children.push(typeNode),detailFormNode.fileCount+=typeNode.fileCount,treeStructure.totalFolders++})}rootNode.children.push(detailFormNode),treeStructure.totalFolders++}}),rootNode.fileCount=treeStructure.totalFiles,console.log("不带行标识树形结构构建完成:",treeStructure),treeStructure}function generateId(){return"node_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}function initModalInteractions(modal){const content=modal.querySelector(".modal-content"),header=modal.querySelector(".modal-header"),minimizeBtn=modal.querySelector(".minimize-btn"),maximizeBtn=modal.querySelector(".maximize-btn"),closeBtn=modal.querySelector(".close-btn"),cancelBtn=modal.querySelector(".cancel-btn"),confirmBtn=modal.querySelector(".confirm-btn"),toggleRowFolderBtn=modal.querySelector("#toggle-row-folder-btn");let isDragging=!1,isMaximized=!1,isMinimized=!1,dragOffset={x:0,y:0},currentTreeData=currentTreeType?treeStructure:NuTreeStructure;function updateToggleRowFolderButton(){toggleRowFolderBtn.innerHTML=""+(currentTreeType?'<svg t="1760600527572" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16994" width="20" height="20"><path d="M896 96c41.216 0 74.624 33.472 74.624 74.688v682.624c0 41.216-33.408 74.688-74.624 74.688H128a74.688 74.688 0 0 1-74.688-74.688V170.688C53.312 129.472 86.784 96 128 96h768zM117.312 853.312c0 5.888 4.8 10.688 10.688 10.688h138.624V373.312H117.312v480z m213.312 10.688H896a10.688 10.688 0 0 0 10.624-10.688v-480h-576V864z m-110.848-212.672a32 32 0 0 1 0 62.72l-6.464 0.64h-42.688a32 32 0 0 1 0-64h42.688l6.4 0.64z m0-170.688a32 32 0 0 1 0 62.72l-6.464 0.64h-42.688a32 32 0 1 1 0-64h42.688l6.4 0.64zM128 160a10.688 10.688 0 0 0-10.688 10.688v138.624h149.312V160H128z m202.624 149.312h576V170.688A10.688 10.688 0 0 0 896 160H330.624v149.312z" p-id="16995" fill="#1677FF"></path></svg>':'<svg t="1760600527572" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16994" width="20" height="20"><path d="M896 96c41.216 0 74.624 33.472 74.624 74.688v682.624c0 41.216-33.408 74.688-74.624 74.688H128a74.688 74.688 0 0 1-74.688-74.688V170.688C53.312 129.472 86.784 96 128 96h768zM117.312 853.312c0 5.888 4.8 10.688 10.688 10.688h138.624V373.312H117.312v480z m213.312 10.688H896a10.688 10.688 0 0 0 10.624-10.688v-480h-576V864z m-110.848-212.672a32 32 0 0 1 0 62.72l-6.464 0.64h-42.688a32 32 0 0 1 0-64h42.688l6.4 0.64z m0-170.688a32 32 0 0 1 0 62.72l-6.464 0.64h-42.688a32 32 0 1 1 0-64h42.688l6.4 0.64zM128 160a10.688 10.688 0 0 0-10.688 10.688v138.624h149.312V160H128z m202.624 149.312h576V170.688A10.688 10.688 0 0 0 896 160H330.624v149.312z" p-id="16995" fill="#bfbfbf"></path></svg>'),toggleRowFolderBtn.style.backgroundColor="",toggleRowFolderBtn.style.borderColor="",toggleRowFolderBtn.style.color=""}function onDrag(e){if(!isDragging)return;const x=e.clientX-dragOffset.x,y=e.clientY-dragOffset.y;content.style.left=x+"px",content.style.top=y+"px",content.style.transform="none"}function stopDrag(){isDragging=!1,document.removeEventListener("mousemove",onDrag),document.removeEventListener("mouseup",stopDrag)}function refreshTree(){document.getElementById("editable-tree").innerHTML="",initEditableTree(currentTreeData)}modal.querySelector("#reset-btn").addEventListener("click",()=>{treeStructure=buildTreeStructureWithRowFolder(downloadConfig),NuTreeStructure=buildTreeStructureWithoutRowFolder(downloadConfig),currentTreeData=currentTreeType?treeStructure:NuTreeStructure,refreshTree(),showToast("已还原默认树结构","success")}),updateToggleRowFolderButton(),toggleRowFolderBtn.addEventListener("click",()=>{currentTreeType=!currentTreeType,currentTreeData=currentTreeType?treeStructure:NuTreeStructure,updateToggleRowFolderButton(),refreshTree()}),header.addEventListener("mousedown",function(e){if(e.target.classList.contains("modal-btn"))return;isDragging=!0;const rect=content.getBoundingClientRect();dragOffset.x=e.clientX-rect.left,dragOffset.y=e.clientY-rect.top,document.addEventListener("mousemove",onDrag),document.addEventListener("mouseup",stopDrag)}),minimizeBtn.addEventListener("click",()=>{isMinimized=!isMinimized,isMinimized?(content.classList.add("minimized"),minimizeBtn.innerHTML="❐",minimizeBtn.title="还原"):(content.classList.remove("minimized"),minimizeBtn.innerHTML="−",minimizeBtn.title="最小化")}),maximizeBtn.addEventListener("click",()=>{isMaximized=!isMaximized,isMaximized?(content.classList.add("maximized"),maximizeBtn.innerHTML="⧉",maximizeBtn.title="还原"):(content.classList.remove("maximized"),maximizeBtn.innerHTML="□",maximizeBtn.title="最大化")}),closeBtn.addEventListener("click",()=>{modal.remove()}),cancelBtn.addEventListener("click",()=>{modal.remove()}),confirmBtn.addEventListener("click",()=>{editTreeStructure=JSON.parse(JSON.stringify(currentTreeType?treeStructure:NuTreeStructure)),console.log("编辑后的树结构:",editTreeStructure),modal.remove(),showToast("树结构已保存，开始下载附件","success"),async function(editedStructure,downloadConfig){if("undefined"==typeof JSZip)throw new Error("JSZip library not loaded");console.log("开始使用编辑后的结构下载附件:",editedStructure),console.log("下载配置:",downloadConfig);const zip=new JSZip;let totalFiles=0,downloadedFiles=0;const fileMap=function(downloadConfig){const fileMap={};if(downloadConfig.mainAttachment&&downloadConfig.mFormName){const mainAttachments=downloadConfig.mainAttachment[downloadConfig.mFormName];mainAttachments&&mainAttachments.data&&mainAttachments.data.attachmentRecordList&&mainAttachments.data.attachmentRecordList.forEach(attachment=>{const fileName=decodeFileName(attachment.asrName);fileMap[fileName]={asrFid:attachment.asrFid,asrName:attachment.asrName,typeName:attachment.typeName,asrRemark:attachment.asrRemark||""}})}if(downloadConfig.groupAttachments)for(const formName in downloadConfig.groupAttachments){const groupAttachments=downloadConfig.groupAttachments[formName];groupAttachments.data&&groupAttachments.data.attachmentRecordList&&groupAttachments.data.attachmentRecordList.forEach(attachment=>{const fileName=decodeFileName(attachment.asrName);fileMap[fileName]={asrFid:attachment.asrFid,asrName:attachment.asrName,typeName:attachment.typeName,asrRemark:attachment.asrRemark||""}})}if(downloadConfig.detailAttachments)for(const formName in downloadConfig.detailAttachments){const detailAttachments=downloadConfig.detailAttachments[formName];Array.isArray(detailAttachments)&&detailAttachments.forEach(detailItem=>{200===detailItem.code&&detailItem.data&&detailItem.data.attachmentRecordList&&detailItem.data.attachmentRecordList.forEach(attachment=>{const fileName=decodeFileName(attachment.asrName);fileMap[fileName]={asrFid:attachment.asrFid,asrName:attachment.asrName,typeName:attachment.typeName,asrRemark:attachment.asrRemark||""}})})}return console.log("文件映射表创建完成:",fileMap),fileMap}(downloadConfig);async function buildZipStructure(node,parentFolder){if("folder"===node.type||"root"===node.type){const currentFolder=(node.type,parentFolder.folder(node.name));if(node.children&&node.children.length>0)for(const child of node.children)await buildZipStructure(child,currentFolder)}else if("file"===node.type){totalFiles++,showToast(`正在下载文件 (${downloadedFiles+1}/${totalFiles}): ${node.name}`,"info",2e3);const fileData=function(fileNode,fileMap){if(fileMap[fileNode.name])return fileMap[fileNode.name];if(fileNode.fileInfo)return fileNode.fileInfo;const decodedName=decodeFileName(fileNode.name);if(fileMap[decodedName])return fileMap[decodedName];return null}(node,fileMap);if(fileData&&fileData.asrFid)try{const downloadUrl=await async function(asrFid,dataObject){try{const response=await fetch("/JFileSrv/api/getDownloadUrlByAsrFids",{method:"POST",headers:{dbToken:dataObject.dbToken||"0001","Content-Type":"application/json"},body:JSON.stringify({asrFids:[asrFid],loginId:dataObject.loginId||"3100000000000009",orgId:dataObject.orgId||"0",busTypeCode:dataObject.busTypeCode||"EFORM9000000080",wmDisabled:dataObject.wmDisabled||"1",billWM:dataObject.billWM||"YEIG"})});if(!response.ok)throw new Error(`HTTP error! status: ${response.status}`);const result=await response.json();return result.data&&result.data[asrFid]?result.data[asrFid]:null}catch(error){return console.error("Failed to get download URL for asrFid:",asrFid,error),null}}(fileData.asrFid,downloadConfig);if(downloadUrl){const fileContent=await async function(downloadUrl){try{const response=await fetch(downloadUrl);if(!response.ok)throw new Error(`HTTP error! status: ${response.status}`);return await response.blob()}catch(error){return console.error("Failed to download file content:",downloadUrl,error),null}}(downloadUrl);fileContent?(parentFolder.file(node.name,fileContent),downloadedFiles++,console.log(`文件下载完成: ${node.name}`)):(console.warn(`Failed to download content for file: ${node.name}`),parentFolder.file(node.name,""))}else console.warn(`Failed to get download URL for file: ${node.name}`),parentFolder.file(node.name,"")}catch(error){console.error(`下载文件失败 ${node.name}:`,error),parentFolder.file(node.name,"")}else console.warn(`未找到文件数据: ${node.name}`),parentFolder.file(node.name,"")}}await buildZipStructure(editedStructure.root,zip),zip.generateAsync({type:"blob"}).then(function(content){const link=document.createElement("a");return link.href=URL.createObjectURL(content),link.download=editedStructure.root.name+".zip",document.body.appendChild(link),link.click(),document.body.removeChild(link),URL.revokeObjectURL(link.href),showToast(`加载完成！总共 ${downloadedFiles} 个文件`,"success"),!0})}(editTreeStructure,downloadConfig)}),initEditableTree(currentTreeData)}function initEditableTree(treeData){const treeContainer=document.getElementById("editable-tree");let selectedNode=null,dragNode=null,searchResults=[],currentSearchIndex=-1,isAllExpanded=!1;renderTree(treeData.root,treeContainer),document.getElementById("add-folder-btn").addEventListener("click",()=>{addNewNode(selectedNode||treeData.root,"folder")}),document.getElementById("delete-btn").addEventListener("click",()=>{selectedNode&&"root"!==selectedNode.type?function(node){const parent=findParent(treeData.root,node);if(parent&&parent.children){const index=parent.children.indexOf(node);index>-1&&(parent.children.splice(index,1),selectedNode=null,refreshTree(),updateToolbarState(),showToast("节点已删除","success"))}}(selectedNode):showToast("请选择要删除的节点","warning")});document.getElementById("preview-btn").addEventListener("click",()=>{selectedNode&&"file"===selectedNode.type&&function(fileNode){if(!fileNode||"file"!==fileNode.type)return void showToast("请选择有效的文件进行预览","warning");const fileInfo=fileNode.fileInfo;if(!fileInfo)return void showToast("文件信息不完整，无法预览","error");$NG.confirm("确定打开预览？",{onOk:async()=>{try{const openUrl="https://ynnterp-mproject.cnyeig.com/JFileSrv/preview/fileSource",title=fileInfo.asrName||"文件预览",previewParams={AppTitle:title,name:title,guid:fileInfo.asrSessionGuid||"",fid:fileInfo.asrFid||"",language:"zh-CN",dbToken:downloadConfig.dbToken||"0001",busTypeCode:fileInfo.bustypecode||downloadConfig.busType||"design_data",asrFill:"sys8",orgId:downloadConfig.orgId||1,wMDisabled:downloadConfig.wmDisabled||0,billWM:downloadConfig.billWM||"",previewType:"scroll",pureWeb:1};console.log("文件预览参数:",previewParams),$NG.open(openUrl,previewParams),showToast("正在打开文件预览...","success")}catch(error){console.error("文件预览失败:",error),showToast("文件预览打开失败: "+error.message,"error")}},onCancel:()=>{showToast("已取消预览","info")}})}(selectedNode)});const toggleExpandBtn=document.getElementById("toggle-expand-btn");toggleExpandBtn.addEventListener("click",()=>{isAllExpanded=!isAllExpanded,isAllExpanded?(expandAllNodes(treeData.root),toggleExpandBtn.textContent="折叠"):(collapseAllNodes(treeData.root),toggleExpandBtn.textContent="展开"),refreshTree()}),document.querySelectorAll(".expand-level-btn").forEach(btn=>{btn.addEventListener("click",e=>{const level=parseInt(e.target.dataset.level);expandToLevel(treeData.root,level),refreshTree(),showToast(`已展开到${level}级目录`,"success")})});const searchTypeSelect=document.getElementById("search-type"),searchInput=document.getElementById("search-input");function performSearch(){const searchType=searchTypeSelect.value,keyword=searchInput.value.trim();keyword?(searchResults=[],currentSearchIndex=-1,function searchNodes(node){if("file"===node.type){let match=!1;"filename"===searchType?match=node.name.toLowerCase().includes(keyword.toLowerCase()):"remark"===searchType&&(match=node.fileInfo&&node.fileInfo.asrRemark&&node.fileInfo.asrRemark.toLowerCase().includes(keyword.toLowerCase())),match&&(searchResults.push(node),function(targetNode,rootNode){const path=findNodePath(rootNode,targetNode);path&&path.forEach(node=>{"folder"!==node.type&&"root"!==node.type||(node.collapsed=!1)})}(node,treeData.root))}node.children&&node.children.forEach(child=>{searchNodes(child)})}(treeData.root),0===searchResults.length?showToast("未找到匹配的"+("filename"===searchType?"文件":"备注"),"info"):(showToast(`找到 ${searchResults.length} 个匹配结果`,"success"),document.querySelectorAll(".tree-node-content.search-match").forEach(el=>{el.classList.remove("search-match")}),searchResults.forEach(node=>{const nodeElement=document.querySelector(`[data-node-id="${node.id}"] .tree-node-content`);nodeElement&&nodeElement.classList.add("search-match")}),refreshTree(),function(){if(0===searchResults.length)return;currentSearchIndex=(currentSearchIndex+1)%searchResults.length;const currentNode=searchResults[currentSearchIndex],nodeElement=document.querySelector(`[data-node-id="${currentNode.id}"] .tree-node-content`);nodeElement&&(nodeElement.scrollIntoView({behavior:"smooth",block:"center"}),document.querySelectorAll(".tree-node-content.search-match").forEach(el=>{el.style.background="#fff9e6"}),nodeElement.style.background="#ffd666",showToast(`第 ${currentSearchIndex+1}/${searchResults.length} 个结果`,"info",1500))}())):showToast("请输入搜索关键词","warning")}function findNodePath(rootNode,targetNode,currentPath=[]){if(rootNode===targetNode)return[...currentPath,rootNode];if(rootNode.children)for(const child of rootNode.children){const path=findNodePath(child,targetNode,[...currentPath,rootNode]);if(path)return path}return null}function renderTree(node,container,level=0){const nodeElement=function(node,level){const nodeDiv=document.createElement("div");nodeDiv.className="tree-node",nodeDiv.dataset.nodeId=node.id;const contentDiv=document.createElement("div");if(contentDiv.className="tree-node-content",contentDiv.style.paddingLeft=20*level+"px","folder"===node.type||"root"===node.type){const expandBtn=document.createElement("span");expandBtn.className="node-expand",expandBtn.innerHTML=node.collapsed?"▶ ":"▼ ",expandBtn.addEventListener("click",e=>{e.stopPropagation(),function(node){node.collapsed=!node.collapsed,refreshTree()}(node)}),contentDiv.appendChild(expandBtn)}else{const spacer=document.createElement("span");spacer.className="node-expand",spacer.style.width="18px",contentDiv.appendChild(spacer)}const icon=document.createElement("span");icon.className="node-icon",icon.innerHTML=function(node){switch(node.type){case"root":return'<svg t="1760581609068" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2020" width="20" height="20"><path d="M32 128a64 64 0 0 1 64-64h464.128a64 64 0 0 1 45.312 18.752L714.688 192H32V128zM32 256h896a64 64 0 0 1 64 64v544a64 64 0 0 1-64 64h-832a64 64 0 0 1-64-64V256zM192 672v64a32 32 0 0 0 64 0v-64a32 32 0 0 0-64 0z m192 0a32 32 0 0 0-64 0v64a32 32 0 0 0 64 0v-64z m64 0v64a32 32 0 0 0 64 0v-64a32 32 0 0 0-64 0z" fill="#FF9B29" p-id="2021"></path></svg>';case"folder":return node.collapsed,'<svg t="1760581533162" class="icon" viewBox="0 0 1152 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1798" width="20" height="20"><path d="M838.782362 1023.6801H183.627098A184.262418 184.262418 0 0 1 0.00448 838.138082V185.542018A184.262418 184.262418 0 0 1 183.627098 0h87.012808a77.223868 77.223868 0 0 1 48.624805 17.274602l113.244611 93.730709a74.536707 74.536707 0 0 0 47.985005 17.274602h358.288035a184.134458 184.134458 0 0 1 182.982818 185.542018v524.636051a184.134458 184.134458 0 0 1-182.982818 185.542018z" fill="#FFD05C" p-id="1799"></path><path d="M314.786111 442.549703h733.850671a104.41537 104.41537 0 0 1 95.97001 142.419494l-144.594814 372.427616a103.00781 103.00781 0 0 1-95.97001 66.219307H169.551497a104.09547 104.09547 0 0 1-95.97001-142.675414l145.234614-372.427616a103.77557 103.77557 0 0 1 95.97001-65.963387z m0 0" fill="#FCA235" p-id="1800"></path></svg>';case"file":return'<svg t="1760581379829" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1579" width="20" height="20"><path d="M951.466667 1013.333333h-874.666667c-14.933333 0-27.733333-12.8-27.733333-27.733333V38.4c0-14.933333 12.8-27.733333 27.733333-27.733333h518.4c211.2 0 381.866667 170.666667 381.866667 381.866666v593.066667c0 14.933333-10.666667 27.733333-25.6 27.733333z" fill="#F7F7F7" p-id="1580"></path><path d="M951.466667 1024h-874.666667c-21.333333 0-38.4-17.066667-38.4-38.4V38.4C38.4 17.066667 55.466667 0 76.8 0h518.4c217.6 0 392.533333 177.066667 392.533333 392.533333v593.066667c2.133333 21.333333-17.066667 38.4-36.266666 38.4zM76.8 21.333333c-8.533333 0-14.933333 8.533333-14.933333 17.066667v947.2c0 8.533333 6.4 17.066667 17.066666 17.066667h872.533334c8.533333 0 17.066667-6.4 17.066666-17.066667V392.533333C966.4 187.733333 800 21.333333 595.2 21.333333H76.8z" fill="#E8E8E8" p-id="1581"></path><path d="M704 349.866667H330.666667c-10.666667 0-17.066667 8.533333-17.066667 17.066666v14.933334c0 10.666667 8.533333 17.066667 17.066667 17.066666H704c10.666667 0 17.066667-8.533333 17.066667-17.066666v-14.933334c0-8.533333-8.533333-17.066667-17.066667-17.066666zM654.933333 535.466667c8.533333 0 14.933333-6.4 14.933334-14.933334v-19.2c0-8.533333-6.4-14.933333-14.933334-14.933333H369.066667c-8.533333 0-14.933333 6.4-14.933334 14.933333v19.2c0 8.533333 6.4 14.933333 14.933334 14.933334h285.866666zM704 616.533333H328.533333c-10.666667 0-17.066667 8.533333-17.066666 17.066667v12.8c0 10.666667 8.533333 17.066667 17.066666 17.066667H704c10.666667 0 17.066667-8.533333 17.066667-17.066667v-12.8c0-10.666667-8.533333-17.066667-17.066667-17.066667z" fill="#6E6E6E" p-id="1582"></path></svg>';default:return'<svg t="1760581740715" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3085" width="20" height="20"><path d="M512 0C227.555556 0 0 227.555556 0 512s227.555556 512 512 512 512-227.555556 512-512-227.555556-512-512-512z m45.511111 853.333333c-17.066667 11.377778-28.444444 17.066667-51.2 17.066667-17.066667 0-34.133333-5.688889-51.2-17.066667-17.066667-11.377778-22.755556-28.444444-22.755555-51.2s5.688889-34.133333 22.755555-51.2c11.377778-11.377778 28.444444-22.755556 51.2-22.755555s34.133333 5.688889 51.2 22.755555c11.377778 11.377778 22.755556 28.444444 22.755556 51.2s-11.377778 39.822222-22.755556 51.2z m176.355556-443.733333c-11.377778 22.755556-22.755556 39.822222-39.822223 51.2-17.066667 17.066667-39.822222 39.822222-79.644444 73.955556l-28.444444 28.444444c-5.688889 5.688889-11.377778 17.066667-17.066667 22.755556v17.066666c0 5.688889-5.688889 17.066667-5.688889 34.133334-5.688889 34.133333-22.755556 51.2-56.888889 51.2-17.066667 0-28.444444-5.688889-39.822222-17.066667-11.377778-11.377778-17.066667-28.444444-17.066667-45.511111 0-28.444444 5.688889-51.2 11.377778-68.266667 5.688889-17.066667 17.066667-34.133333 34.133333-51.2 11.377778-17.066667 34.133333-34.133333 56.888889-51.2 22.755556-17.066667 34.133333-28.444444 45.511111-39.822222s17.066667-17.066667 22.755556-28.444445c5.688889-11.377778 11.377778-22.755556 11.377778-34.133333 0-22.755556-11.377778-45.511111-28.444445-62.577778-17.066667-17.066667-45.511111-28.444444-73.955555-28.444444-45.511111-11.377778-73.955556 0-85.333334 17.066667-17.066667 17.066667-34.133333 45.511111-45.511111 79.644444-11.377778 34.133333-28.444444 51.2-62.577778 51.2-17.066667 0-34.133333-5.688889-45.511111-17.066667-11.377778-11.377778-17.066667-28.444444-17.066666-39.822222 0-28.444444 11.377778-62.577778 28.444444-91.022222s45.511111-56.888889 85.333333-79.644445c39.822222-22.755556 79.644444-28.444444 130.844445-28.444444 45.511111 0 85.333333 5.688889 119.466667 22.755556 34.133333 17.066667 62.577778 39.822222 79.644444 68.266666 22.755556 28.444444 34.133333 62.577778 34.133333 96.711111 0 28.444444-5.688889 51.2-17.066666 68.266667z" fill="#FF7E11" p-id="3086"></path></svg>'}}(node),contentDiv.appendChild(icon);const nameSpan=document.createElement("span");nameSpan.className="node-name","file"===node.type&&node.fileInfo&&node.fileInfo.asrRemark?nameSpan.innerHTML=`${node.name} <span style="color: #999; font-size: 12px; margin-left: 8px;">${node.fileInfo.asrRemark}</span>`:nameSpan.textContent=node.name;return nameSpan.addEventListener("dblclick",()=>{!function(element,node){const input=document.createElement("input");input.type="text",input.value=node.name,input.style.cssText="\n                color: #000000 !important;\n                background: white;\n                border: none;\n                outline: none;\n                width: 100%;\n                font-size: 14px;\n                font-family: inherit;\n                padding: 0;\n                margin: 0;\n            ";const parent=element.parentNode,wrapper=document.createElement("span");function saveEdit(){const newName=input.value.trim();newName&&newName!==node.name?(node.name=newName,refreshTree()):refreshTree()}wrapper.className="node-name editing",wrapper.appendChild(input),parent.replaceChild(wrapper,element),input.focus(),input.select(),input.addEventListener("blur",saveEdit),input.addEventListener("keypress",e=>{"Enter"===e.key&&saveEdit()})}(nameSpan,node)}),contentDiv.appendChild(nameSpan),contentDiv.addEventListener("click",e=>{e.stopPropagation(),function(node,element){document.querySelectorAll(".tree-node-content.selected").forEach(el=>{el.classList.remove("selected")}),element.classList.add("selected"),selectedNode=node,updateToolbarState()}(node,contentDiv),updateToolbarState()}),contentDiv.draggable=!0,contentDiv.addEventListener("dragstart",e=>{dragNode=node,contentDiv.classList.add("dragging"),e.dataTransfer.setData("text/plain",node.id);const ghost=contentDiv.cloneNode(!0);ghost.classList.add("drag-ghost"),document.body.appendChild(ghost),e.dataTransfer.setDragImage(ghost,0,0),setTimeout(()=>document.body.removeChild(ghost),0)}),contentDiv.addEventListener("dragend",()=>{contentDiv.classList.remove("dragging"),document.querySelectorAll(".tree-node-content").forEach(el=>{el.classList.remove("drop-target")}),dragNode=null}),contentDiv.addEventListener("dragover",e=>{e.preventDefault(),dragNode&&canDrop(dragNode,node)&&contentDiv.classList.add("drop-target")}),contentDiv.addEventListener("dragleave",()=>{contentDiv.classList.remove("drop-target")}),contentDiv.addEventListener("drop",e=>{e.preventDefault(),contentDiv.classList.remove("drop-target"),dragNode&&canDrop(dragNode,node)&&function(draggedNode,targetNode){const oldParent=findParent(treeData.root,draggedNode);if(oldParent&&oldParent.children){const index=oldParent.children.indexOf(draggedNode);index>-1&&(oldParent.children.splice(index,1),targetNode.children||(targetNode.children=[]),targetNode.children.push(draggedNode),updateNodeLevel(draggedNode,targetNode.level+1),refreshTree(),showToast("节点已移动","success"))}}(dragNode,node)}),nodeDiv.appendChild(contentDiv),nodeDiv}(node,level);if(container.appendChild(nodeElement),node.children&&node.children.length>0&&!node.collapsed){const childrenContainer=document.createElement("div");childrenContainer.className="node-children",node.children.forEach(child=>{renderTree(child,childrenContainer,level+1)}),nodeElement.appendChild(childrenContainer)}}function addNewNode(parentNode,type){if("file"===type&&"file"===parentNode.type)return void showToast("不能在文件下添加子节点","error");const newNode={id:generateId(),name:"folder"===type?"新建文件夹":"新建文件",type:type,level:parentNode.level+1,children:"folder"===type?[]:void 0,fileCount:0,collapsed:"folder"===type};parentNode.children||(parentNode.children=[]),parentNode.children.push(newNode),"folder"!==parentNode.type&&"root"!==parentNode.type||(parentNode.collapsed=!1),refreshTree(),showToast("已添加"+("folder"===type?"文件夹":"文件"),"success")}function canDrop(draggedNode,targetNode){return draggedNode!==targetNode&&("file"!==targetNode.type&&!isDescendant(draggedNode,targetNode))}function updateNodeLevel(node,newLevel){node.level=newLevel,node.children&&node.children.forEach(child=>{updateNodeLevel(child,newLevel+1)})}function isDescendant(parent,child){if(!parent.children)return!1;for(const node of parent.children){if(node===child)return!0;if(isDescendant(node,child))return!0}return!1}function findParent(root,targetNode){if(root.children)for(const child of root.children){if(child===targetNode)return root;const parent=findParent(child,targetNode);if(parent)return parent}return null}function expandAllNodes(node){node.collapsed=!1,node.children&&node.children.forEach(child=>{expandAllNodes(child)})}function collapseAllNodes(node){"folder"!==node.type&&"root"!==node.type||(node.collapsed=!0),node.children&&node.children.forEach(child=>{collapseAllNodes(child)})}function expandToLevel(node,targetLevel,currentLevel=0){"folder"!==node.type&&"root"!==node.type||(node.collapsed=currentLevel>=targetLevel,node.children&&node.children.forEach(child=>{expandToLevel(child,targetLevel,currentLevel+1)}))}function updateToolbarState(){const deleteBtn=document.getElementById("delete-btn"),addFolderBtn=document.getElementById("add-folder-btn"),previewBtn=document.getElementById("preview-btn");selectedNode?(deleteBtn.disabled="root"===selectedNode.type,addFolderBtn.disabled="file"===selectedNode.type,previewBtn.disabled="file"!==selectedNode.type,console.log("选中节点:",selectedNode.name,"删除按钮禁用:",deleteBtn.disabled,"预览按钮禁用:",previewBtn.disabled)):(deleteBtn.disabled=!0,addFolderBtn.disabled=!1,previewBtn.disabled=!0,console.log("没有选中节点，删除按钮禁用")),function(deleteBtn){deleteBtn.disabled?deleteBtn.innerHTML='<svg t="1760601704642" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="20160" width="20" height="20"><path d="M762.023564 733.556364l78.978327 78.959709 78.996945-78.978328a37.236364 37.236364 0 1 1 52.670837 52.670837l-79.015564 78.978327 79.015564 78.996946a37.236364 37.236364 0 0 1-52.670837 52.670836l-78.996945-79.015564-78.978327 79.015564a37.236364 37.236364 0 0 1-52.652219-52.670836l78.95971-78.996946-78.95971-78.978327a37.236364 37.236364 0 1 1 52.652219-52.670837zM800.581818 0a111.709091 111.709091 0 0 1 111.709091 111.709091v390.981818a37.236364 37.236364 0 1 1-72.927418-10.686836V130.327273a55.854545 55.854545 0 0 0-55.854546-55.854546H166.018327a55.854545 55.854545 0 0 0-55.761454 52.577746L110.163782 130.327273v744.727272a55.854545 55.854545 0 0 0 52.559127 55.761455l3.295418 0.093091h345.199709v0.986764a37.236364 37.236364 0 0 1 0 72.4992V1005.381818H148.945455a111.709091 111.709091 0 0 1-111.709091-111.709091V111.709091a111.709091 111.709091 0 0 1 111.709091-111.709091h651.636363zM577.163636 167.563636a111.709091 111.709091 0 1 1-80.989091 188.639419l-85.4016 49.282327a112.118691 112.118691 0 0 1 14.801455 84.1728l86.984145 50.213236a111.709091 111.709091 0 1 1-25.711709 49.654691l-86.667636-50.045673a111.709091 111.709091 0 1 1-32.395636-173.298036c0.949527-0.8192 2.048-1.545309 3.165091-2.196945l98.061963-56.617891A111.709091 111.709091 0 0 1 577.163636 167.563636z m18.618182 390.981819a55.854545 55.854545 0 1 0 0 111.70909 55.854545 55.854545 0 0 0 0-111.70909z m-279.272727-148.945455a55.854545 55.854545 0 1 0 0 111.709091 55.854545 55.854545 0 0 0 0-111.709091z m260.654545-186.181818a55.854545 55.854545 0 1 0 0 111.709091 55.854545 55.854545 0 0 0 0-111.709091z" fill="#1677FF" p-id="20161"></path></svg>':deleteBtn.innerHTML='<svg t="1760597078657" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="14537" width="20" height="20"><path d="M762.023564 733.556364l78.978327 78.959709 78.996945-78.978328a37.236364 37.236364 0 1 1 52.670837 52.670837l-79.015564 78.978327 79.015564 78.996946a37.236364 37.236364 0 0 1-52.670837 52.670836l-78.996945-79.015564-78.978327 79.015564a37.236364 37.236364 0 0 1-52.652219-52.670836l78.95971-78.996946-78.95971-78.978327a37.236364 37.236364 0 1 1 52.652219-52.670837zM800.581818 0a111.709091 111.709091 0 0 1 111.709091 111.709091v390.981818a37.236364 37.236364 0 1 1-72.927418-10.686836V130.327273a55.854545 55.854545 0 0 0-55.854546-55.854546H166.018327a55.854545 55.854545 0 0 0-55.761454 52.577746L110.163782 130.327273v744.727272a55.854545 55.854545 0 0 0 52.559127 55.761455l3.295418 0.093091h345.199709v0.986764a37.236364 37.236364 0 0 1 0 72.4992V1005.381818H148.945455a111.709091 111.709091 0 0 1-111.709091-111.709091V111.709091a111.709091 111.709091 0 0 1 111.709091-111.709091h651.636363zM577.163636 167.563636a111.709091 111.709091 0 1 1-80.989091 188.639419l-85.4016 49.282327a112.118691 112.118691 0 0 1 14.801455 84.1728l86.984145 50.213236a111.709091 111.709091 0 1 1-25.711709 49.654691l-86.667636-50.045673a111.709091 111.709091 0 1 1-32.395636-173.298036c0.949527-0.8192 2.048-1.545309 3.165091-2.196945l98.061963-56.617891A111.709091 111.709091 0 0 1 577.163636 167.563636z m18.618182 390.981819a55.854545 55.854545 0 1 0 0 111.70909 55.854545 55.854545 0 0 0 0-111.70909z m-279.272727-148.945455a55.854545 55.854545 0 1 0 0 111.709091 55.854545 55.854545 0 0 0 0-111.709091z m260.654545-186.181818a55.854545 55.854545 0 1 0 0 111.709091 55.854545 55.854545 0 0 0 0-111.709091z" fill="#1677FF" p-id="14538"></path></svg>'}(deleteBtn),function(previewBtn){previewBtn.disabled,previewBtn.innerHTML='<svg t="1760665298888" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3435" width="20" height="20"><path d="M576 992H128a32 32 0 0 1-32-32V64A32 32 0 0 1 128 32h768a32 32 0 0 1 32 32v576a32 32 0 0 1-64 0V96h-704v832H576a32 32 0 0 1 0 64z" fill="#1677FF" p-id="3436"></path><path d="M768 288H256a32 32 0 0 1 0-64h512a32 32 0 0 1 0 64zM448 544H256a32 32 0 0 1 0-64h192a32 32 0 0 1 0 64zM384 800H256a32 32 0 0 1 0-64h128a32 32 0 0 1 0 64zM640 896a192 192 0 1 1 192-192 192 192 0 0 1-192 192z m0-320a128 128 0 1 0 128 128 128 128 0 0 0-128-128z" fill="#1677FF" p-id="3437"></path><path d="M896 992a32 32 0 0 1-21.76-8.32l-138.24-128a32.64 32.64 0 0 1 44.16-47.36l137.6 128a32.64 32.64 0 0 1 0 45.44 32 32 0 0 1-21.76 10.24z" fill="#1677FF" p-id="3438"></path></svg>'}(previewBtn)}function refreshTree(){treeContainer.innerHTML="",renderTree(treeData.root,treeContainer),updateToolbarState(),selectedNode&&!nodeExists(treeData.root,selectedNode.id)&&(selectedNode=null,updateToolbarState())}function nodeExists(root,nodeId){if(root.id===nodeId)return!0;if(root.children)for(const child of root.children)if(nodeExists(child,nodeId))return!0;return!1}document.getElementById("search-btn").addEventListener("click",performSearch),searchInput.addEventListener("keypress",e=>{"Enter"===e.key&&performSearch()}),updateToolbarState(),expandToLevel(treeData.root,2),refreshTree()}function showTreeEditModal(){initModalInteractions(function(){const existingModal=document.getElementById("tree-edit-modal");existingModal&&existingModal.remove();const modal=document.createElement("div");modal.id="tree-edit-modal",modal.innerHTML='\n        <div class="modal-overlay"></div>\n        <div class="modal-content">\n            <div class="modal-header">\n                <h3>\n\t\t\t\t\t文件树编辑</h3>\n                <div class="modal-controls">\n                    <button class="modal-btn minimize-btn" title="最小化">−</button>\n                    <button class="modal-btn maximize-btn" title="最大化">□</button>\n                    <button class="modal-btn close-btn" title="关闭">×</button>\n                </div>\n            </div>\n            <div class="modal-body">\n                <div class="toolbar">\n                    <button class="icon-button" id="reset-btn" title="还原默认结构">\n\t\t\t\t\t<svg t="1760596744739" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4323" width="20" height="20"><path d="M828.586019 442.570786c-33.495897-10.623699-68.366625-15.99804-103.362339-15.99804-94.238456-0.124985-184.352417 38.870238-248.719532 107.611818-0.999878 1.124862-2.374709 1.749786-3.874526 1.749785-9.123882 0.249969-18.247765 0.374954-27.621616 0.374954C222.910212 536.309303 42.807275 476.066683 42.807275 402.200731v-78.615369c0-4.374464 4.749418-6.999143 8.498958-4.624434 87.989222 56.868034 241.095466 83.239803 393.701773 83.239803s305.712551-26.496754 393.701772-83.239803c3.624556-2.374709 8.498959 0.249969 8.498959 4.624434v78.615369c0 14.123269-6.499204 27.621616-18.622718 40.370054zM429.509904 938.510035C214.661223 935.760372 42.807275 876.642613 42.807275 804.526447v-78.740354c0-4.374464 4.874403-6.999143 8.498958-4.624434 75.615737 48.869014 199.475565 75.240783 329.709612 81.739988 2.749663 0.124985 4.874403 2.249724 5.249357 4.874402 5.499326 47.119228 20.622474 91.363808 43.244702 130.733986z m-44.119595-202.475197C191.66404 726.411016 42.807275 670.417875 42.807275 603.301097v-78.61537c0-4.374464 4.874403-6.999143 8.498958-4.624433 82.61488 53.368462 222.722717 79.990201 365.955172 82.989834 4.124495 0.124985 6.624189 4.374464 4.749418 7.99902-19.747581 38.12033-32.496019 80.240171-36.620514 124.98469zM445.008006 0c221.972809 0 402.200731 60.24262 402.200731 133.983587v67.116779c0 73.865952-180.227923 134.108572-402.200731 134.108572C222.910212 335.208938 42.807275 274.966317 42.807275 201.100366v-67.116779C42.807275 60.24262 222.910212 0 445.008006 0z m0 0" fill="#1677FF" p-id="4324"></path><path d="M725.348665 513.062151c67.866686-0.124985 132.858725 26.871708 180.852846 74.740845 47.994121 47.869136 74.990814 112.986159 74.990814 180.727861 0 67.741702-26.996693 132.858725-74.990814 180.727861s-112.986159 74.740844-180.852846 74.740845c-67.866686 0.124985-132.858725-26.871708-180.852846-74.740845-47.994121-47.869136-74.990814-112.986159-74.990814-180.727861 0-67.741702 26.996693-132.73374 74.990814-180.727861 47.994121-47.869136 112.986159-74.740844 180.852846-74.740845z m141.357684 382.578135c40.370055-194.226208-154.356092-203.600059-154.356092-203.600059l-0.124985-43.244703c-3.624556-18.12278-19.247642-7.124127-19.247642-7.124127l-103.862277 88.989099c-22.997183 16.24801-1.249847 28.121555-1.249847 28.121555l102.737415 88.48916c20.497489 15.373117 22.12229-8.24899 22.12229-8.248989v-40.120086c104.487201-32.496019 147.231964 96.613165 147.231965 96.613166 3.874525 7.374097 6.874158 0.124985 6.749173 0.124984zM445.008006 0.624923" fill="#1677FF" opacity=".5" p-id="4325"></path></svg>\n\t\t\t\t\t</button>\n                    <button class="icon-button" id="toggle-row-folder-btn" title="切换行标识显示">\n\t\t\t\t\t<svg t="1760596898460" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6582" width="20" height="20"><path d="M475.356 261.395L364.101 128.066H64.998v166.619H65V895.64h895.354V261.395H475.356z m313.079 634.244c-53.354 0-101.031-24.942-132.564-64.081a169.998 169.998 0 0 1-1.969-2.497H129.881V327.974h765.593v253.202l0.035 0.028c39.515 32.323 64.845 82.132 64.845 138.018 0.001 97.433-76.97 176.417-171.919 176.417z" fill="#1677FF" p-id="6583"></path><path d="M895.509 581.204l-0.035-0.028c-29.37-24.012-66.568-38.37-107.039-38.37-94.948 0-171.919 78.985-171.919 176.417 0 41.528 13.988 79.701 37.386 109.839 0.65 0.838 1.304 1.672 1.969 2.497 31.533 39.14 79.21 64.081 132.564 64.081 94.948 0 171.919-78.985 171.919-176.417 0.001-55.887-25.33-105.696-64.845-138.019z m17.387 167.041h-100.13v102.75h-48.661v-102.75h-100.13v-49.934h100.13v-102.75h48.661v102.75h100.13v49.934z" fill="#1677FF" p-id="6584"></path><path d="M812.766 698.312v-102.75h-48.661v102.75h-100.13v49.933h100.13v102.75h48.661v-102.75h100.13v-49.933z" fill="#ffffff" p-id="6585"></path></svg>\n\t\t\t\t\t</button>\n                    <button class="icon-button" id="add-folder-btn" title="添加文件夹">\n\t\t\t\t\t<svg t="1760596898460" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6582" width="20" height="20"><path d="M475.356 261.395L364.101 128.066H64.998v166.619H65V895.64h895.354V261.395H475.356z m313.079 634.244c-53.354 0-101.031-24.942-132.564-64.081a169.998 169.998 0 0 1-1.969-2.497H129.881V327.974h765.593v253.202l0.035 0.028c39.515 32.323 64.845 82.132 64.845 138.018 0.001 97.433-76.97 176.417-171.919 176.417z" fill="#1677FF" p-id="6583"></path><path d="M895.509 581.204l-0.035-0.028c-29.37-24.012-66.568-38.37-107.039-38.37-94.948 0-171.919 78.985-171.919 176.417 0 41.528 13.988 79.701 37.386 109.839 0.65 0.838 1.304 1.672 1.969 2.497 31.533 39.14 79.21 64.081 132.564 64.081 94.948 0 171.919-78.985 171.919-176.417 0.001-55.887-25.33-105.696-64.845-138.019z m17.387 167.041h-100.13v102.75h-48.661v-102.75h-100.13v-49.934h100.13v-102.75h48.661v102.75h100.13v49.934z" fill="#1677FF" p-id="6584"></path><path d="M812.766 698.312v-102.75h-48.661v102.75h-100.13v49.933h100.13v102.75h48.661v-102.75h100.13v-49.933z" fill="#ffffff" p-id="6585"></path></svg>\n\t\t\t\t\t</button>\n                    <button class="icon-button" id="delete-btn" title="删除选中项">\n\t\t\t\t\t<svg t="1760601704642" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="20160" width="20" height="20"><path d="M762.023564 733.556364l78.978327 78.959709 78.996945-78.978328a37.236364 37.236364 0 1 1 52.670837 52.670837l-79.015564 78.978327 79.015564 78.996946a37.236364 37.236364 0 0 1-52.670837 52.670836l-78.996945-79.015564-78.978327 79.015564a37.236364 37.236364 0 0 1-52.652219-52.670836l78.95971-78.996946-78.95971-78.978327a37.236364 37.236364 0 1 1 52.652219-52.670837zM800.581818 0a111.709091 111.709091 0 0 1 111.709091 111.709091v390.981818a37.236364 37.236364 0 1 1-72.927418-10.686836V130.327273a55.854545 55.854545 0 0 0-55.854546-55.854546H166.018327a55.854545 55.854545 0 0 0-55.761454 52.577746L110.163782 130.327273v744.727272a55.854545 55.854545 0 0 0 52.559127 55.761455l3.295418 0.093091h345.199709v0.986764a37.236364 37.236364 0 0 1 0 72.4992V1005.381818H148.945455a111.709091 111.709091 0 0 1-111.709091-111.709091V111.709091a111.709091 111.709091 0 0 1 111.709091-111.709091h651.636363zM577.163636 167.563636a111.709091 111.709091 0 1 1-80.989091 188.639419l-85.4016 49.282327a112.118691 112.118691 0 0 1 14.801455 84.1728l86.984145 50.213236a111.709091 111.709091 0 1 1-25.711709 49.654691l-86.667636-50.045673a111.709091 111.709091 0 1 1-32.395636-173.298036c0.949527-0.8192 2.048-1.545309 3.165091-2.196945l98.061963-56.617891A111.709091 111.709091 0 0 1 577.163636 167.563636z m18.618182 390.981819a55.854545 55.854545 0 1 0 0 111.70909 55.854545 55.854545 0 0 0 0-111.70909z m-279.272727-148.945455a55.854545 55.854545 0 1 0 0 111.709091 55.854545 55.854545 0 0 0 0-111.709091z m260.654545-186.181818a55.854545 55.854545 0 1 0 0 111.709091 55.854545 55.854545 0 0 0 0-111.709091z" fill="#1677FF" p-id="20161"></path></svg>\n\t\t\t\t\t</button>\n                    <button class="icon-button" id="preview-btn" title="预览文件" disabled>\n\t\t\t\t\t<svg t="1760665298888" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3435" width="20" height="20"><path d="M576 992H128a32 32 0 0 1-32-32V64A32 32 0 0 1 128 32h768a32 32 0 0 1 32 32v576a32 32 0 0 1-64 0V96h-704v832H576a32 32 0 0 1 0 64z" fill="#1677FF" p-id="3436"></path><path d="M768 288H256a32 32 0 0 1 0-64h512a32 32 0 0 1 0 64zM448 544H256a32 32 0 0 1 0-64h192a32 32 0 0 1 0 64zM384 800H256a32 32 0 0 1 0-64h128a32 32 0 0 1 0 64zM640 896a192 192 0 1 1 192-192 192 192 0 0 1-192 192z m0-320a128 128 0 1 0 128 128 128 128 0 0 0-128-128z" fill="#1677FF" p-id="3437"></path><path d="M896 992a32 32 0 0 1-21.76-8.32l-138.24-128a32.64 32.64 0 0 1 44.16-47.36l137.6 128a32.64 32.64 0 0 1 0 45.44 32 32 0 0 1-21.76 10.24z" fill="#1677FF" p-id="3438"></path></svg>\n\t\t\t\t\t</button>\n                    \x3c!-- 搜索控件 --\x3e\n                    <div class="search-container">\n                        <select class="search-type-select" id="search-type">\n                            <option value="filename">按文件</option>\n                            <option value="remark">按备注</option>\n                        </select>\n                        <input type="text" class="search-input" id="search-input" placeholder="输入搜索关键词...">\n                        <button class="icon-button" id="search-btn" title="搜索">\n                            <svg t="1760758143032" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5831" width="20" height="20"><path d="M446.112323 177.545051c137.567677 0.219798 252.612525 104.59798 266.162424 241.493333 13.562828 136.895354-78.778182 261.818182-213.617777 289.008485-134.852525 27.203232-268.386263-52.156768-308.945455-183.608889s25.018182-272.252121 151.738182-325.779394A267.235556 267.235556 0 0 1 446.112323 177.545051m0-62.060607c-182.794343 0-330.989899 148.195556-330.989899 330.989899s148.195556 330.989899 330.989899 330.989899 330.989899-148.195556 330.989899-330.989899-148.195556-330.989899-330.989899-330.989899z m431.321212 793.341415a30.849293 30.849293 0 0 1-21.94101-9.102223l-157.220202-157.220202c-11.752727-12.179394-11.584646-31.534545 0.37495-43.50707 11.972525-11.972525 31.327677-12.140606 43.494141-0.37495l157.220202 157.220202a31.036768 31.036768 0 0 1 6.723232 33.810101 31.004444 31.004444 0 0 1-28.651313 19.174142z m0 0" p-id="5832" fill="#1677FF"></path></svg>\n                        </button>\n                    </div>\n                    <div class="expand-levels">\n                        <span style="display: inline-flex; justify-content: center; align-items: center;">\n\t\t\t\t\t\t\t<svg t="1760700387636" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1115" width="25" height="25"><path d="M832.128 768c33.194667 0 60.501333 25.173333 63.573333 57.813333L896 832a64 64 0 0 1-63.872 64h-298.922667A63.786667 63.786667 0 0 1 469.333333 832a64 64 0 0 1 63.872-64h298.922667zM213.333333 874.666667c-23.722667 0-42.666667-19.072-42.666666-42.624V362.666667A42.666667 42.666667 0 0 1 213.333333 320l4.992 0.298667c21.333333 2.432 37.674667 20.48 37.674667 42.325333L255.957333 490.666667h128.298667c21.248 0 39.594667 16.469333 42.112 37.674666L426.666667 533.333333l-0.298667 4.992a42.368 42.368 0 0 1-42.112 37.674667H256l0.042667 213.333333h128.256c22.869333 0 42.410667 19.114667 42.410666 42.666667l-0.298666 4.992a42.368 42.368 0 0 1-42.112 37.674667zM832.128 469.333333c33.194667 0 60.501333 25.173333 63.573333 57.813334L896 533.333333a64 64 0 0 1-63.872 64h-298.922667A63.786667 63.786667 0 0 1 469.333333 533.333333a64 64 0 0 1 63.872-64h298.922667z m-255.957333-341.333333c33.194667 0 60.458667 25.173333 63.573333 57.813333L640 192c0 35.328-29.013333 64-63.829333 64H191.829333A63.744 63.744 0 0 1 128 192C128 156.672 157.013333 128 191.829333 128h384.341334z" fill="#1677FF" p-id="1116"></path></svg>\n\t\t\t\t\t\t</span>\n                        <button class="toolbar-btn expand-level-btn" data-level="1">1级</button>\n                        <button class="toolbar-btn expand-level-btn" data-level="2">2级</button>\n                        <button class="toolbar-btn expand-level-btn" data-level="3">3级</button>\n                        <button class="toolbar-btn" id="toggle-expand-btn" title="切换展开/折叠">展开</button>\n                    </div>\n                </div>\n                <div class="tree-container">\n                    <div class="tree" id="editable-tree"></div>\n                </div>\n            </div>\n            <div class="modal-footer">\n                <button class="footer-btn cancel-btn">取消</button>\n                <button class="footer-btn confirm-btn">确认下载</button>\n            </div>\n        </div>\n    ';const style=document.createElement("style");return style.textContent='\n            #tree-edit-modal {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                z-index: 999;\n                font-family: "Microsoft YaHei", "SimHei", "PingFang SC", sans-serif;\n            }\n            \n            .modal-overlay {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.6);\n                backdrop-filter: blur(1px);\n            }\n            \n            .modal-content {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                width: 800px;\n                height: 600px;\n                background: #ffffff;\n                border-radius: 4px;\n                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);\n                display: flex;\n                flex-direction: column;\n                overflow: hidden;\n                transition: all 0.3s ease;\n                border: 1px solid #d1d1d1;\n            }\n            \n            .modal-content.maximized {\n                width: 95% !important;\n                height: 95% !important;\n                top: 2.5% !important;\n                left: 2.5% !important;\n                transform: none !important;\n            }\n            \n            .modal-content.minimized {\n                height: 60px !important;\n                width: 300px !important;\n            }\n            \n            .modal-content.minimized .modal-body,\n            .modal-content.minimized .modal-footer {\n                display: none !important;\n            }\n            \n            .modal-header {\n                background: #F8F9FA;\n                color: black;\n                padding: 14px 20px;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                cursor: move;\n                user-select: none;\n                border-bottom: 1px solid #F8F9FA;\n            }\n            \n            .modal-header h3 {\n                margin: 0;\n                font-size: 16px;\n                font-weight: 600;\n                color: black;\n            }\n            \n            .modal-controls {\n                display: flex;\n                gap: 6px;\n            }\n            \n            .modal-btn {\n    background: rgba(0, 0, 0, 0.1);\n    color: rgba(255, 255, 255, 0.9);\n    width: 26px;\n    height: 26px;\n    border-radius: 3px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 14px;\n    font-weight: bold;\n    transition: all 0.2s;\n    border: none; /* 明确设置为无边框 */\n    outline: none; /* 移除焦点时的轮廓 */\n}\n\n.modal-btn:hover {\n    background: rgba(0, 0, 0, 0.1);\n    color: white;\n}\n\n.close-btn:hover {\n    background: #d32f2f;\n    color: white;\n}\n            \n            .modal-body {\n                flex: 1;\n                display: flex;\n                flex-direction: column;\n                overflow: hidden;\n                background: #f5f7fa;\n            }\n            \n            .toolbar {\n                padding: 12px 16px;\n                background: #ffffff;\n                border-bottom: 1px solid #e1e5eb;\n                display: flex;\n                gap: 8px;\n                flex-wrap: nowrap;\n                align-items: center;\n                overflow-x: auto;\n                min-height: 60px;\n            }\n            \n            .toolbar::-webkit-scrollbar {\n                height: 4px;\n            }\n            \n            .toolbar::-webkit-scrollbar-thumb {\n                background: #d1d1d1;\n                border-radius: 2px;\n            }\n            \n            /* 搜索控件样式 */\n            .search-container {\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                margin-left: 10px;\n                flex-shrink: 0;\n            }\n            \n            .search-type-select {\n                padding: 6px 8px;\n                border: 1px solid #d1d1d1;\n                border-radius: 4px;\n                background: white;\n                font-size: 13px;\n                color: #333;\n                outline: none;\n                min-width: 70px;\n                flex-shrink: 0;\n                height: 32px;\n                box-sizing: border-box;\n            }\n            \n            .search-type-select:focus {\n                border-color: #1677FF;\n            }\n            \n            .search-input {\n                padding: 6px 10px;\n                border: 1px solid #d1d1d1;\n                border-radius: 4px;\n                font-size: 13px;\n                width: 140px;\n                outline: none;\n                transition: border-color 0.2s;\n                flex-shrink: 0;\n                height: 32px;\n                box-sizing: border-box;\n            }\n            \n            .search-input:focus {\n                border-color: #1677FF;\n            }\n            \n            .search-btn {\n                padding: 6px;\n                border: none;\n                background: none;\n                cursor: pointer;\n                border-radius: 4px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: background-color 0.2s;\n                flex-shrink: 0;\n                height: 32px;\n                width: 32px;\n                box-sizing: border-box;\n            }\n            \n            .search-btn:hover {\n                background: #f0f4f8;\n            }\n            \n            .expand-levels {\n                display: flex;\n                align-items: center;\n                gap: 4px;\n                margin-left: auto;\n                font-size: 13px;\n                color: #666;\n                flex-shrink: 0;\n            }\n            \n            .expand-level-btn {\n                padding: 4px 8px;\n                font-size: 12px;\n                min-width: 30px;\n            }\n            \n            .toolbar-btn {\n                padding: 6px 12px;\n                border: 1px solid #d1d1d1;\n                background: #ffffff;\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 13px;\n                color: #333333;\n                transition: all 0.2s;\n                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);\n                white-space: nowrap;\n                flex-shrink: 0;\n            }\n            \n            .toolbar-btn:hover {\n                background: #f0f4f8;\n                border-color: #1677FF;\n                color: #1677FF;\n            }\n            \n            .toolbar-btn:disabled {\n                opacity: 0.5;\n                cursor: not-allowed;\n                background: #f5f5f5;\n                border-color: #d1d1d1;\n                color: #999999;\n            }\n\t\t\t\n\t\t\t\n\t\t\t/* 基础按钮样式 */\n.icon-button {\n    border: none;\n    background: none;\n    padding: 0;\n    margin: 0;\n    outline: none;\n    cursor: pointer;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.3s ease;\n    flex-shrink: 0;\n}\n\n/* 悬停效果 */\n.icon-button:hover {\n    transform: scale(1.1);\n}\n\n/* 激活效果 */\n.icon-button:active {\n    transform: scale(0.95);\n}\n\n/* 禁用状态 */\n.icon-button:disabled {\n    cursor: not-allowed;\n    opacity: 0.6;\n}\n\n/* 禁用状态下的SVG图标 - 变为灰色 */\n.icon-button:disabled svg {\n    filter: \n        grayscale(1) \n        brightness(0.7) \n        drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));\n}\n\n/* 自定义SVG样式 */\n.icon-button svg {\n    width: 30px;\n    height: 30px;\n    filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));\n    transition: filter 0.3s ease;\n}\n\t\t\t\n\t\t\t\n            \n            .tree-container {\n                flex: 1;\n                overflow: auto;\n                padding: 16px;\n                background: #ffffff;\n            }\n            \n            .tree {\n                min-height: 100%;\n            }\n            \n            .tree-node {\n                margin: 3px 0;\n                position: relative;\n            }\n            \n            .tree-node-content {\n                display: flex;\n                align-items: center;\n                padding: 0px 10px;\n                border-radius: 4px;\n                cursor: pointer;\n                transition: background 0.2s;\n                user-select: none;\n                border: 1px solid transparent;\n            }\n            \n            .tree-node-content:hover {\n                background: #f0f4f8;\n                border-color: #e1e5eb;\n            }\n            \n            .tree-node-content.selected {\n                background: #e3f2fd;\n                border: 1px solid #1677FF;\n            }\n            \n            .tree-node-content.dragging {\n                opacity: 0.5;\n                background: #bbdefb;\n            }\n            \n            .tree-node-content.drop-target {\n                background: #e8f5e8;\n                border: 1px dashed #4caf50;\n            }\n            \n            /* 搜索高亮样式 */\n            .tree-node-content.search-match {\n                background: #fff9e6;\n                border: 1px solid #ffc53d;\n            }\n            \n            .tree-node-content.search-match .node-name {\n                color: #d46b08;\n                font-weight: 600;\n            }\n            \n            .node-icon {\n                margin-right: 8px;\n                font-size: 16px;\n            }\n            \n            .node-expand {\n                margin-right: 6px;\n                cursor: pointer;\n                width: 18px;\n                text-align: center;\n                font-size: 12px;\n                color: #666666;\n            }\n            \n            .node-name {\n                flex: 1;\n                padding: 4px 6px;\n                border: 1px solid transparent;\n                border-radius: 3px;\n                min-height: 22px;\n                color: #333333;\n                font-size: 14px;\n            }\n            \n            .node-name.editing {\n                border-color: #1677FF;\n                background: white;\n                outline: none;\n                color: #000000 !important;\n            }\n            \n            .node-name.editing input {\n                color: #000000 !important;\n                background: white;\n                border: none;\n                outline: none;\n                width: 100%;\n                font-size: 14px;\n                font-family: inherit;\n            }\n            \n            .node-children {\n                margin-left: 24px;\n                display: block;\n            }\n            \n            .node-children.collapsed {\n                display: none;\n            }\n            \n            .drag-ghost {\n                position: absolute;\n                background: #1677FF;\n                color: white;\n                padding: 6px 10px;\n                border-radius: 4px;\n                pointer-events: none;\n                z-index: 1000;\n                opacity: 0.8;\n                transform: rotate(3deg);\n                font-size: 14px;\n                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);\n            }\n            \n            .modal-footer {\n                padding: 14px 20px;\n                background: #f8f9fa;\n                border-top: 1px solid #e1e5eb;\n                display: flex;\n                justify-content: flex-end;\n                gap: 12px;\n            }\n            \n            .footer-btn {\n                padding: 10px 24px;\n                border: 1px solid;\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 14px;\n                font-weight: 500;\n                transition: all 0.2s;\n                min-width: 80px;\n            }\n            \n            .cancel-btn {\n                background: #ffffff;\n                color: #666666;\n                border-color: #d1d1d1;\n            }\n            \n            .cancel-btn:hover {\n                background: #f5f5f5;\n                border-color: #999999;\n            }\n            \n            .confirm-btn {\n                background: #1677FF;\n                color: white;\n                border-color: #1677FF;\n            }\n            \n            .confirm-btn:hover {\n                background: #0d5cd6;\n                border-color: #0d5cd6;\n            }\n            \n            .empty-message {\n                text-align: center;\n                color: #999999;\n                padding: 40px;\n                font-style: italic;\n                font-size: 14px;\n            }\n            \n            /* 搜索结果统计 */\n            .search-results-info {\n                padding: 8px 16px;\n                background: #f0f4f8;\n                border-bottom: 1px solid #e1e5eb;\n                font-size: 13px;\n                color: #666;\n                display: none;\n            }\n            \n            .search-results-info.visible {\n                display: block;\n            }\n\t\t\t\n        ',document.head.appendChild(style),document.body.appendChild(modal),modal}())}function decodeFileName(fileName){try{return decodeURIComponent(fileName)}catch(e){return console.warn("文件名解码失败，使用原文件名:",fileName),fileName}}function showToast(message,type="info",duration=3e3){const existingToast=document.getElementById("custom-toast");existingToast&&existingToast.remove();const typeStyles={info:{backgroundColor:"rgba(24, 144, 255, 0.9)",icon:'<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M507.297959 862.040816c-52.244898 0-102.922449-9.404082-151.510204-27.689796l-116.506122 25.6c-24.032653 5.22449-46.497959 0-60.604082-14.628571-14.628571-14.628571-19.853061-36.571429-14.628571-60.604082l17.240816-77.844898c-43.363265-57.469388-66.35102-122.77551-66.35102-190.693877C114.938776 320.783673 291.004082 161.959184 507.297959 161.959184c107.62449 0 208.457143 36.04898 283.689796 101.877551C867.265306 330.710204 909.061224 420.04898 909.061224 516.179592c0 190.693878-180.244898 345.861224-401.763265 345.861224z" fill="#7BD4EF"></path><path d="M512 581.485714c-38.138776 0-69.485714-31.346939-69.485714-69.485714s31.346939-69.485714 69.485714-69.485714 69.485714 31.346939 69.485714 69.485714-31.346939 69.485714-69.485714 69.485714zM710.530612 581.485714c-38.138776 0-69.485714-31.346939-69.485714-69.485714s31.346939-69.485714 69.485714-69.485714 69.485714 31.346939 69.485715 69.485714-31.346939 69.485714-69.485715 69.485714zM313.469388 581.485714c-38.138776 0-69.485714-31.346939-69.485715-69.485714s31.346939-69.485714 69.485715-69.485714 69.485714 31.346939 69.485714 69.485714-31.346939 69.485714-69.485714 69.485714z" fill="#278DCA"></path></svg>'},success:{backgroundColor:"rgba(82, 196, 26, 0.9)",icon:'<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M512 85.333333C277.333333 85.333333 85.333333 277.333333 85.333333 512s192 426.666667 426.666667 426.666667 426.666667-192 426.666667-426.666667S746.666667 85.333333 512 85.333333z m277.333333 279.466667l-341.333333 341.333333c-4.266667 6.4-12.8 8.533333-21.333333 8.533334s-17.066667-2.133333-23.466667-8.533334l-170.666667-170.666666c-12.8-12.8-12.8-32 0-44.8 12.8-12.8 32-12.8 44.8 0l149.333334 147.2L746.666667 320c12.8-12.8 32-12.8 44.8 0 12.8 12.8 12.8 32-2.133334 44.8z" fill="#3BBC86"></path></svg>'},error:{backgroundColor:"rgba(245, 34, 45, 0.9)",icon:'<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M512 85.333333C277.333333 85.333333 85.333333 277.333333 85.333333 512s192 426.666667 426.666667 426.666667 426.666667-192 426.666667-426.666667S746.666667 85.333333 512 85.333333z m204.8 586.666667c12.8 10.666667 10.666667 32 0 44.8s-32 12.8-44.8 0L512 556.8l-160 160c-10.666667 12.8-32 12.8-44.8 0-12.8-10.666667-12.8-32 0-44.8l160-160-160-160c-12.8-10.666667-12.8-32 0-44.8 10.666667-12.8 32-12.8 44.8 0l160 160 160-162.133333c12.8-10.666667 34.133333-10.666667 44.8 2.133333 12.8 10.666667 12.8 32 0 44.8L556.8 512l160 160z" fill="#F25858"></path></svg>'},warning:{backgroundColor:"rgba(250, 173, 20, 0.9)",icon:'<svg viewBox="0 0 1217 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M1134.696569 1024H83.026578a83.026578 83.026578 0 0 1-83.026578-83.026578 79.705515 79.705515 0 0 1 3.597818-22.970687L0 913.297896 525.834995 55.356587h4.981595a82.694472 82.694472 0 0 1 156.089967 0H691.888152l490.963833 818.088551A83.026578 83.026578 0 0 1 1134.696569 1024z m-525.834995-110.702104a55.351052 55.351052 0 1 0-55.351052-55.351052 55.517105 55.517105 0 0 0 55.351052 55.351052z m0-636.5371a83.026578 83.026578 0 0 0-83.026579 83.026578l27.675527 304.430787a55.351052 55.351052 0 0 0 110.702104 0l27.675526-304.430787a83.026578 83.026578 0 0 0-83.026578-83.026578z" fill="#F4AA55"></path></svg>'},tip:{backgroundColor:"rgba(114, 46, 209, 0.9)",icon:'<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M512 0C231.131 0 0 231.131 0 512s231.131 512 512 512 512-231.131 512-512S792.869 0 512 0z m-51.2 219.429c0-8.778 5.851-14.629 14.629-14.629h73.142c8.778 0 14.629 5.851 14.629 14.629v73.142c0 8.778-5.851 14.629-14.629 14.629H475.43c-8.778 0-14.629-5.851-14.629-14.629V219.43zM614.4 804.57c0 8.778-7.314 14.629-14.629 14.629H475.43c-8.778 0-14.629-5.851-14.629-14.629V526.63c0-8.778-5.851-14.629-14.629-14.629H424.23c-7.315 0-14.629-5.851-14.629-14.629V424.23c0-8.778 7.314-14.629 14.629-14.629H548.57c8.778 0 14.629 5.851 14.629 14.629V702.17c0 8.778 5.851 14.629 14.629 14.629h21.942c7.315 0 14.629 5.851 14.629 14.629v73.142z" fill="#03A4FF"></path></svg>'}},style=typeStyles[type]||typeStyles.info,toast=document.createElement("div");toast.id="custom-toast",toast.style.cssText=`\n        position: fixed;\n        top: 20%;\n        left: 50%;\n        transform: translateX(-50%) translateY(0);\n        background-color: ${style.backgroundColor};\n        color: white;\n        padding: 16px 20px;\n        border-radius: 8px;\n        font-family: "Microsoft YaHei", "PingFang SC", "Helvetica Neue", Arial, sans-serif;\n        font-size: 14px;\n        font-weight: 500;\n        z-index: 1002;\n        opacity: 1;\n        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);\n        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        min-width: 240px;\n        max-width: 400px;\n        word-break: break-word;\n        line-height: 1.5;\n        border-left: 4px solid rgba(255, 255, 255, 0.3);\n    `;const iconContainer=document.createElement("div");iconContainer.style.cssText="\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        width: 20px;\n        height: 20px;\n        flex-shrink: 0;\n    ",iconContainer.innerHTML=style.icon;const messageContainer=document.createElement("div");messageContainer.style.cssText="\n        flex: 1;\n        display: flex;\n        align-items: center;\n        min-height: 20px;\n        line-height: 1.4;\n    ",messageContainer.textContent=message,toast.appendChild(iconContainer),toast.appendChild(messageContainer),document.body.appendChild(toast),toast.offsetHeight,setTimeout(()=>{toast.style.opacity="0",toast.style.transform="translateX(-50%) translateY(-40px)",setTimeout(()=>{toast.parentNode&&toast.parentNode.removeChild(toast)},500)},duration)}async function fetchAttachmentInfo(url,description){try{const response=await $NG.request.get({url:url,headers:{dbToken:"0001"}});return response&&200===response.code?(console.log(`${description}获取成功:`,response),response):(console.warn(`${description}响应码非200:`,response),null)}catch(error){return console.error(`获取${description}失败:`,error),null}}async function fetchDetailAttachments(dGuids,description="明细附件"){if(!dGuids||0===dGuids.length)return console.log(`没有dGuids可获取${description}`),[];const detailPromises=dGuids.map(async dGuid=>{const url=`/JFileSrv/reactAttach/tableAttachInit?asrSessionGuid=${dGuid}&busTypeCode=${cfg.busType}&asrFill=${fromObj.asrfill}&asrFillName=${fromObj.asrfillname}&asrTable=${fromObj.asrtable}&asrCode=${phidValue}&orgId=1&colAttach=0&uCode=0001`;try{const response=await fetchAttachmentInfo(url,`${description}-dGuid:${dGuid}`);return{dGuid:dGuid,response:response,success:!!response}}catch(error){return{dGuid:dGuid,response:null,success:!1,error:error}}}),validDetails=(await Promise.all(detailPromises)).filter(item=>item.success&&item.response).map(item=>item.response);return console.log(`${description}获取完成: 总共${dGuids.length}个, 有效${validDetails.length}个`),validDetails}function hasValidAttachments(downloadConfig){let hasValid=!1;if(downloadConfig.mainAttachment)for(const formName in downloadConfig.mainAttachment){const mainAttach=downloadConfig.mainAttachment[formName];mainAttach&&mainAttach.data&&mainAttach.data.attachmentRecordList&&mainAttach.data.attachmentRecordList.length>0&&(console.log(`主附件 ${formName} 有 ${mainAttach.data.attachmentRecordList.length} 个文件`),hasValid=!0)}if(downloadConfig.groupAttachments)for(const formName in downloadConfig.groupAttachments){const groupAttach=downloadConfig.groupAttachments[formName];groupAttach&&groupAttach.data&&groupAttach.data.attachmentRecordList&&groupAttach.data.attachmentRecordList.length>0&&(console.log(`分组附件 ${formName} 有 ${groupAttach.data.attachmentRecordList.length} 个文件`),hasValid=!0)}if(downloadConfig.detailAttachments)for(const formName in downloadConfig.detailAttachments){const detailAttachArray=downloadConfig.detailAttachments[formName];if(Array.isArray(detailAttachArray))for(const detailAttach of detailAttachArray)detailAttach&&detailAttach.data&&detailAttach.data.attachmentRecordList&&detailAttach.data.attachmentRecordList.length>0&&(console.log(`明细附件 ${formName} 有 ${detailAttach.data.attachmentRecordList.length} 个文件`),hasValid=!0)}return console.log("附件有效性检查结果:",hasValid),hasValid}console.log("Attachment Downloader Initialized"),console.log("---------phid---------"+phidValue);let fromObj={},attachmentData={mainAttachment:null,groupAttachments:{},detailAttachments:{}};async function mainExecution(){try{const params={phidValue:phidValue,busType:cfg.busType,tableName:cfg.tableName,mainTableNames:[cfg.tableName]};fromObj=await getFormAttachmentInfo(params),console.log("基础附件信息获取完成:",fromObj);const attachmentPromises=[];if(fromObj.asrfill&&fromObj.asrfillname&&fromObj.asrtable&&attachmentPromises.push((async()=>{const mainUrl=`/JFileSrv/reactAttach/tableAttachInit?busTypeCode=${cfg.busType}&asrFill=${fromObj.asrfill}&asrFillName=${fromObj.asrfillname}&asrTable=${fromObj.asrtable}&asrCode=${phidValue}&orgId=1&colAttach=0&uCode=0001`;attachmentData.mainAttachment=await fetchAttachmentInfo(mainUrl,"单据附件")})()),fromObj.mGuids&&fromObj.mGuids.length>0){const groupPromises=fromObj.mGuids.map(async mGuidObj=>{const formName=mGuidObj.formName,groupUrl=`/JFileSrv/reactAttach/tableAttachInit?asrSessionGuid=${mGuidObj.guid}&busTypeCode=${cfg.busType}&asrFill=${fromObj.asrfill}&asrFillName=${fromObj.asrfillname}&asrTable=${fromObj.asrtable}&asrCode=${phidValue}&orgId=1&colAttach=0&uCode=0001`,groupResponse=await fetchAttachmentInfo(groupUrl,`分组附件-${formName}`);groupResponse&&(attachmentData.groupAttachments[formName]=groupResponse,console.log(`分组附件 ${formName} (字段: ${mGuidObj.fieldName}) 获取成功`))});attachmentPromises.push(...groupPromises)}if(fromObj.detailGuids&&Object.keys(fromObj.detailGuids).length>0)for(const[formName,dGuids]of Object.entries(fromObj.detailGuids))dGuids&&dGuids.length>0&&attachmentPromises.push((async()=>{const detailAttachments=await fetchDetailAttachments(dGuids,`明细附件-${formName}`);detailAttachments.length>0&&(attachmentData.detailAttachments[formName]=detailAttachments)})());return attachmentPromises.length>0&&await Promise.allSettled(attachmentPromises),downloadConfig={mainAttachment:{[cfg.mFormName]:attachmentData.mainAttachment},groupAttachments:attachmentData.groupAttachments,detailAttachments:attachmentData.detailAttachments,topLevelFolderName:`${cfg.FormName}`,downloadUrl:"JFileSrv/api/getDownloadUrlByAsrFids",dbToken:"0001",wmDisabled:"1",billWM:"YEIG",orgId:"0",mFormName:cfg.mFormName,sFormName:cfg.sFormName,dFormName:cfg.dFormName},console.log("完整的下载配置:",downloadConfig),treeStructure=buildTreeStructureWithRowFolder(downloadConfig),NuTreeStructure=buildTreeStructureWithoutRowFolder(downloadConfig),console.log("文件树编辑功能初始化完成"),await new Promise((resolve,reject)=>{if("undefined"!=typeof JSZip)return void resolve(JSZip);const script=document.createElement("script");script.src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js",script.onload=()=>resolve(JSZip),script.onerror=()=>reject(new Error("Failed to load JSZip")),document.head.appendChild(script)}),console.log("JSZip加载完成"),{success:!0,message:"附件下载管理器初始化完成",hasAttachments:hasValidAttachments(downloadConfig)}}catch(error){return console.error("主执行流程出错:",error),showToast("处理附件时发生错误: "+error.message,"error"),{success:!1,message:"初始化失败: "+error.message,error:error}}}return{init:mainExecution(),showModal:function(){return hasValidAttachments(downloadConfig)?(showTreeEditModal(),!0):(console.warn("没有找到有效的附件数据"),$NG.alert("当前没有可下载的附件"),!1)},hasAttachments:()=>hasValidAttachments(downloadConfig),getConfig:()=>({...downloadConfig}),reinitialize:mainExecution}}"undefined"!=typeof module&&module.exports?module.exports=NGCollapse:window.NGCollapse=NGCollapse;class TableCellSuffixAppender{constructor(options){this.tableId=options.tableId,this.fieldSuffixMap=options.fieldSuffixMap||{},this.style=Object.assign({color:"#1890ff",fontSize:"inherit",marginLeft:"2px",fontWeight:"normal"},options.style||{}),this.observer=null,this.isObserving=!1,this.processedCells=new Set,this.initTimeout=null,this.maxRetries=10,this.retryCount=0}init(){this.waitForTableReady().then(()=>{this.processExistingRows(),this.startObserving()}).catch(err=>{console.warn(`表格初始化失败: ${err.message}`),this.retryCount<this.maxRetries&&(this.retryCount++,setTimeout(()=>this.init(),300))})}waitForTableReady(){return new Promise((resolve,reject)=>{(()=>{const tableContainer=document.getElementById(this.tableId);if(!tableContainer)return void reject(new Error(`表格容器未找到: ${this.tableId}`));tableContainer.querySelector(".table-row, .virtual-table-cell");resolve()})()})}processExistingRows(){const tableContainer=document.getElementById(this.tableId);if(!tableContainer)return void console.warn(`Table container with id "${this.tableId}" not found.`);this.processedCells.clear();tableContainer.querySelectorAll(".table-row").forEach(row=>this.processRow(row)),console.log(`已处理 ${this.processedCells.size} 个单元格`)}processRow(row){Object.keys(this.fieldSuffixMap).forEach(fieldKey=>{const suffixConfig=this.fieldSuffixMap[fieldKey];if(!suffixConfig||!suffixConfig.suffix)return;const cellSelector=`[data-key="${fieldKey}"]`,cell=row.querySelector(cellSelector);cell&&this.processCell(cell,fieldKey,suffixConfig)})}processCell(cell,fieldKey,suffixConfig){const cellId=this.generateCellId(cell,fieldKey);if(this.processedCells.has(cellId))return;this.processedCells.add(cellId);const numberElement=this.findNumberElement(cell);if(numberElement){const parentContainer=numberElement.closest(".editor-container")||numberElement.parentNode,existingSuffix=parentContainer.querySelector(".cell-suffix");if(existingSuffix)return void this.updateSuffixElement(existingSuffix,suffixConfig);const suffixElement=this.createSuffixElement(suffixConfig);parentContainer.appendChild(suffixElement)}}findNumberElement(cell){const anchorElements=cell.querySelectorAll("a");for(let i=0;i<anchorElements.length;i++){const anchor=anchorElements[i],text=anchor.textContent.trim();if(this.isNumberText(text))return anchor}const spanElements=cell.querySelectorAll("span");for(let i=spanElements.length-1;i>=0;i--){const span=spanElements[i],text=span.textContent.trim();if(this.isNumberText(text)){if(0===span.children.length)return span;if(!Array.from(span.children).some(child=>this.isNumberText(child.textContent.trim())))return span}}return null}isNumberText(text){if(!text)return!1;const cleanedText=text.replace(/,/g,"");return/^-?\d+(\.\d+)?$/.test(cleanedText)&&cleanedText.length>0}createSuffixElement(suffixConfig){const suffixSpan=document.createElement("span");return suffixSpan.className="cell-suffix",suffixSpan.textContent=suffixConfig.suffix,suffixSpan.style.color=this.style.color,suffixSpan.style.fontSize=this.style.fontSize,suffixSpan.style.marginLeft=this.style.marginLeft,suffixSpan.style.fontWeight=this.style.fontWeight,suffixSpan.style.display="inline-block",suffixConfig.style&&Object.assign(suffixSpan.style,suffixConfig.style),suffixSpan}updateSuffixElement(suffixElement,suffixConfig){suffixElement.textContent=suffixConfig.suffix,suffixConfig.style&&Object.assign(suffixElement.style,suffixConfig.style)}generateCellId(cell,fieldKey){const row=cell.closest(".table-row");if(!row)return`${fieldKey}_${Math.random()}`;return`${fieldKey}_${Array.from(row.parentNode.querySelectorAll(".table-row")).indexOf(row)}_${Array.from(row.querySelectorAll("[data-key]")).indexOf(cell)}`}startObserving(){const tableContainer=document.getElementById(this.tableId);if(!tableContainer||this.isObserving)return;this.observer=new MutationObserver(mutations=>{let shouldProcess=!1;mutations.forEach(mutation=>{if("childList"===mutation.type&&(mutation.addedNodes.length>0&&(shouldProcess=!0),mutation.removedNodes.length>0)){Array.from(mutation.removedNodes).filter(node=>1===node.nodeType&&node.classList&&(node.classList.contains("table-row")||node.querySelector(".table-row"))).length>0&&(shouldProcess=!0)}}),shouldProcess&&(clearTimeout(this.initTimeout),this.initTimeout=setTimeout(()=>{this.processExistingRows()},100))}),this.observer.observe(tableContainer,{childList:!0,subtree:!0});const contentArea=tableContainer.querySelector(".rows-container");contentArea&&this.observer.observe(contentArea,{childList:!0,subtree:!0}),this.isObserving=!0,console.log("开始监听表格变化")}stopObserving(){this.observer&&(this.observer.disconnect(),this.isObserving=!1,console.log("停止监听表格变化"))}forceRefresh(){const tableContainer=document.getElementById(this.tableId);if(tableContainer){tableContainer.querySelectorAll(".cell-suffix").forEach(suffix=>suffix.remove())}this.processedCells.clear(),setTimeout(()=>{this.processExistingRows()},200)}update(newOptions){newOptions.tableId&&(this.tableId=newOptions.tableId),newOptions.fieldSuffixMap&&(this.fieldSuffixMap=newOptions.fieldSuffixMap),newOptions.style&&Object.assign(this.style,newOptions.style),this.forceRefresh()}getStatus(){return{tableId:this.tableId,processedCells:this.processedCells.size,isObserving:this.isObserving}}destroy(){this.stopObserving(),this.processedCells.clear();const tableContainer=document.getElementById(this.tableId);if(tableContainer){tableContainer.querySelectorAll(".cell-suffix").forEach(suffix=>suffix.remove())}this.initTimeout&&clearTimeout(this.initTimeout)}}const suffixAppenderInstances=new Map;function safeInitTableCellSuffix(options){const key=options.tableId;suffixAppenderInstances.has(key)&&suffixAppenderInstances.get(key).destroy();const instance=new TableCellSuffixAppender(options);return instance.init(),suffixAppenderInstances.set(key,instance),window.refreshTableSuffix=function(){instance&&instance.forceRefresh()},instance}function addCharacterCounters(configs){Array.isArray(configs)?configs.forEach(config=>{const{selector:selector,limit:limit}=config;if(!selector||"number"!=typeof limit||limit<=0)return void console.error("无效的配置项:",config);const elements=document.querySelectorAll(selector);0!==elements.length?elements.forEach(element=>{initCharacterCounter(element,limit)}):console.warn(`未找到选择器为 "${selector}" 的元素`)}):console.error("参数必须是一个配置数组")}function initCharacterCounter(element,limit){const counter=document.createElement("div");counter.style.cssText="\n        position: absolute;\n        bottom: -20px;\n        right: 0;\n        font-size: 12px;\n        color: #666;\n        background: transparent;\n        padding: 2px 6px;\n        pointer-events: none;\n        z-index: 10;\n    ";const parent=element.parentElement;function truncateText(){element.value.length>limit&&(element.value=element.value.substring(0,limit),element.dispatchEvent(new Event("input",{bubbles:!0})))}function updateCounter(){const currentLength=element.value.length;counter.textContent=`${currentLength}/${limit}`,currentLength>=limit?(counter.style.color="#ff4d4f",element.style.borderColor="#ff4d4f"):currentLength>=.9*limit?(counter.style.color="#faad14",element.style.borderColor=""):(counter.style.color="#666",element.style.borderColor="")}parent&&"static"===window.getComputedStyle(parent).position&&(parent.style.position="relative"),parent.appendChild(counter),element.addEventListener("input",function(e){element.value.length>limit&&truncateText(),updateCounter()}),element.addEventListener("keydown",function(e){const currentLength=element.value.length,selectionLength=element.selectionEnd-element.selectionStart,key=e.key,isAllowedKey=!!key&&function(array,value){if(!array||!Array.isArray(array))return!1;for(let i=0;i<array.length;i++)if(array[i]===value)return!0;return!1}(["Backspace","Delete","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab","Home","End","Control","Alt","Meta","Shift","Escape"],key),isSingleCharInput=key&&1===key.length;currentLength>=limit&&!isAllowedKey&&!e.ctrlKey&&!e.metaKey&&0===selectionLength&&e.preventDefault(),selectionLength>0&&currentLength-selectionLength>=limit&&(isAllowedKey||e.ctrlKey||e.metaKey||!isSingleCharInput||e.preventDefault())}),element.addEventListener("paste",function(e){const currentLength=element.value.length,selectionLength=element.selectionEnd-element.selectionStart,clipboardData=e.clipboardData||window.clipboardData;if(!clipboardData)return void e.preventDefault();const pastedText=clipboardData.getData("text");if(currentLength-selectionLength+pastedText.length>limit){e.preventDefault();const allowedChars=limit-(currentLength-selectionLength);if(allowedChars>0){const textToPaste=pastedText.substring(0,allowedChars),start=element.selectionStart,end=element.selectionEnd;element.value=element.value.substring(0,start)+textToPaste+element.value.substring(end),element.selectionStart=element.selectionEnd=start+textToPaste.length,element.dispatchEvent(new Event("input",{bubbles:!0}))}}}),element.addEventListener("change",function(){truncateText(),updateCounter()}),truncateText(),updateCounter()}function createLoading(selector,text="正在加载中"){const parent=document.querySelector(selector);if(!parent)return console.error(`未找到选择器为 "${selector}" 的元素`),null;const parentPosition=window.getComputedStyle(parent).position;"static"===parentPosition&&(parent.style.position="relative");const overlay=document.createElement("div");overlay.style.position="absolute",overlay.style.top="0",overlay.style.left="0",overlay.style.width="100%",overlay.style.height="100%",overlay.style.backgroundColor="rgba(255, 255, 255, 0.85)",overlay.style.zIndex="9999",overlay.style.display="flex",overlay.style.justifyContent="center",overlay.style.alignItems="center",overlay.style.backdropFilter="blur(2px)";const loadingContainer=document.createElement("div");loadingContainer.style.display="flex",loadingContainer.style.flexDirection="column",loadingContainer.style.justifyContent="center",loadingContainer.style.alignItems="center",loadingContainer.style.padding="30px 40px",loadingContainer.style.backgroundColor="rgba(255, 255, 255, 0.95)",loadingContainer.style.borderRadius="12px",loadingContainer.style.boxShadow="0 8px 32px rgba(0, 0, 0, 0.1), 0 2px 8px rgba(0, 0, 0, 0.08)",loadingContainer.style.border="1px solid rgba(0, 0, 0, 0.05)",loadingContainer.style.minWidth="180px",loadingContainer.style.minHeight="140px",loadingContainer.style.boxSizing="border-box";const spinner=document.createElement("div");spinner.style.width="48px",spinner.style.height="48px",spinner.style.border="3px solid rgba(74, 144, 226, 0.2)",spinner.style.borderTop="3px solid #4a90e2",spinner.style.borderRight="3px solid #4a90e2",spinner.style.borderRadius="50%",spinner.style.animation="spin 1.2s cubic-bezier(0.5, 0.1, 0.5, 0.9) infinite",spinner.style.marginBottom="20px";const textElement=document.createElement("div");textElement.textContent=text,textElement.style.color="#333",textElement.style.fontSize="16px",textElement.style.fontWeight="500",textElement.style.textAlign="center",textElement.style.lineHeight="1.5",textElement.style.letterSpacing="0.5px";const dotsContainer=document.createElement("div");dotsContainer.style.display="flex",dotsContainer.style.justifyContent="center",dotsContainer.style.alignItems="center",dotsContainer.style.marginTop="8px",dotsContainer.style.height="20px";for(let i=0;i<3;i++){const dot=document.createElement("div");dot.style.width="6px",dot.style.height="6px",dot.style.backgroundColor="#4a90e2",dot.style.borderRadius="50%",dot.style.margin="0 3px",dot.style.animation=`pulse 1.4s ease-in-out ${.2*i}s infinite`,dotsContainer.appendChild(dot)}if(loadingContainer.appendChild(spinner),loadingContainer.appendChild(textElement),loadingContainer.appendChild(dotsContainer),overlay.appendChild(loadingContainer),parent.appendChild(overlay),!document.querySelector("#loading-animation-style")){const style=document.createElement("style");style.id="loading-animation-style",style.textContent="\n      @keyframes spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n      }\n      \n      @keyframes pulse {\n        0%, 100% { \n          opacity: 0.3;\n          transform: scale(0.8);\n        }\n        50% { \n          opacity: 1;\n          transform: scale(1.2);\n        }\n      }\n    ",document.head.appendChild(style)}return{remove:function(){overlay&&overlay.parentNode===parent&&(parent.removeChild(overlay),"relative"===parent.style.position&&"static"===parentPosition&&(parent.style.position=""))},updateText:function(newText){textElement.textContent=newText},getElement:function(){return overlay},show:function(){overlay.style.display="flex"},hide:function(){overlay.style.display="none"},setTheme:function(theme){"dark"===theme?(loadingContainer.style.backgroundColor="rgba(30, 30, 30, 0.95)",textElement.style.color="#fff",spinner.style.border="3px solid rgba(255, 255, 255, 0.2)",spinner.style.borderTop="3px solid #fff",spinner.style.borderRight="3px solid #fff",dotsContainer.querySelectorAll("div").forEach(dot=>{dot.style.backgroundColor="#fff"})):(loadingContainer.style.backgroundColor="rgba(255, 255, 255, 0.95)",textElement.style.color="#333",spinner.style.border="3px solid rgba(74, 144, 226, 0.2)",spinner.style.borderTop="3px solid #4a90e2",spinner.style.borderRight="3px solid #4a90e2",dotsContainer.querySelectorAll("div").forEach(dot=>{dot.style.backgroundColor="#4a90e2"}))}}}"undefined"!=typeof module&&module.exports&&(module.exports={TableCellSuffixAppender:TableCellSuffixAppender,safeInitTableCellSuffix:safeInitTableCellSuffix}),"undefined"!=typeof window&&(window.TableCellSuffixAppender=TableCellSuffixAppender,window.safeInitTableCellSuffix=safeInitTableCellSuffix),window.addCharacterCounters=addCharacterCounters;export{createLoading};class Message{constructor(){this.containers={},this.messageCount=0,this.initContainers(),this.initStyles()}initContainers(){["center-top","center-bottom","left","right"].forEach(position=>{const container=document.createElement("div");container.className=`message-container ${position}`,container.id=`message-container-${position}`,document.body.appendChild(container),this.containers[position]=container})}initStyles(){if(document.getElementById("message-styles"))return;const style=document.createElement("style");style.id="message-styles",style.textContent="\n            .message-container {\n                position: fixed;\n                z-index: 9999;\n                pointer-events: none;\n            }\n            \n            .message-container.center-top,\n            .message-container.center-bottom {\n                left: 50%;\n                transform: translateX(-50%);\n            }\n            \n            .message-container.center-top {\n                top: 24px;\n            }\n            \n            .message-container.center-bottom {\n                bottom: 24px;\n            }\n            \n            .message-container.left {\n                left: 24px;\n                top: 24px;\n            }\n            \n            .message-container.right {\n                right: 24px;\n                top: 24px;\n            }\n            \n            .message-item {\n                pointer-events: auto;\n                min-width: 300px;\n                max-width: 500px;\n                padding: 12px 16px;\n                margin-bottom: 16px;\n                border-radius: 6px;\n                box-shadow: 0 3px 6px -4px rgba(0, 0, 0, 0.12), \n                            0 6px 16px 0 rgba(0, 0, 0, 0.08), \n                            0 9px 28px 8px rgba(0, 0, 0, 0.05);\n                background-color: white;\n                display: flex;\n                align-items: flex-start;\n                transition: all 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);\n                position: relative;\n                overflow: hidden;\n                opacity: 0;\n                transform: translateY(-20px);\n            }\n            \n            .message-item.left-entering {\n                transform: translateX(-100%);\n                opacity: 0;\n            }\n            \n            .message-item.right-entering {\n                transform: translateX(100%);\n                opacity: 0;\n            }\n            \n            .message-item.entered {\n                opacity: 1;\n                transform: translateY(0) translateX(0);\n            }\n            \n            .message-item.hiding-left {\n                transform: translateX(-100%);\n                opacity: 0;\n            }\n            \n            .message-item.hiding-right {\n                transform: translateX(100%);\n                opacity: 0;\n            }\n            \n            .message-item.hiding-up {\n                transform: translateY(-100%);\n                opacity: 0;\n            }\n            \n            .message-item.hiding-down {\n                transform: translateY(100%);\n                opacity: 0;\n            }\n            \n            .message-icon {\n                margin-right: 12px;\n                width: 22px;\n                height: 22px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                flex-shrink: 0;\n            }\n            \n            .message-icon svg {\n                width: 20px;\n                height: 20px;\n            }\n            \n            .message-content {\n                flex: 1;\n                font-size: 14px;\n                line-height: 1.5715;\n                color: rgba(0, 0, 0, 0.85);\n            }\n            \n            .message-close {\n                margin-left: 12px;\n                cursor: pointer;\n                color: rgba(0, 0, 0, 0.45);\n                font-size: 14px;\n                line-height: 1;\n                padding: 2px;\n                transition: color 0.3s;\n                display: flex;\n                align-items: center;\n                height: 22px;\n                flex-shrink: 0;\n            }\n            \n            .message-close:hover {\n                color: rgba(0, 0, 0, 0.85);\n            }\n            \n            .message-normal,\n            .message-info {\n                border-left: 4px solid #1890ff;\n            }\n            \n            .message-success {\n                border-left: 4px solid #52c41a;\n            }\n            \n            .message-error {\n                border-left: 4px solid #ff4d4f;\n            }\n            \n            .message-warning {\n                border-left: 4px solid #faad14;\n            }\n            \n            .message-important {\n                border-left: 4px solid #722ed1;\n                background-color: #f9f0ff;\n            }\n            \n            .message-progress {\n                position: absolute;\n                bottom: 0;\n                left: 0;\n                height: 2px;\n                background-color: rgba(0, 0, 0, 0.06);\n                width: 100%;\n            }\n            \n            .message-progress-bar {\n                height: 100%;\n                background-color: #1890ff;\n                width: 100%;\n                transition: width linear;\n            }\n            \n            .message-progress-bar.success {\n                background-color: #52c41a;\n            }\n            \n            .message-progress-bar.error {\n                background-color: #ff4d4f;\n            }\n            \n            .message-progress-bar.warning {\n                background-color: #faad14;\n            }\n            \n            .message-progress-bar.important {\n                background-color: #722ed1;\n            }\n        ",document.head.appendChild(style)}createMessageIcon(type){const svgNS="http://www.w3.org/2000/svg",svg=document.createElementNS(svgNS,"svg");let fillColor;switch(svg.setAttribute("viewBox","0 0 1024 1024"),svg.setAttribute("version","1.1"),svg.setAttribute("xmlns",svgNS),svg.setAttribute("width","30"),svg.setAttribute("height","30"),type){case"info":case"normal":default:fillColor="#1890ff";break;case"success":fillColor="#52c41a";break;case"error":fillColor="#ff4d4f";break;case"warning":fillColor="#faad14";break;case"important":fillColor="#722ed1"}const path=document.createElementNS(svgNS,"path");return path.setAttribute("d","M410.5 106h203C780 106 915.3 239.6 918 405.5v412.3c0 54.8-44 99.3-98.5 100.2h-409C244 918 108.7 784.4 106 618.5v-208C106 244 239.6 108.7 405.5 106h208-203z m203 62.5h-203c-132.3 0-239.9 106.2-242 238v207c0 132.3 106.2 239.9 238 242h411.3c20.6 0 37.4-16.6 37.7-37.1V410.5c0-133.7-108.3-242-242-242z m58.2 410.2c19.9 0 36 16.1 36 36s-16.1 36-36 36H354.5c-19.9 0-36-16.1-36-36s16.1-36 36-36h317.2zM360.4 406.5h172.7c19.9 0 36 16.1 36 36 0 19.7-15.8 35.7-35.4 36H360.4c-19.9 0-36-16.1-36-36 0-19.7 15.8-35.7 35.4-36H533.1 360.4z"),path.setAttribute("fill",fillColor),svg.appendChild(path),svg}show(options){const mergedConfig={type:"info",content:"",duration:3,position:"center-top",hideDirection:"up",showClose:null,onClose:null,..."string"==typeof options?{content:options}:options};null===mergedConfig.showClose&&(mergedConfig.showClose="left"===mergedConfig.position||"right"===mergedConfig.position),"up"===mergedConfig.hideDirection&&"center-bottom"===mergedConfig.position&&(mergedConfig.hideDirection="down"),"up"===mergedConfig.hideDirection&&"left"===mergedConfig.position&&(mergedConfig.hideDirection="left"),"up"===mergedConfig.hideDirection&&"right"===mergedConfig.position&&(mergedConfig.hideDirection="right");const messageId=`message-${Date.now()}-${this.messageCount++}`,messageItem=document.createElement("div");messageItem.id=messageId,messageItem.className=`message-item message-${mergedConfig.type}`,"left"===mergedConfig.position?messageItem.classList.add("left-entering"):"right"===mergedConfig.position&&messageItem.classList.add("right-entering");const iconSpan=document.createElement("span");iconSpan.className="message-icon";const svgIcon=this.createMessageIcon(mergedConfig.type);iconSpan.appendChild(svgIcon);const contentSpan=document.createElement("span");contentSpan.className="message-content",contentSpan.textContent=mergedConfig.content;const closeSpan=document.createElement("span");closeSpan.className="message-close",closeSpan.innerHTML="&times;",closeSpan.onclick=()=>this.closeMessage(messageId,mergedConfig.position,mergedConfig.hideDirection,mergedConfig.onClose);let progressBar=null;if(mergedConfig.duration>0){const progressDiv=document.createElement("div");progressDiv.className="message-progress",progressBar=document.createElement("div"),progressBar.className=`message-progress-bar ${mergedConfig.type}`,progressBar.style.transitionDuration=`${mergedConfig.duration}s`,progressBar.style.width="100%",progressDiv.appendChild(progressBar),messageItem.appendChild(progressDiv),setTimeout(()=>{progressBar&&(progressBar.style.width="0%")},10)}messageItem.appendChild(iconSpan),messageItem.appendChild(contentSpan),mergedConfig.showClose&&messageItem.appendChild(closeSpan);const container=this.containers[mergedConfig.position];container&&(container.firstChild?container.insertBefore(messageItem,container.firstChild):container.appendChild(messageItem),setTimeout(()=>{messageItem.classList.add("entered")},10));let timeoutId=null;return mergedConfig.duration>0&&(timeoutId=setTimeout(()=>{this.closeMessage(messageId,mergedConfig.position,mergedConfig.hideDirection,mergedConfig.onClose)},1e3*mergedConfig.duration)),messageItem._messageData={timeoutId:timeoutId,onClose:mergedConfig.onClose},messageId}closeMessage(messageId,position,hideDirection,onClose){const message=document.getElementById(messageId);message&&(message._messageData&&message._messageData.timeoutId&&clearTimeout(message._messageData.timeoutId),onClose?onClose():message._messageData&&message._messageData.onClose&&message._messageData.onClose(),message.classList.add(`hiding-${hideDirection}`),setTimeout(()=>{message.parentNode&&message.parentNode.removeChild(message)},300))}clear(){Object.keys(this.containers).forEach(position=>{const container=this.containers[position];container.querySelectorAll(".message-item").forEach(message=>{message._messageData&&message._messageData.timeoutId&&clearTimeout(message._messageData.timeoutId);let hideDirection="up";"center-bottom"===position&&(hideDirection="down"),"left"===position&&(hideDirection="left"),"right"===position&&(hideDirection="right"),message.classList.add(`hiding-${hideDirection}`),setTimeout(()=>{message.parentNode===container&&container.removeChild(message)},300)})})}info(content,options={}){return this.show({...options,content:content,type:"info"})}success(content,options={}){return this.show({...options,content:content,type:"success"})}error(content,options={}){return this.show({...options,content:content,type:"error"})}warning(content,options={}){return this.show({...options,content:content,type:"warning"})}important(content,options={}){return this.show({...options,content:content,type:"important"})}normal(content,options={}){return this.info(content,options)}close(messageId){const message=document.getElementById(messageId);if(!message)return;const container=message.parentNode;if(!container)return;let position="center-top";container.id.includes("center-bottom")&&(position="center-bottom"),container.id.includes("left")&&(position="left"),container.id.includes("right")&&(position="right");let hideDirection="up";"center-bottom"===position&&(hideDirection="down"),"left"===position&&(hideDirection="left"),"right"===position&&(hideDirection="right"),this.closeMessage(messageId,position,hideDirection)}}"undefined"==typeof window||window.Message||(window.Message=new Message),"undefined"!=typeof module&&module.exports&&(module.exports=Message);class InvestmentProgress{constructor(container,options={}){this.defaultOptions={type:"circle",size:200,primaryColor:"#3498db",secondaryColor:"#ecf0f1",textColor:"#2c3e50",percentageColor:null,showPercentage:!0,text:"",textPosition:"bottom",textMargin:10,progress:0,animationDuration:300,useContainerSize:!0,containerMaxSize:300},this.options={...this.defaultOptions,...options},this.container="string"==typeof container?document.querySelector(container):container,this.container?(this.progress=this.options.progress,this.type=this.options.type,this.init()):console.error("InvestmentProgress: 未找到容器元素")}init(){this.container.innerHTML="",this.setContainerStyle(),this.createProgressElement(),this.updateProgress(this.progress)}setContainerStyle(){if(Object.assign(this.container.style,{position:"relative",display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%",overflow:"hidden"}),this.options.useContainerSize){const containerWidth=this.container.clientWidth,containerHeight=this.container.clientHeight,minSize=Math.min(containerWidth,containerHeight,this.options.containerMaxSize);"bar"===this.type?this.options.size=Math.min(containerWidth,this.options.containerMaxSize):this.options.size=minSize}}createProgressElement(){this.progressContainer&&this.progressContainer.remove(),this.progressContainer=document.createElement("div"),this.progressContainer.className="investment-progress-container";const size=this.options.size;"bar"===this.type?Object.assign(this.progressContainer.style,{width:`${size}px`,height:"auto",display:"flex",flexDirection:this.getBarTextDirection(),alignItems:"center",justifyContent:"center"}):Object.assign(this.progressContainer.style,{width:`${size}px`,height:`${size}px`,position:"relative",display:"grid",gridTemplateAreas:this.getGridTemplateAreas(),gridTemplateColumns:this.getGridTemplateColumns(),gridTemplateRows:this.getGridTemplateRows(),alignItems:"center",justifyContent:"center"}),this.createProgressVisual(),this.createTextElement(),this.container.appendChild(this.progressContainer)}getBarTextDirection(){switch(this.options.textPosition){case"top":default:return"column";case"bottom":return"column-reverse";case"left":return"row";case"right":return"row-reverse"}}getGridTemplateAreas(){switch(this.options.textPosition){case"top":return"'text' 'visual'";case"bottom":default:return"'visual' 'text'";case"left":return"'text visual'";case"right":return"'visual text'"}}getGridTemplateColumns(){switch(this.options.textPosition){case"left":case"right":return"auto 1fr";default:return"1fr"}}getGridTemplateRows(){switch(this.options.textPosition){case"top":case"bottom":return"auto 1fr";default:return"1fr"}}getPercentageColor(){return this.options.percentageColor||this.options.textColor}createProgressVisual(){switch(this.visualContainer&&this.visualContainer.remove(),this.visualContainer=document.createElement("div"),this.visualContainer.className="investment-progress-visual","bar"===this.type?(this.visualContainer.style.display="flex",this.visualContainer.style.alignItems="center",this.visualContainer.style.justifyContent="flex-start"):(this.visualContainer.style.gridArea="visual",this.visualContainer.style.display="flex",this.visualContainer.style.alignItems="center",this.visualContainer.style.justifyContent="center"),this.type){case"circle":this.createCircleVisual();break;case"bar":this.createBarVisual();break;case"investment":this.createInvestmentVisual();break;default:return void console.error(`InvestmentProgress: 不支持的类型 "${this.type}"`)}this.progressContainer.appendChild(this.visualContainer)}createCircleVisual(){const svgSize=this.options.size,svgNS="http://www.w3.org/2000/svg",svg=document.createElementNS(svgNS,"svg");svg.setAttribute("width",svgSize),svg.setAttribute("height",svgSize),svg.setAttribute("viewBox","0 0 120 120"),svg.style.display="block";const circumference=2*Math.PI*54,bgCircle=document.createElementNS(svgNS,"circle");bgCircle.setAttribute("cx","60"),bgCircle.setAttribute("cy","60"),bgCircle.setAttribute("r",54..toString()),bgCircle.setAttribute("fill","none"),bgCircle.setAttribute("stroke",this.options.secondaryColor),bgCircle.setAttribute("stroke-width","12"),svg.appendChild(bgCircle),this.progressCircle=document.createElementNS(svgNS,"circle"),this.progressCircle.setAttribute("cx","60"),this.progressCircle.setAttribute("cy","60"),this.progressCircle.setAttribute("r",54..toString()),this.progressCircle.setAttribute("fill","none"),this.progressCircle.setAttribute("stroke",this.options.primaryColor),this.progressCircle.setAttribute("stroke-width","12"),this.progressCircle.setAttribute("stroke-linecap","round"),this.progressCircle.setAttribute("stroke-dasharray",circumference.toString()),this.progressCircle.setAttribute("stroke-dashoffset",circumference.toString()),this.progressCircle.setAttribute("transform","rotate(-90 60 60)"),svg.appendChild(this.progressCircle),this.options.showPercentage&&(this.percentageText=document.createElementNS(svgNS,"text"),this.percentageText.setAttribute("x","60"),this.percentageText.setAttribute("y","65"),this.percentageText.setAttribute("text-anchor","middle"),this.percentageText.setAttribute("font-size","20"),this.percentageText.setAttribute("font-weight","600"),this.percentageText.setAttribute("fill",this.getPercentageColor()),this.percentageText.textContent="0%",svg.appendChild(this.percentageText)),this.visualContainer.appendChild(svg)}createBarVisual(){const width=this.options.size;Object.assign(this.visualContainer.style,{width:`${width}px`,height:"20px",backgroundColor:this.options.secondaryColor,borderRadius:"10px",overflow:"hidden",position:"relative"}),this.progressBar=document.createElement("div"),Object.assign(this.progressBar.style,{width:"0%",height:"100%",backgroundColor:this.options.primaryColor,borderRadius:"10px",transition:`width ${this.options.animationDuration}ms ease`}),this.visualContainer.appendChild(this.progressBar),this.options.showPercentage&&(this.percentageText=document.createElement("div"),Object.assign(this.percentageText.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"14px",fontWeight:"600",color:this.getPercentageColor(),textShadow:"1px 1px 1px rgba(255,255,255,0.8)"}),this.percentageText.textContent="0%",this.visualContainer.appendChild(this.percentageText))}createInvestmentVisual(){const visualSize=this.options.size;Object.assign(this.visualContainer.style,{width:`${visualSize}px`,height:`${visualSize}px`,position:"relative"});const svgNS="http://www.w3.org/2000/svg",svg=document.createElementNS(svgNS,"svg");svg.setAttribute("width","100%"),svg.setAttribute("height","100%"),svg.setAttribute("viewBox","0 0 100 100");for(let i=0;i<=10;i++){const lineX=document.createElementNS(svgNS,"line");lineX.setAttribute("x1","0"),lineX.setAttribute("y1",10*i),lineX.setAttribute("x2","100"),lineX.setAttribute("y2",10*i),lineX.setAttribute("stroke",this.options.secondaryColor),lineX.setAttribute("stroke-width","0.5"),svg.appendChild(lineX);const lineY=document.createElementNS(svgNS,"line");lineY.setAttribute("x1",10*i),lineY.setAttribute("y1","0"),lineY.setAttribute("x2",10*i),lineY.setAttribute("y2","100"),lineY.setAttribute("stroke",this.options.secondaryColor),lineY.setAttribute("stroke-width","0.5"),svg.appendChild(lineY)}this.growthPath=document.createElementNS(svgNS,"path"),this.growthPath.setAttribute("d","M10,90 L10,90"),this.growthPath.setAttribute("fill","none"),this.growthPath.setAttribute("stroke",this.options.primaryColor),this.growthPath.setAttribute("stroke-width","3"),this.growthPath.setAttribute("stroke-linecap","round"),this.growthPath.setAttribute("stroke-linejoin","round"),svg.appendChild(this.growthPath),this.visualContainer.appendChild(svg),this.options.showPercentage&&(this.percentageText=document.createElement("div"),Object.assign(this.percentageText.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"20px",fontWeight:"600",color:this.getPercentageColor()}),this.percentageText.textContent="0%",this.visualContainer.appendChild(this.percentageText))}createTextElement(){if(!this.options.text)return;this.textElement&&this.textElement.remove(),this.textElement=document.createElement("div"),this.textElement.className="investment-progress-text",this.textElement.textContent=this.options.text,"bar"===this.type?(this.textElement.style.display="flex",this.textElement.style.alignItems="center",this.textElement.style.justifyContent="center"):(this.textElement.style.gridArea="text",this.textElement.style.display="flex",this.textElement.style.alignItems="center",this.textElement.style.justifyContent="center");const textStyle={color:this.options.textColor,fontSize:"14px",textAlign:"center",flexShrink:"0"};switch(this.options.textPosition){case"top":textStyle.marginBottom=`${this.options.textMargin}px`,textStyle.width="100%";break;case"bottom":textStyle.marginTop=`${this.options.textMargin}px`,textStyle.width="100%";break;case"left":textStyle.marginRight=`${this.options.textMargin}px`,textStyle.writingMode="vertical-rl",textStyle.textOrientation="mixed",textStyle.height="100%",textStyle.maxWidth="none",textStyle.maxHeight="150px";break;case"right":textStyle.marginLeft=`${this.options.textMargin}px`,textStyle.writingMode="vertical-rl",textStyle.textOrientation="mixed",textStyle.height="100%",textStyle.maxWidth="none",textStyle.maxHeight="150px"}Object.assign(this.textElement.style,textStyle),this.progressContainer.appendChild(this.textElement)}updateProgress(progress,animate=!0){switch(this.progress=Math.max(0,Math.min(100,progress)),this.type){case"circle":this.updateCircleProgress(animate);break;case"bar":this.updateBarProgress(animate);break;case"investment":this.updateInvestmentProgress(animate)}this.options.showPercentage&&this.percentageText&&(this.percentageText.tagName,this.percentageText.textContent=`${Math.round(this.progress)}%`),this.triggerEvent("progressUpdate",{progress:this.progress})}updateCircleProgress(animate){if(!this.progressCircle)return;const circumference=2*Math.PI*54,offset=circumference-this.progress/100*circumference;this.progressCircle.style.transition=animate?`stroke-dashoffset ${this.options.animationDuration}ms ease`:"none",this.progressCircle.setAttribute("stroke-dashoffset",offset)}updateBarProgress(animate){this.progressBar&&(this.progressBar.style.transition=animate?`width ${this.options.animationDuration}ms ease`:"none",this.progressBar.style.width=`${this.progress}%`)}updateInvestmentProgress(animate){if(!this.growthPath)return;const points=[];for(let i=0;i<=10;i++){const x=10+8*i,progressRatio=Math.min(1,i/10*(this.progress/100)),y=90-80*Math.pow(progressRatio,.7);points.push(`${x},${y}`)}const pathData=`M${points.join(" L")}`;animate?(this.growthPath.style.transition=`d ${this.options.animationDuration}ms ease`,requestAnimationFrame(()=>{this.growthPath.setAttribute("d",pathData)})):(this.growthPath.style.transition="none",this.growthPath.setAttribute("d",pathData))}setType(type){this.type!==type&&(this.type=type,this.options.type=type,this.createProgressElement(),this.updateProgress(this.progress,!1))}setText(text){this.options.text=text,this.createTextElement()}setTextPosition(position){this.options.textPosition!==position&&(this.options.textPosition=position,this.createProgressElement(),this.updateProgress(this.progress,!1))}setColors(primary,secondary,textColor,percentageColor){this.options.primaryColor=primary||this.options.primaryColor,this.options.secondaryColor=secondary||this.options.secondaryColor,this.options.textColor=textColor||this.options.textColor,void 0!==percentageColor&&(this.options.percentageColor=percentageColor),this.init()}setPercentageColor(color){this.options.percentageColor=color,this.updatePercentageColor()}updatePercentageColor(){if(this.percentageText){const percentageColor=this.getPercentageColor();"text"===this.percentageText.tagName?this.percentageText.setAttribute("fill",percentageColor):this.percentageText.style.color=percentageColor}}reset(){this.updateProgress(0,!1)}complete(){this.updateProgress(100),this.triggerEvent("complete",{progress:100})}destroy(){this.container.innerHTML="",this.container.style=""}triggerEvent(eventName,detail={}){const event=new CustomEvent(`investmentProgress:${eventName}`,{detail:{...detail,instance:this}});this.container.dispatchEvent(event)}getProgress(){return this.progress}getOptions(){return{...this.options}}}"undefined"!=typeof module&&module.exports?module.exports=InvestmentProgress:"function"==typeof define&&define.amd?define([],function(){return InvestmentProgress}):window.InvestmentProgress=InvestmentProgress,function(){"use strict";const styleElement=document.createElement("style");styleElement.textContent="\n/* NG-Slider 组件样式 */\n.ng-slider {\n    position: relative;\n    width: 100%;\n    height: 12px;\n    margin: 10px 0;\n    padding: 4px 0;\n    cursor: pointer;\n    touch-action: none;\n    box-sizing: border-box;\n    isolation: isolate; /* 创建新的层叠上下文 */\n}\n\n.ng-slider-vertical {\n    width: 12px;\n    height: 200px;\n    margin: 0 10px;\n    padding: 0 4px;\n    display: inline-block;\n}\n\n.ng-slider-disabled {\n    cursor: not-allowed;\n    opacity: 0.6;\n}\n\n.ng-slider-disabled .ng-slider-track,\n.ng-slider-disabled .ng-slider-handle {\n    cursor: not-allowed;\n}\n\n.ng-slider-readonly .ng-slider-handle {\n    cursor: default;\n}\n\n/* 轨道 */\n.ng-slider-rail {\n    position: absolute;\n    width: 100%;\n    height: 4px;\n    background-color: #f5f5f5;\n    border-radius: 2px;\n    transition: background-color 0.3s;\n    top: 50%;\n    transform: translateY(-50%);\n}\n\n.ng-slider-vertical .ng-slider-rail {\n    width: 4px;\n    height: 100%;\n    left: 50%;\n    top: 0;\n    transform: translateX(-50%);\n}\n\n.ng-slider:hover .ng-slider-rail {\n    background-color: #e1e1e1;\n}\n\n/* 选中轨道 */\n.ng-slider-track {\n    position: absolute;\n    height: 4px;\n    background-color: #1890ff;\n    border-radius: 2px;\n    transition: background-color 0.3s, width 0.3s, height 0.3s, left 0.3s, top 0.3s;\n    top: 50%;\n    transform: translateY(-50%);\n}\n\n.ng-slider-vertical .ng-slider-track {\n    width: 4px;\n    left: 50%;\n    top: 0;\n    transform: translateX(-50%);\n}\n\n.ng-slider:hover .ng-slider-track {\n    background-color: #40a9ff;\n}\n\n/* 滑块手柄 */\n.ng-slider-handle {\n    position: absolute;\n    width: 14px;\n    height: 14px;\n    background-color: #fff;\n    border: 2px solid #1890ff;\n    border-radius: 50%;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n    cursor: grab;\n    transition: border-color 0.3s, box-shadow 0.3s, transform 0.3s;\n    z-index: 5; /* 提高z-index */\n    top: 50%;\n    transform: translate(-50%, -50%);\n}\n\n.ng-slider-vertical .ng-slider-handle {\n    left: 50%;\n    top: auto;\n    transform: translate(-50%, 50%);\n}\n\n.ng-slider-handle:focus {\n    outline: none;\n    border-color: #40a9ff;\n    box-shadow: 0 0 0 3px rgba(24, 144, 255, 0.2);\n}\n\n.ng-slider-handle:hover {\n    border-color: #40a9ff;\n    transform: translate(-50%, -50%) scale(1.2);\n}\n\n.ng-slider-vertical .ng-slider-handle:hover {\n    transform: translate(-50%, 50%) scale(1.2);\n}\n\n.ng-slider-handle:active {\n    cursor: grabbing;\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\n}\n\n/* 优化Tooltip定位 */\n.ng-slider-tooltip {\n    position: absolute;\n    visibility: hidden;\n    opacity: 0;\n    transition: opacity 0.3s, visibility 0.3s;\n    z-index: 9999; /* 更高的z-index避免被遮盖 */\n    pointer-events: none;\n    transform: none !important; /* 避免transform干扰 */\n    top: 0;\n    left: 0;\n    filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.15));\n}\n\n.ng-slider-tooltip-open {\n    visibility: visible;\n    opacity: 1;\n}\n\n.ng-slider-tooltip-hidden {\n    visibility: hidden !important;\n    opacity: 0 !important;\n}\n\n.ng-slider-tooltip-content {\n    position: relative;\n    padding: 6px 10px;\n    background-color: rgba(0, 0, 0, 0.95);\n    color: white;\n    border-radius: 4px;\n    font-size: 12px;\n    line-height: 1.5;\n    white-space: nowrap;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\n    min-width: 20px;\n    text-align: center;\n    z-index: 10000;\n}\n\n/* Tooltip箭头样式 - 修复后 */\n.ng-slider-tooltip-arrow {\n    position: absolute;\n    width: 0;\n    height: 0;\n    border-style: solid;\n    z-index: 10001;\n}\n\n/* 水平滑块Tooltip箭头 - 在下方 */\n.ng-slider:not(.ng-slider-vertical) .ng-slider-tooltip-arrow {\n    bottom: -6px;\n    left: 50%;\n    margin-left: -6px;\n    border-width: 6px 6px 0;\n    border-color: rgba(0, 0, 0, 0.95) transparent transparent transparent;\n}\n\n/* 垂直滑块Tooltip箭头 - 在左侧 */\n.ng-slider-vertical .ng-slider-tooltip-arrow {\n    left: -6px;\n    top: 50%;\n    margin-top: -6px;\n    border-width: 6px 6px 6px 0;\n    border-color: transparent rgba(0, 0, 0, 0.95) transparent transparent;\n}\n\n/* 标注 */\n.ng-slider-marks {\n    position: absolute;\n    top: 14px;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n    z-index: 1;\n}\n\n.ng-slider-vertical .ng-slider-marks {\n    top: 0;\n    left: 14px;\n    width: 100%;\n    height: 100%;\n}\n\n.ng-slider-mark {\n    position: absolute;\n    z-index: 1;\n}\n\n.ng-slider-mark-dot {\n    position: absolute;\n    width: 8px;\n    height: 8px;\n    background-color: #fff;\n    border: 2px solid #f5f5f5;\n    border-radius: 50%;\n    cursor: pointer;\n    transform: translate(-50%, -50%);\n    pointer-events: auto;\n    z-index: 2;\n}\n\n.ng-slider-vertical .ng-slider-mark-dot {\n    transform: translate(-50%, 50%);\n}\n\n.ng-slider-mark-dot-active {\n    border-color: #1890ff;\n}\n\n.ng-slider-mark-text {\n    position: absolute;\n    margin-top: 12px;\n    color: #999;\n    font-size: 12px;\n    white-space: nowrap;\n    transform: translateX(-50%);\n    text-align: center;\n    min-width: 30px;\n    z-index: 1;\n}\n\n.ng-slider-vertical .ng-slider-mark-text {\n    margin-top: 0;\n    margin-left: 12px;\n    transform: translateY(50%);\n}\n\n/* 输入框 */\n.ng-slider-input-container {\n    display: inline-block;\n    margin-left: 10px;\n    vertical-align: middle;\n}\n\n.ng-slider-input {\n    width: 60px;\n    padding: 4px 8px;\n    border: 1px solid #d9d9d9;\n    border-radius: 4px;\n    font-size: 14px;\n    transition: all 0.3s;\n}\n\n.ng-slider-input:focus {\n    border-color: #1890ff;\n    outline: none;\n    box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);\n}\n\n/* 动态按钮 - 修改为水平排列 */\n.ng-slider-dynamic-buttons {\n    display: inline-flex;\n    gap: 8px;\n    margin-left: 10px;\n    vertical-align: middle;\n}\n\n.ng-slider-add-point,\n.ng-slider-remove-point {\n    width: 30px;\n    height: 30px;\n    padding: 0;\n    background-color: transparent;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: background-color 0.3s, opacity 0.3s;\n}\n\n.ng-slider-add-point:hover,\n.ng-slider-remove-point:hover {\n    background-color: rgba(24, 144, 255, 0.1);\n}\n\n.ng-slider-add-point:disabled,\n.ng-slider-remove-point:disabled {\n    opacity: 0.4;\n    cursor: not-allowed;\n}\n\n.ng-slider-add-point:disabled:hover,\n.ng-slider-remove-point:disabled:hover {\n    background-color: transparent;\n}\n\n.ng-slider-dynamic-buttons svg {\n    width: 30px;\n    height: 30px;\n}\n\n/* 图标 */\n.ng-slider-start-icon,\n.ng-slider-end-icon {\n    position: absolute;\n    top: 50%;\n    transform: translateY(-50%);\n    color: #999;\n    font-size: 16px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 1;\n}\n\n.ng-slider-start-icon {\n    left: -24px;\n}\n\n.ng-slider-end-icon {\n    right: -24px;\n}\n\n.ng-slider-vertical .ng-slider-start-icon {\n    left: 50%;\n    top: -24px;\n    transform: translateX(-50%);\n}\n\n.ng-slider-vertical .ng-slider-end-icon {\n    left: 50%;\n    bottom: -24px;\n    top: auto;\n    transform: translateX(-50%);\n}\n\n/* 滑块图标样式 */\n.ng-slider-start-icon svg,\n.ng-slider-end-icon svg {\n    width: 16px;\n    height: 16px;\n}\n\n/* 反向样式 */\n.ng-slider-reverse .ng-slider-track {\n    background-color: #ff4d4f;\n}\n\n.ng-slider-reverse .ng-slider-handle {\n    border-color: #ff4d4f;\n}\n\n.ng-slider-reverse .ng-slider-handle:focus {\n    border-color: #ff7875;\n}\n\n.ng-slider-reverse .ng-slider-handle:hover {\n    border-color: #ff7875;\n}\n\n.ng-slider-reverse .ng-slider-mark-dot-active {\n    border-color: #ff4d4f;\n}\n\n/* 可拖拽轨道 */\n.ng-slider-track-draggable {\n    cursor: move;\n}\n\n/* 多点滑块 */\n.ng-slider-handle-multiple {\n    z-index: 5;\n}\n\n/* 工具类 */\n.ng-slider-wrapper {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    position: relative;\n    z-index: 1;\n}\n\n/* 动态滑块容器 */\n.ng-slider-dynamic-container {\n    display: flex;\n    align-items: center;\n    width: 100%;\n    gap: 10px;\n}\n\n.ng-slider-dynamic-container .ng-slider {\n    flex: 1;\n    margin: 0;\n}\n\n/* 隐藏原有元素的样式 */\n.ng-slider-original-element {\n    position: absolute !important;\n    width: 1px !important;\n    height: 1px !important;\n    padding: 0 !important;\n    margin: -1px !important;\n    overflow: hidden !important;\n    clip: rect(0, 0, 0, 0) !important;\n    white-space: nowrap !important;\n    border: 0 !important;\n    opacity: 0 !important;\n    pointer-events: none !important;\n}\n",document.head.appendChild(styleElement);class NGSlider{constructor(options={}){this.config={container:null,value:void 0,defaultValue:0,min:0,max:100,step:1,range:!1,disabled:!1,marks:null,included:!0,vertical:!1,reverse:!1,tooltip:{formatter:value=>value,open:void 0},rangeConfig:{draggableTrack:!1},points:null,dynamicPoints:!1,dynamicPointsConfig:{maxPoints:5,minPoints:null},icons:null,showInput:!1,preserveOriginal:!0,onChange:null,onChangeComplete:null,onFocus:null,onBlur:null,onKeyDown:null,styles:{},...options},options.dynamicPointsConfig&&(this.config.dynamicPointsConfig={...this.config.dynamicPointsConfig,...options.dynamicPointsConfig}),this.state={value:void 0!==this.config.value?this.config.value:this.config.defaultValue,activeHandle:null,isDragging:!1,tooltipVisible:!1,points:this.config.points||[],isTrackDragging:!1,tooltipMeasurements:{}},this.elements={container:null,slider:null,rail:null,track:null,handles:[],tooltips:[],marksContainer:null,input:null,originalElements:[],wrapper:null,dynamicButtons:null,dynamicContainer:null},this.handleDrag=this.handleDrag.bind(this),this.stopDrag=this.stopDrag.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.updateTooltipPosition=this.updateTooltipPosition.bind(this),this.init()}init(){this.elements.container="string"==typeof this.config.container?document.querySelector(this.config.container):this.config.container,this.elements.container?(this.config.preserveOriginal&&this.preserveOriginalElements(),this.createSlider(),this.render(),this.bindEvents()):console.error("容器元素未找到")}preserveOriginalElements(){Array.from(this.elements.container.children).forEach(child=>{if(!(child.classList.contains("ng-slider")||child.classList.contains("ng-slider-wrapper")||child.classList.contains("ng-slider-original-element")||child.classList.contains("ng-slider-dynamic-container"))){const originalInfo={element:child,originalClasses:Array.from(child.classList),originalStyle:child.getAttribute("style")||"",originalParent:child.parentNode,originalNextSibling:child.nextSibling};child.classList.add("ng-slider-original-element"),this.elements.originalElements.push(originalInfo)}})}restoreOriginalElements(){this.elements.originalElements.forEach(original=>{const{element:element,originalClasses:originalClasses,originalStyle:originalStyle}=original;element.classList.remove("ng-slider-original-element"),element.className="",originalClasses.forEach(className=>{className.includes("ng-slider")||element.classList.add(className)}),originalStyle?element.setAttribute("style",originalStyle):element.removeAttribute("style"),element.parentNode!==original.originalParent&&original.originalParent.insertBefore(element,original.originalNextSibling)}),this.elements.originalElements=[]}getMaxPoints(){return this.config.dynamicPointsConfig.maxPoints}getMinPoints(){return null!==this.config.dynamicPointsConfig.minPoints?this.config.dynamicPointsConfig.minPoints:this.config.range?2:1}createSlider(){const existingSlider=this.elements.container.querySelector(".ng-slider");existingSlider&&existingSlider.remove(),this.elements.slider=document.createElement("div"),this.elements.slider.className="ng-slider",this.config.vertical&&this.elements.slider.classList.add("ng-slider-vertical"),this.config.disabled&&this.elements.slider.classList.add("ng-slider-disabled"),this.config.reverse&&this.elements.slider.classList.add("ng-slider-reverse"),Object.keys(this.config.styles).forEach(key=>{this.elements.slider.style[key]=this.config.styles[key]}),this.elements.slider.style.zIndex="10",this.config.icons&&this.addIcons()}addIcons(){const{start:start,end:end}=this.config.icons;if(start){const startIcon=document.createElement("div");startIcon.className="ng-slider-start-icon",startIcon.innerHTML=start,this.elements.slider.appendChild(startIcon)}if(end){const endIcon=document.createElement("div");endIcon.className="ng-slider-end-icon",endIcon.innerHTML=end,this.elements.slider.appendChild(endIcon)}}render(){this.elements.slider.innerHTML="",this.createRail(),this.createTrack(),this.createHandles(),this.createTooltips(),this.config.marks&&this.createMarks(),this.config.dynamicPoints?this.createDynamicLayout():this.config.showInput?this.createInputLayout():this.elements.container.appendChild(this.elements.slider)}createDynamicLayout(){this.elements.dynamicContainer?this.elements.slider.parentNode!==this.elements.dynamicContainer&&this.elements.dynamicContainer.insertBefore(this.elements.slider,this.elements.dynamicButtons):(this.elements.dynamicContainer=document.createElement("div"),this.elements.dynamicContainer.className="ng-slider-dynamic-container",this.elements.dynamicContainer.appendChild(this.elements.slider),this.createDynamicButtons(),this.elements.container.appendChild(this.elements.dynamicContainer))}createInputLayout(){if(this.elements.wrapper||(this.elements.wrapper=document.createElement("div"),this.elements.wrapper.className="ng-slider-wrapper",this.elements.container.appendChild(this.elements.wrapper)),this.elements.slider.parentNode!==this.elements.wrapper&&this.elements.wrapper.insertBefore(this.elements.slider,this.elements.input?this.elements.input.parentNode:null),this.elements.input)Array.isArray(this.state.value)?this.elements.input.value=this.state.value[0]:this.elements.input.value=this.state.value;else{const inputContainer=document.createElement("div");inputContainer.className="ng-slider-input-container",this.elements.input=document.createElement("input"),this.elements.input.className="ng-slider-input",this.elements.input.type="number",this.elements.input.min=this.config.min,this.elements.input.max=this.config.max,this.elements.input.step=this.config.step||"any",Array.isArray(this.state.value)?this.elements.input.value=this.state.value[0]:this.elements.input.value=this.state.value,inputContainer.appendChild(this.elements.input),this.elements.wrapper.appendChild(inputContainer)}}createRail(){this.elements.rail=document.createElement("div"),this.elements.rail.className="ng-slider-rail",this.elements.slider.appendChild(this.elements.rail)}createTrack(){this.elements.track=document.createElement("div"),this.elements.track.className="ng-slider-track",this.config.range&&this.config.rangeConfig.draggableTrack&&this.elements.track.classList.add("ng-slider-track-draggable"),this.updateTrackPosition(),this.elements.slider.appendChild(this.elements.track)}updateTrackPosition(){if(this.elements.track)if(Array.isArray(this.state.value)){const min=Math.min(...this.state.value),max=Math.max(...this.state.value);if(this.config.vertical){const height=(max-min)/(this.config.max-this.config.min)*100,position=(min-this.config.min)/(this.config.max-this.config.min)*100;this.config.reverse?(this.elements.track.style.bottom=`${position}%`,this.elements.track.style.height=`${height}%`):(this.elements.track.style.top=`${position}%`,this.elements.track.style.height=`${height}%`)}else{const width=(max-min)/(this.config.max-this.config.min)*100,position=(min-this.config.min)/(this.config.max-this.config.min)*100;this.config.reverse?(this.elements.track.style.right=`${position}%`,this.elements.track.style.width=`${width}%`):(this.elements.track.style.left=`${position}%`,this.elements.track.style.width=`${width}%`)}}else if(this.config.vertical){const height=this.state.value/(this.config.max-this.config.min)*100;this.config.reverse?(this.elements.track.style.bottom="0",this.elements.track.style.height=`${height}%`):(this.elements.track.style.top="0",this.elements.track.style.height=`${height}%`)}else{const width=this.state.value/(this.config.max-this.config.min)*100;this.config.reverse?(this.elements.track.style.right="0",this.elements.track.style.width=`${width}%`):(this.elements.track.style.left="0",this.elements.track.style.width=`${width}%`)}}createHandles(){this.elements.handles=[];const values=Array.isArray(this.state.value)?this.state.value:[this.state.value];values.forEach((value,index)=>{const handle=document.createElement("div");handle.className="ng-slider-handle",values.length>1&&handle.classList.add("ng-slider-handle-multiple"),handle.dataset.index=index,handle.setAttribute("tabindex","0"),handle.setAttribute("role","slider"),handle.setAttribute("aria-valuemin",this.config.min),handle.setAttribute("aria-valuemax",this.config.max),handle.setAttribute("aria-valuenow",value),handle.setAttribute("aria-orientation",this.config.vertical?"vertical":"horizontal"),this.updateHandlePosition(handle,value),this.elements.slider.appendChild(handle),this.elements.handles.push(handle)})}updateHandlePosition(handle,value){const position=(value-this.config.min)/(this.config.max-this.config.min)*100;this.config.vertical?this.config.reverse?(handle.style.bottom=`${position}%`,handle.style.top="auto"):(handle.style.top=`${position}%`,handle.style.bottom="auto"):this.config.reverse?(handle.style.right=`${position}%`,handle.style.left="auto"):(handle.style.left=`${position}%`,handle.style.right="auto"),handle.setAttribute("aria-valuenow",value)}measureTooltip(index){const tooltip=this.elements.tooltips[index];if(!tooltip)return{width:40,height:30};if(this.state.tooltipMeasurements[index])return this.state.tooltipMeasurements[index];const originalDisplay=tooltip.style.display,originalVisibility=tooltip.style.visibility;tooltip.style.display="block",tooltip.style.visibility="visible",tooltip.style.opacity="1",tooltip.classList.add("ng-slider-tooltip-open");const tooltipContent=tooltip.querySelector(".ng-slider-tooltip-content");if(!tooltipContent)return tooltip.style.display=originalDisplay,tooltip.style.visibility=originalVisibility,tooltip.classList.remove("ng-slider-tooltip-open"),{width:40,height:30};const rect=tooltipContent.getBoundingClientRect(),width=rect.width,height=rect.height;return tooltip.style.display=originalDisplay,tooltip.style.visibility=originalVisibility,tooltip.style.opacity="",tooltip.classList.remove("ng-slider-tooltip-open"),this.state.tooltipMeasurements[index]={width:width,height:height},{width:width,height:height}}createTooltips(){this.elements.tooltips=[],this.state.tooltipMeasurements={};(Array.isArray(this.state.value)?this.state.value:[this.state.value]).forEach((value,index)=>{const tooltip=document.createElement("div");tooltip.className="ng-slider-tooltip";const displayValue=this.config.tooltip.formatter?this.config.tooltip.formatter(value):value,tooltipContent=document.createElement("div");tooltipContent.className="ng-slider-tooltip-content",tooltipContent.textContent=displayValue;const arrow=document.createElement("div");arrow.className="ng-slider-tooltip-arrow",tooltipContent.appendChild(arrow),tooltip.appendChild(tooltipContent),!0===this.config.tooltip.open?tooltip.classList.add("ng-slider-tooltip-open"):!1===this.config.tooltip.open&&tooltip.classList.add("ng-slider-tooltip-hidden"),tooltip.style.zIndex="9999",this.elements.slider.appendChild(tooltip),this.elements.tooltips.push(tooltip),setTimeout(()=>{this.updateTooltipPosition(tooltip,value,index)},10)})}updateTooltipPosition(tooltip,value,index){if(!tooltip||!this.elements.handles[index])return;const handle=this.elements.handles[index],sliderRect=this.elements.slider.getBoundingClientRect(),measurements=this.measureTooltip(index),tooltipWidth=measurements.width,tooltipHeight=measurements.height,handleRect=handle.getBoundingClientRect(),handleCenterX=handleRect.left+handleRect.width/2-sliderRect.left,handleCenterY=handleRect.top+handleRect.height/2-sliderRect.top;let arrow=tooltip.querySelector(".ng-slider-tooltip-arrow");if(!arrow){arrow=document.createElement("div"),arrow.className="ng-slider-tooltip-arrow";const tooltipContent=tooltip.querySelector(".ng-slider-tooltip-content");tooltipContent&&tooltipContent.appendChild(arrow)}if(this.config.vertical){const tooltipLeft=sliderRect.width+8,tooltipTop=handleCenterY-tooltipHeight/2;tooltip.style.left=`${tooltipLeft}px`,tooltip.style.top=`${tooltipTop}px`,arrow&&(arrow.style.left="-6px",arrow.style.top="50%",arrow.style.marginTop="-6px",arrow.style.borderWidth="6px 6px 6px 0",arrow.style.borderColor="transparent rgba(0, 0, 0, 0.95) transparent transparent"),tooltipTop+tooltipHeight>sliderRect.height&&(tooltip.style.top=sliderRect.height-tooltipHeight+"px"),tooltipTop<0&&(tooltip.style.top="0px")}else{const tooltipLeft=handleCenterX-tooltipWidth/2,tooltipTop=-tooltipHeight-6;if(tooltip.style.left=`${tooltipLeft}px`,tooltip.style.top=`${tooltipTop}px`,arrow&&(arrow.style.bottom="-6px",arrow.style.left="50%",arrow.style.marginLeft="-6px",arrow.style.borderWidth="6px 6px 0",arrow.style.borderColor="rgba(0, 0, 0, 0.95) transparent transparent transparent"),tooltipLeft<0&&(tooltip.style.left="0px",arrow)){const arrowOffset=handleCenterX-6;arrow.style.left=`${Math.max(6,arrowOffset)}px`,arrow.style.marginLeft="0"}if(tooltipLeft+tooltipWidth>sliderRect.width&&(tooltip.style.left=sliderRect.width-tooltipWidth+"px",arrow)){const arrowOffset=handleCenterX-(sliderRect.width-tooltipWidth)-6;arrow.style.left=`${Math.min(tooltipWidth-6,arrowOffset)}px`,arrow.style.marginLeft="0"}}tooltip.style.zIndex="9999"}createMarks(){this.elements.marksContainer=document.createElement("div"),this.elements.marksContainer.className="ng-slider-marks";Object.keys(this.config.marks).map(Number).sort((a,b)=>a-b).forEach(markValue=>{const markLabel=this.config.marks[markValue],mark=document.createElement("div");mark.className="ng-slider-mark";const position=(markValue-this.config.min)/(this.config.max-this.config.min)*100;this.config.vertical?this.config.reverse?(mark.style.bottom=`${position}%`,mark.style.top="auto"):(mark.style.top=`${position}%`,mark.style.bottom="auto"):this.config.reverse?(mark.style.right=`${position}%`,mark.style.left="auto"):(mark.style.left=`${position}%`,mark.style.right="auto");const dot=document.createElement("div");if(dot.className="ng-slider-mark-dot",dot.dataset.value=markValue,this.config.included){const values=Array.isArray(this.state.value)?this.state.value:[this.state.value],min=Math.min(...values),max=Math.max(...values);markValue>=min&&markValue<=max&&dot.classList.add("ng-slider-mark-dot-active")}if(dot.addEventListener("click",e=>{e.stopPropagation(),this.handleMarkClick(markValue)}),mark.appendChild(dot),markLabel){const label=document.createElement("span");label.className="ng-slider-mark-text",label.textContent=markLabel,mark.appendChild(label)}this.elements.marksContainer.appendChild(mark)}),this.elements.slider.appendChild(this.elements.marksContainer)}createDynamicButtons(){this.elements.dynamicButtons||(this.elements.dynamicButtons=document.createElement("div"),this.elements.dynamicButtons.className="ng-slider-dynamic-buttons",this.elements.dynamicContainer&&this.elements.dynamicContainer.appendChild(this.elements.dynamicButtons)),this.elements.dynamicButtons.innerHTML="";const addButton=document.createElement("button");addButton.className="ng-slider-add-point",addButton.innerHTML='<svg t="1768271991434" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4315" width="30" height="30"><path d="M848 232c0 30.928-25.072 56-56 56s-56-25.072-56-56 25.072-56 56-56 56 25.072 56 56z m64 0c0 66.274-53.726 120-120 120-50.802 0-94.232-31.569-111.74-76.16-62.022 13.36-120 37.624-171.825 70.685C517.1 363.116 522 381.986 522 402c0 66.274-53.726 120-120 120-20.014 0-38.883-4.9-55.475-13.565-33.061 51.826-57.325 109.803-70.685 171.825C320.431 697.769 352 741.198 352 792c0 66.274-53.726 120-120 120s-120-53.726-120-120c0-59.401 43.16-108.721 99.831-118.312 15.478-76.287 45.613-147.241 87.34-209.797C288.271 445.82 282 424.642 282 402c0-66.274 53.726-120 120-120 22.643 0 43.82 6.271 61.891 17.171 62.557-41.727 133.511-71.863 209.797-87.34C683.279 155.16 732.599 112 792 112c66.274 0 120 53.726 120 120zM232 848c30.928 0 56-25.072 56-56s-25.072-56-56-56-56 25.072-56 56 25.072 56 56 56z m564-272c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v108H624c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h108v108c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V748h108c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H796V576z" fill="#1296db" p-id="4316"></path></svg>',addButton.title="添加节点";const maxPoints=this.getMaxPoints();Array.isArray(this.state.value)&&this.state.value.length>=maxPoints&&(addButton.disabled=!0),addButton.addEventListener("click",()=>this.addPoint());const removeButton=document.createElement("button");removeButton.className="ng-slider-remove-point",removeButton.innerHTML='<svg t="1768272056233" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5479" width="30" height="30"><path d="M848 232c0 30.928-25.072 56-56 56s-56-25.072-56-56 25.072-56 56-56 56 25.072 56 56z m64 0c0 66.274-53.726 120-120 120-50.802 0-94.232-31.569-111.74-76.16-62.022 13.36-120 37.624-171.825 70.685C517.1 363.116 522 381.986 522 402c0 66.274-53.726 120-120 120-20.014 0-38.883-4.9-55.475-13.565-33.061 51.826-57.325 109.803-70.685 171.825C320.431 697.769 352 741.198 352 792c0 66.274-53.726 120-120 120s-120-53.726-120-120c0-59.401 43.16-108.721 99.831-118.312 15.478-76.287 45.613-147.241 87.34-209.797C288.271 445.82 282 424.642 282 402c0-66.274 53.726-120 120-120 22.643 0 43.82 6.271 61.891 17.171 62.557-41.727 133.511-71.863 209.797-87.34C683.279 155.16 732.599 112 792 112c66.274 0 120 53.726 120 120zM232 848c30.928 0 56-25.072 56-56s-25.072-56-56-56-56 25.072-56 56 25.072 56 56 56z m392-164h280c4.4 0 8 3.6 8 8v48c0 4.4-3.6 8-8 8H624c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8z" fill="#1296db" p-id="5480"></path></svg>',removeButton.title="删除节点";const minPoints=this.getMinPoints();Array.isArray(this.state.value)&&this.state.value.length<=minPoints&&(removeButton.disabled=!0),removeButton.addEventListener("click",()=>this.removePoint()),this.elements.dynamicButtons.appendChild(addButton),this.elements.dynamicButtons.appendChild(removeButton)}bindEvents(){this.unbindEvents(),this.elements.handles.forEach((handle,index)=>{handle.addEventListener("mousedown",e=>this.startDrag(e,index)),handle.addEventListener("touchstart",e=>this.startDrag(e,index)),handle.addEventListener("keydown",e=>this.handleKeyDown(e,index)),handle.addEventListener("keyup",e=>{this.config.onChangeComplete&&this.config.onChangeComplete(this.state.value)}),handle.addEventListener("focus",()=>this.handleFocus(index)),handle.addEventListener("blur",()=>this.handleBlur(index)),handle.addEventListener("mouseenter",()=>this.showTooltip(index)),handle.addEventListener("mouseleave",()=>{this.state.isDragging||!0===this.config.tooltip.open||this.hideTooltip(index)})}),this.config.range&&this.config.rangeConfig.draggableTrack&&this.elements.track&&(this.elements.track.addEventListener("mousedown",e=>this.startTrackDrag(e)),this.elements.track.addEventListener("touchstart",e=>this.startTrackDrag(e))),this.elements.rail.addEventListener("click",e=>this.handleRailClick(e)),this.elements.input&&(this.elements.input.addEventListener("change",e=>this.handleInputChange(e)),this.elements.input.addEventListener("keyup",e=>{"Enter"===e.key&&(this.handleInputChange(e),this.config.onChangeComplete&&this.config.onChangeComplete(this.state.value))})),this.resizeObserver=new ResizeObserver(()=>{this.updateAllTooltipPositions()}),this.elements.container&&this.resizeObserver.observe(this.elements.container),this.elements.slider&&this.resizeObserver.observe(this.elements.slider),document.addEventListener("mousemove",this.handleDrag),document.addEventListener("mouseup",this.stopDrag),document.addEventListener("touchmove",this.handleDrag),document.addEventListener("touchend",this.stopDrag)}updateAllTooltipPositions(){(Array.isArray(this.state.value)?this.state.value:[this.state.value]).forEach((value,index)=>{this.elements.tooltips[index]&&this.updateTooltipPosition(this.elements.tooltips[index],value,index)})}unbindEvents(){document.removeEventListener("mousemove",this.handleDrag),document.removeEventListener("mouseup",this.stopDrag),document.removeEventListener("touchmove",this.handleDrag),document.removeEventListener("touchend",this.stopDrag),this.resizeObserver&&this.resizeObserver.disconnect()}startDrag(e,index){this.config.disabled||(e.preventDefault(),e.stopPropagation(),this.state.activeHandle=index,this.state.isDragging=!0,this.showTooltip(index),this.config.onFocus&&this.config.onFocus(this.state.value))}startTrackDrag(e){this.config.disabled||!Array.isArray(this.state.value)||this.state.value.length<2||(e.preventDefault(),e.stopPropagation(),this.state.isTrackDragging=!0,this.state.isDragging=!0,this.state.trackStartX=e.clientX||e.touches[0].clientX,this.state.trackStartY=e.clientY||e.touches[0].clientY,this.state.trackStartValues=[...this.state.value])}handleDrag(e){this.state.isDragging&&!this.config.disabled&&(this.state.isTrackDragging?this.handleTrackDrag(e):this.handleHandleDrag(e))}handleHandleDrag(e){const rect=this.elements.slider.getBoundingClientRect();let clientX,clientY;e.type.includes("touch")?(clientX=e.touches[0].clientX,clientY=e.touches[0].clientY):(clientX=e.clientX,clientY=e.clientY);let percentage=this.calculatePercentage(clientX,clientY,rect),newValue=this.calculateValueFromPercentage(percentage);if(this.updateValue(newValue,this.state.activeHandle),this.elements.tooltips[this.state.activeHandle]){const displayValue=this.config.tooltip.formatter?this.config.tooltip.formatter(newValue):newValue,tooltipContent=this.elements.tooltips[this.state.activeHandle].querySelector(".ng-slider-tooltip-content");tooltipContent&&(tooltipContent.textContent=displayValue),delete this.state.tooltipMeasurements[this.state.activeHandle],this.updateTooltipPosition(this.elements.tooltips[this.state.activeHandle],newValue,this.state.activeHandle)}this.config.onChange&&this.config.onChange(this.state.value)}handleTrackDrag(e){const rect=this.elements.slider.getBoundingClientRect();let clientX,clientY;e.type.includes("touch")?(clientX=e.touches[0].clientX,clientY=e.touches[0].clientY):(clientX=e.clientX,clientY=e.clientY);const deltaX=clientX-this.state.trackStartX,deltaY=clientY-this.state.trackStartY;let deltaPercentage;deltaPercentage=this.config.vertical?deltaY/rect.height:deltaX/rect.width,this.config.reverse&&(deltaPercentage=-deltaPercentage);const deltaValue=deltaPercentage*(this.config.max-this.config.min),newValues=this.state.trackStartValues.map(value=>{let newValue=value+deltaValue;return null!==this.config.step&&(newValue=Math.round(newValue/this.config.step)*this.config.step),newValue=Math.min(Math.max(newValue,this.config.min),this.config.max),newValue});this.state.value=newValues,this.updateUI(),this.config.onChange&&this.config.onChange(this.state.value)}calculatePercentage(clientX,clientY,rect){if(this.config.vertical){let position;return position=this.config.reverse?rect.bottom-clientY:clientY-rect.top,Math.min(Math.max(position/rect.height,0),1)}{let position;return position=this.config.reverse?rect.right-clientX:clientX-rect.left,Math.min(Math.max(position/rect.width,0),1)}}calculateValueFromPercentage(percentage){let newValue=this.config.min+percentage*(this.config.max-this.config.min);if(null!==this.config.step&&(newValue=Math.round(newValue/this.config.step)*this.config.step),newValue=Math.min(Math.max(newValue,this.config.min),this.config.max),this.config.marks&&null===this.config.step){const marks=Object.keys(this.config.marks).map(Number);newValue=marks.reduce((prev,curr)=>Math.abs(curr-newValue)<Math.abs(prev-newValue)?curr:prev)}return newValue}stopDrag(){if(!this.state.isDragging)return;const wasDragging=this.state.isDragging;this.state.isDragging=!1,this.state.isTrackDragging=!1,this.state.activeHandle=null,!0!==this.config.tooltip.open&&this.hideTooltips(),wasDragging&&this.config.onChangeComplete&&this.config.onChangeComplete(this.state.value)}handleRailClick(e){if(this.config.disabled)return;const rect=this.elements.slider.getBoundingClientRect(),clientX=e.clientX||e.touches&&e.touches[0].clientX,clientY=e.clientY||e.touches&&e.touches[0].clientY;if(!clientX&&!clientY)return;const percentage=this.calculatePercentage(clientX,clientY,rect),newValue=this.calculateValueFromPercentage(percentage);if(Array.isArray(this.state.value)){const distances=this.state.value.map(val=>Math.abs(val-newValue)),closestIndex=distances.indexOf(Math.min(...distances));this.updateValue(newValue,closestIndex)}else this.updateValue(newValue);this.config.onChange&&this.config.onChange(this.state.value),this.config.onChangeComplete&&this.config.onChangeComplete(this.state.value)}handleMarkClick(value){if(!this.config.disabled){if(Array.isArray(this.state.value)){const distances=this.state.value.map(val=>Math.abs(val-value)),closestIndex=distances.indexOf(Math.min(...distances));this.updateValue(value,closestIndex)}else this.updateValue(value);this.config.onChange&&this.config.onChange(this.state.value),this.config.onChangeComplete&&this.config.onChangeComplete(this.state.value)}}handleKeyDown(e,index){if(this.config.disabled)return;let newValue;this.config.onKeyDown&&this.config.onKeyDown(e,this.state.value);const currentValue=Array.isArray(this.state.value)?this.state.value[index]:this.state.value;switch(e.key){case"ArrowLeft":case"ArrowDown":e.preventDefault(),newValue=currentValue-(this.config.step||1);break;case"ArrowRight":case"ArrowUp":e.preventDefault(),newValue=currentValue+(this.config.step||1);break;case"Home":e.preventDefault(),newValue=this.config.min;break;case"End":e.preventDefault(),newValue=this.config.max;break;case"Delete":case"Backspace":this.config.dynamicPoints&&Array.isArray(this.state.value)&&this.state.value.length>1&&(e.preventDefault(),this.removePointAtIndex(index));break;default:return}void 0!==newValue&&(newValue=Math.min(Math.max(newValue,this.config.min),this.config.max),this.updateValue(newValue,index),this.config.onChange&&this.config.onChange(this.state.value))}handleInputChange(e){const newValue=Number(e.target.value);!isNaN(newValue)&&newValue>=this.config.min&&newValue<=this.config.max&&(this.updateValue(newValue),this.config.onChange&&this.config.onChange(this.state.value))}handleFocus(index){this.showTooltip(index),this.config.onFocus&&this.config.onFocus(this.state.value)}handleBlur(index){!0!==this.config.tooltip.open&&this.hideTooltip(index),this.config.onBlur&&this.config.onBlur(this.state.value)}showTooltips(){!1!==this.config.tooltip.open&&(this.elements.tooltips.forEach((tooltip,index)=>{if(tooltip.classList.add("ng-slider-tooltip-open"),this.elements.handles[index]){const value=Array.isArray(this.state.value)?this.state.value[index]:this.state.value;this.updateTooltipPosition(tooltip,value,index)}}),this.state.tooltipVisible=!0)}hideTooltips(){!0!==this.config.tooltip.open&&(this.elements.tooltips.forEach(tooltip=>{tooltip.classList.remove("ng-slider-tooltip-open")}),this.state.tooltipVisible=!1)}showTooltip(index){if(!1!==this.config.tooltip.open&&this.elements.tooltips[index]){this.elements.tooltips[index].classList.add("ng-slider-tooltip-open");const value=Array.isArray(this.state.value)?this.state.value[index]:this.state.value;this.updateTooltipPosition(this.elements.tooltips[index],value,index)}}hideTooltip(index){!0!==this.config.tooltip.open&&this.elements.tooltips[index]&&this.elements.tooltips[index].classList.remove("ng-slider-tooltip-open")}updateUI(){this.updateTrackPosition();if((Array.isArray(this.state.value)?this.state.value:[this.state.value]).forEach((value,index)=>{if(this.elements.handles[index]&&(this.updateHandlePosition(this.elements.handles[index],value),this.elements.handles[index].setAttribute("aria-valuenow",value)),this.elements.tooltips[index]){const displayValue=this.config.tooltip.formatter?this.config.tooltip.formatter(value):value,tooltipContent=this.elements.tooltips[index].querySelector(".ng-slider-tooltip-content");tooltipContent&&(tooltipContent.textContent=displayValue),delete this.state.tooltipMeasurements[index],setTimeout(()=>{this.updateTooltipPosition(this.elements.tooltips[index],value,index)},10)}}),this.elements.input&&(Array.isArray(this.state.value)?this.elements.input.value=this.state.value[0]:this.elements.input.value=this.state.value),this.elements.marksContainer){this.elements.marksContainer.querySelectorAll(".ng-slider-mark-dot").forEach(dot=>{const dotValue=parseFloat(dot.dataset.value),values=Array.isArray(this.state.value)?this.state.value:[this.state.value],min=Math.min(...values),max=Math.max(...values);this.config.included&&dotValue>=min&&dotValue<=max?dot.classList.add("ng-slider-mark-dot-active"):dot.classList.remove("ng-slider-mark-dot-active")})}this.config.dynamicPoints&&this.elements.dynamicButtons&&this.updateDynamicButtons()}updateDynamicButtons(){if(!this.elements.dynamicButtons)return;const addButton=this.elements.dynamicButtons.querySelector(".ng-slider-add-point"),removeButton=this.elements.dynamicButtons.querySelector(".ng-slider-remove-point");if(addButton){const maxPoints=this.getMaxPoints();Array.isArray(this.state.value)&&this.state.value.length>=maxPoints?addButton.disabled=!0:addButton.disabled=!1}if(removeButton){const minPoints=this.getMinPoints();Array.isArray(this.state.value)&&this.state.value.length<=minPoints?removeButton.disabled=!0:removeButton.disabled=!1}}updateValue(newValue,handleIndex=0){let oldValue=this.state.value;if(Array.isArray(this.state.value)){const newValues=[...this.state.value];this.config.range&&2===newValues.length&&(newValue=0===handleIndex?Math.min(newValue,newValues[1]):Math.max(newValue,newValues[0])),newValues[handleIndex]=newValue,this.state.value=newValues.sort((a,b)=>a-b)}else this.state.value=newValue;return this.updateUI(),oldValue}addPoint(){if(!this.config.dynamicPoints||!Array.isArray(this.state.value))return;const maxPoints=this.getMaxPoints();if(this.state.value.length>=maxPoints)return void console.warn(`已达到最大节点数：${maxPoints}`);let newValue;if(0===this.state.value.length)newValue=(this.config.min+this.config.max)/2;else{let maxGap=0;this.config.min;this.state.value[0]-this.config.min>maxGap&&(maxGap=this.state.value[0]-this.config.min,newValue=this.config.min+maxGap/2);for(let i=0;i<this.state.value.length-1;i++){const gap=this.state.value[i+1]-this.state.value[i];gap>maxGap&&(maxGap=gap,newValue=this.state.value[i]+gap/2)}this.config.max-this.state.value[this.state.value.length-1]>maxGap&&(maxGap=this.config.max-this.state.value[this.state.value.length-1],newValue=this.state.value[this.state.value.length-1]+maxGap/2)}null!==this.config.step&&(newValue=Math.round(newValue/this.config.step)*this.config.step),newValue=Math.min(Math.max(newValue,this.config.min),this.config.max),this.state.value.push(newValue),this.state.value.sort((a,b)=>a-b),this.updateSliderOnly(),this.bindEvents(),this.config.onChange&&this.config.onChange(this.state.value)}updateSliderOnly(){this.elements.slider.innerHTML="",this.createRail(),this.createTrack(),this.createHandles(),this.createTooltips(),this.config.marks&&this.createMarks(),this.updateUI()}removePoint(){if(!this.config.dynamicPoints||!Array.isArray(this.state.value))return;const minPoints=this.getMinPoints();this.state.value.length<=minPoints?console.warn(`已达到最小节点数：${minPoints}`):(this.state.value.pop(),this.updateSliderOnly(),this.bindEvents(),this.config.onChange&&this.config.onChange(this.state.value))}removePointAtIndex(index){if(!this.config.dynamicPoints||!Array.isArray(this.state.value)||this.state.value.length<=1)return;const minPoints=this.getMinPoints();this.state.value.length<=minPoints?console.warn(`已达到最小节点数：${minPoints}`):(this.state.value.splice(index,1),this.updateSliderOnly(),this.bindEvents(),this.config.onChange&&this.config.onChange(this.state.value))}getValue(){return this.state.value}setValue(value){this.state.value=value,this.updateUI(),this.config.onChange&&this.config.onChange(this.state.value)}enable(){this.config.disabled=!1,this.elements.slider.classList.remove("ng-slider-disabled")}disable(){this.config.disabled=!0,this.elements.slider.classList.add("ng-slider-disabled")}setReadOnly(readOnly){readOnly?this.elements.slider.classList.add("ng-slider-readonly"):this.elements.slider.classList.remove("ng-slider-readonly")}updateConfig(newConfig){this.config={...this.config,...newConfig},this.render(),this.bindEvents()}destroy(){this.unbindEvents(),this.config.preserveOriginal&&this.restoreOriginalElements(),this.elements.container&&(this.elements.dynamicContainer?this.elements.dynamicContainer.remove():this.elements.wrapper?this.elements.wrapper.remove():this.elements.slider&&this.elements.slider.parentNode&&this.elements.slider.parentNode.removeChild(this.elements.slider))}}window.NGSlider=NGSlider,window.initSliders=function(selector=".ng-slider-container",options={}){const containers=document.querySelectorAll(selector),sliders=[];return containers.forEach(container=>{let dataOptions={};try{dataOptions=JSON.parse(container.dataset.sliderOptions||"{}")}catch(e){console.warn("Invalid slider options in data attribute",e)}const sliderOptions={container:container,...options,...dataOptions},slider=new NGSlider(sliderOptions);sliders.push(slider),container._ngSlider=slider}),sliders}}();class NGStatistic{constructor(selector,options={}){this.options={data:[],itemsPerRow:1,centered:!1,valueSize:32,titleSize:14,animationDuration:800,animationEasing:"easeOutQuart",containerStyle:{},...options},this.container="string"==typeof selector?document.querySelector(selector):selector,this.container?(this.injectStyles(),this.init()):console.error("Container element not found:",selector)}injectStyles(){if(document.getElementById("ng-statistic-styles"))return;const style=document.createElement("style");style.id="ng-statistic-styles",style.textContent='\n            .ng-statistic-wrapper {\n                display: grid;\n                gap: 24px;\n                align-items: start;\n            }\n            \n            .ng-statistic-item {\n                text-align: center;\n                transition: all 0.3s;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n            }\n            \n            .ng-statistic-value-container {\n                display: flex;\n                align-items: baseline;\n                gap: 4px;\n                margin-bottom: 4px;\n            }\n            \n            .ng-statistic-value {\n                font-weight: 600;\n                line-height: 1;\n                color: #333;\n                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;\n            }\n            \n            .ng-statistic-prefix,\n            .ng-statistic-suffix {\n                font-size: 16px;\n                color: #666;\n                line-height: 1;\n                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;\n            }\n            \n            .ng-statistic-title {\n                color: #666;\n                line-height: 1.5715;\n                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;\n            }\n            \n            @keyframes ng-statistic-fade-in {\n                from {\n                    opacity: 0;\n                    transform: translateY(10px);\n                }\n                to {\n                    opacity: 1;\n                    transform: translateY(0);\n                }\n            }\n            \n            .ng-statistic-item {\n                animation: ng-statistic-fade-in 0.3s ease-out;\n            }\n            \n            @keyframes ng-statistic-count-up {\n                from {\n                    opacity: 0.5;\n                }\n                to {\n                    opacity: 1;\n                }\n            }\n            \n            .ng-statistic-value.animating {\n                animation: ng-statistic-count-up 0.1s ease-out;\n            }\n        ',document.head.appendChild(style)}init(){this.clearContainer(),this.render()}clearContainer(){this.container.innerHTML=""}render(){const{data:data,itemsPerRow:itemsPerRow,centered:centered,containerStyle:containerStyle}=this.options,wrapper=document.createElement("div");wrapper.className="ng-statistic-wrapper",Object.assign(wrapper.style,{gridTemplateColumns:`repeat(${itemsPerRow}, 1fr)`,justifyItems:centered?"center":"start"}),Object.assign(wrapper.style,this.parseStyles(containerStyle)),data.forEach((item,index)=>{const statisticItem=this.createStatisticItem(item,index);wrapper.appendChild(statisticItem)}),this.container.appendChild(wrapper)}createStatisticItem(item,index){const{valueSize:valueSize,titleSize:titleSize,animationDuration:animationDuration,animationEasing:animationEasing}=this.options,{title:title,value:value,prefix:prefix="",suffix:suffix="",precision:precision=0,animation:animation=!1,classNames:classNames={},styles:styles={},itemStyle:itemStyle={}}=item,itemEl=document.createElement("div");itemEl.className="ng-statistic-item",classNames.container&&(itemEl.className+=` ${classNames.container}`),Object.assign(itemEl.style,{textAlign:"center",...this.parseStyles(itemStyle),...this.parseStyles(styles.container)});const valueContainer=document.createElement("div");if(valueContainer.className="ng-statistic-value-container",Object.assign(valueContainer.style,this.parseStyles(styles.valueContainer)),prefix){const prefixEl=document.createElement("span");prefixEl.className="ng-statistic-prefix",classNames.prefix&&(prefixEl.className+=` ${classNames.prefix}`),Object.assign(prefixEl.style,{fontSize:Math.min(.5*valueSize,24)+"px",...this.parseStyles(styles.prefix)}),prefixEl.textContent=prefix,valueContainer.appendChild(prefixEl)}const valueEl=document.createElement("span");valueEl.className="ng-statistic-value",classNames.value&&(valueEl.className+=` ${classNames.value}`),Object.assign(valueEl.style,{fontSize:`${valueSize}px`,...this.parseStyles(styles.value)});const formattedValue=this.formatNumber(value,precision);if(animation?(valueEl.textContent="0",this.animateValue(valueEl,parseFloat(value),precision,animationDuration,animationEasing)):valueEl.textContent=formattedValue,valueContainer.appendChild(valueEl),suffix){const suffixEl=document.createElement("span");suffixEl.className="ng-statistic-suffix",classNames.suffix&&(suffixEl.className+=` ${classNames.suffix}`),Object.assign(suffixEl.style,{fontSize:Math.min(.5*valueSize,24)+"px",...this.parseStyles(styles.suffix)}),suffixEl.textContent=suffix,valueContainer.appendChild(suffixEl)}if(itemEl.appendChild(valueContainer),title){const titleEl=document.createElement("div");titleEl.className="ng-statistic-title",classNames.title&&(titleEl.className+=` ${classNames.title}`),Object.assign(titleEl.style,{fontSize:`${titleSize}px`,marginTop:Math.min(.2*valueSize,8)+"px",...this.parseStyles(styles.title)}),titleEl.textContent=title,itemEl.appendChild(titleEl)}return itemEl}formatNumber(num,precision){if("number"!=typeof num)return num;const multiplier=Math.pow(10,precision),parts=(Math.round(num*multiplier)/multiplier).toString().split(".");return parts[0]=parts[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),parts.join(".")}animateValue(element,targetValue,precision,duration,easing){const startTime=performance.now(),easeFunctions={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>t*(2-t),easeInOutQuad:t=>t<.5?2*t*t:(4-2*t)*t-1,easeInCubic:t=>t*t*t,easeOutCubic:t=>--t*t*t+1,easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeOutQuart:t=>1- --t*t*t*t},ease=easeFunctions[easing]||easeFunctions.easeOutQuart;element.classList.add("animating");const updateValue=currentTime=>{const elapsed=currentTime-startTime,progress=Math.min(elapsed/duration,1),easedProgress=ease(progress),currentValue=0+(targetValue-0)*easedProgress;element.textContent=this.formatNumber(currentValue,precision),progress<1?requestAnimationFrame(updateValue):(element.textContent=this.formatNumber(targetValue,precision),element.classList.remove("animating"))};requestAnimationFrame(updateValue)}parseStyles(styles){return styles?"function"==typeof styles?styles():styles:{}}updateData(newData){this.options.data=newData,this.init()}updateOptions(newOptions){this.options={...this.options,...newOptions},this.init()}reRender(){this.init()}destroy(){this.clearContainer();const styleElement=document.getElementById("ng-statistic-styles");styleElement&&styleElement.remove()}}const NGStatisticExample={basic:function(containerId){return new NGStatistic(containerId,{data:[{title:"活跃用户",value:45678,prefix:"$",precision:0,animation:!0},{title:"新增用户",value:1234,suffix:"人",animation:!0}],itemsPerRow:2,centered:!0})},advanced:function(containerId){return new NGStatistic(containerId,{data:[{title:"总销售额",value:126560,prefix:"¥",suffix:"元",precision:2,animation:!0,styles:{value:{color:"#1890ff"}}},{title:"访问量",value:8846,animation:!0,styles:{value:{color:"#52c41a"}}},{title:"转化率",value:65.42,suffix:"%",precision:2,animation:!0,styles:{value:{color:"#722ed1"}}},{title:"订单数",value:6543,animation:!0,styles:{value:{color:"#fa8c16"}}}],itemsPerRow:2,centered:!0,valueSize:36,titleSize:16,containerStyle:{padding:"24px",backgroundColor:"#fafafa",borderRadius:"8px",border:"1px solid #f0f0f0",margin:"16px 0"}})},custom:function(containerId){return new NGStatistic(containerId,{data:[{title:"完成率",value:85.5,suffix:"%",precision:1,animation:!0,classNames:{container:"custom-stat-item",value:"custom-value"},styles:{container:{padding:"16px",borderRadius:"12px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white"},value:{color:"#fff",textShadow:"0 2px 4px rgba(0,0,0,0.2)"},title:{color:"rgba(255,255,255,0.8)",fontSize:"14px",fontWeight:"500"},suffix:{color:"rgba(255,255,255,0.9)"}}},{title:"响应时间",value:124,suffix:"ms",precision:0,animation:!0,styles:{container:{padding:"16px",borderRadius:"12px",backgroundColor:"#13c2c2",color:"white"},value:{color:"#fff"},title:{color:"rgba(255,255,255,0.8)"},suffix:{color:"rgba(255,255,255,0.9)"}}}],itemsPerRow:2,centered:!0,containerStyle:{gap:"16px"}})}};"undefined"!=typeof module&&module.exports&&(module.exports={NGStatistic:NGStatistic,NGStatisticExample:NGStatisticExample}),"undefined"!=typeof window&&(window.NGStatistic=NGStatistic,window.NGStatisticExample=NGStatisticExample);class NgSwitch{constructor(options={}){this.injectStyles(),this.config={target:null,checked:!1,disabled:!1,size:"default",style:{checkedColor:"#1890ff",uncheckedColor:"#bfbfbf",checkedText:"",uncheckedText:""},onChange:null,...options},this.checked=this.config.checked,this.disabled=this.config.disabled,this.createElement(),this.appendToTarget(),this.bindEvents()}injectStyles(){if(document.getElementById("ng-switch-styles"))return;const style=document.createElement("style");style.id="ng-switch-styles",style.textContent="\n            /* Switch 组件样式 */\n            .ng-switch {\n                position: relative;\n                display: inline-block;\n                box-sizing: border-box;\n                border-radius: 100px;\n                border: 1px solid transparent;\n                background-color: #bfbfbf;\n                cursor: pointer;\n                transition: all 0.3s;\n                user-select: none;\n                vertical-align: middle;\n                overflow: hidden;\n                width: 60px;\n                height: 30px;\n                min-width: 60px;\n                min-height: 30px;\n            }\n            \n            .ng-switch:hover {\n                opacity: 0.8;\n            }\n            \n            .ng-switch:focus {\n                outline: none;\n                box-shadow: 0 0 0 3px rgba(24, 144, 255, 0.2);\n            }\n            \n            .ng-switch-handle {\n                position: absolute;\n                top: 2px;\n                left: 2px;\n                width: 26px;\n                height: 26px;\n                background-color: white;\n                border-radius: 50%;\n                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n                transition: all 0.3s cubic-bezier(0.12, 0.4, 0.29, 1.46);\n            }\n            \n            .ng-switch-inner {\n                display: block;\n                margin: 0 8px 0 30px;\n                color: white;\n                font-size: 12px;\n                line-height: 26px;\n                transition: margin 0.3s;\n                font-weight: 500;\n                text-align: center;\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n            }\n            \n            /* 小型Switch样式 */\n            .ng-switch-small {\n                width: 40px !important;\n                height: 20px !important;\n                min-width: 40px !important;\n                min-height: 20px !important;\n            }\n            \n            .ng-switch-small .ng-switch-handle {\n                width: 16px !important;\n                height: 16px !important;\n                top: 2px !important;\n                left: 2px !important;\n            }\n            \n            .ng-switch-small .ng-switch-inner {\n                line-height: 16px;\n                font-size: 10px;\n                margin: 0 5px 0 20px;\n            }\n            \n            .ng-switch-small.ng-switch-checked .ng-switch-inner {\n                margin: 0 20px 0 5px !important;\n            }\n            \n            /* 选中状态样式 */\n            .ng-switch-checked {\n                background-color: #1890ff !important;\n            }\n            \n            .ng-switch-checked .ng-switch-handle {\n                left: calc(100% - 26px - 2px) !important;\n            }\n            \n            .ng-switch-checked .ng-switch-inner {\n                margin: 0 30px 0 8px !important;\n            }\n            \n            /* 小型选中状态 */\n            .ng-switch-small.ng-switch-checked .ng-switch-handle {\n                left: calc(100% - 16px - 2px) !important;\n            }\n            \n            /* 禁用状态 */\n            .ng-switch-disabled {\n                opacity: 0.5 !important;\n                cursor: not-allowed !important;\n            }\n            \n            .ng-switch-disabled:hover {\n                opacity: 0.5 !important;\n            }\n            \n            /* 加载动画 */\n            @keyframes ng-switch-loading {\n                0% {\n                    transform: rotate(0deg);\n                }\n                100% {\n                    transform: rotate(360deg);\n                }\n            }\n            \n            .ng-switch-loading .ng-switch-handle {\n                position: relative;\n            }\n            \n            .ng-switch-loading .ng-switch-handle::before {\n                content: '';\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                border: 2px solid #f0f0f0;\n                border-top-color: #1890ff;\n                border-radius: 50%;\n                animation: ng-switch-loading 1s linear infinite;\n            }\n        ",document.head.appendChild(style)}createElement(){this.switchElement=document.createElement("div"),this.switchElement.className="ng-switch",this.switchElement.setAttribute("role","switch"),this.switchElement.setAttribute("aria-checked",this.checked),this.switchElement.setAttribute("tabindex",this.disabled?"-1":"0"),this.checked&&this.switchElement.classList.add("ng-switch-checked"),this.disabled&&this.switchElement.classList.add("ng-switch-disabled"),"small"===this.config.size&&this.switchElement.classList.add("ng-switch-small"),this.handleElement=document.createElement("div"),this.handleElement.className="ng-switch-handle",this.innerElement=document.createElement("div"),this.innerElement.className="ng-switch-inner",this.switchElement.appendChild(this.innerElement),this.switchElement.appendChild(this.handleElement),this.applyStyle(),this.updateDisabledState()}appendToTarget(){if(!this.config.target)return;let targetElement;"string"==typeof this.config.target?targetElement=document.querySelector(this.config.target):this.config.target instanceof HTMLElement&&(targetElement=this.config.target),targetElement&&(targetElement.innerHTML="",targetElement.appendChild(this.switchElement))}applyStyle(){const{checkedColor:checkedColor,uncheckedColor:uncheckedColor,checkedText:checkedText,uncheckedText:uncheckedText}=this.config.style;this.switchElement.style.backgroundColor=this.checked?checkedColor:uncheckedColor,this.innerElement.textContent=this.checked?checkedText:uncheckedText,this.checked?this.switchElement.classList.add("ng-switch-checked"):this.switchElement.classList.remove("ng-switch-checked")}updateSize(){"small"===this.config.size?this.switchElement.classList.add("ng-switch-small"):this.switchElement.classList.remove("ng-switch-small")}updateDisabledState(){this.disabled?(this.switchElement.classList.add("ng-switch-disabled"),this.switchElement.style.cursor="not-allowed",this.switchElement.setAttribute("tabindex","-1")):(this.switchElement.classList.remove("ng-switch-disabled"),this.switchElement.style.cursor="pointer",this.switchElement.setAttribute("tabindex","0"))}bindEvents(){this.disabled||(this.switchElement.addEventListener("click",e=>{e.stopPropagation(),this.toggle()}),this.switchElement.addEventListener("keydown",e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),this.toggle())}))}toggle(checked=null){if(!this.disabled)return this.checked=null!==checked?checked:!this.checked,this.switchElement.setAttribute("aria-checked",this.checked),this.applyStyle(),"function"==typeof this.config.onChange&&this.config.onChange(this.checked),this.checked}setDisabled(disabled){if(this.disabled=disabled,this.updateDisabledState(),disabled){const newElement=this.switchElement.cloneNode(!0);this.switchElement.parentNode.replaceChild(newElement,this.switchElement),this.switchElement=newElement}else this.bindEvents()}setSize(size){"small"===size||"default"===size?(this.config.size=size,this.updateSize()):console.warn('NgSwitch: size参数应为 "small" 或 "default"')}setStyle(style){this.config.style={...this.config.style,...style},this.applyStyle()}getChecked(){return this.checked}getElement(){return this.switchElement}destroy(){this.switchElement&&this.switchElement.parentNode&&this.switchElement.parentNode.removeChild(this.switchElement)}setLoading(loading){loading?(this.switchElement.classList.add("ng-switch-loading"),this.setDisabled(!0)):(this.switchElement.classList.remove("ng-switch-loading"),this.setDisabled(!1))}}function initSwitchesBySelector(selector,options={}){const elements=document.querySelectorAll(selector),switches=[];return elements.forEach(element=>{const switchInstance=new NgSwitch({target:element,...options});switches.push(switchInstance)}),switches}"undefined"!=typeof module&&void 0!==module.exports?module.exports={NgSwitch:NgSwitch,initSwitchesBySelector:initSwitchesBySelector}:(window.NgSwitch=NgSwitch,window.initSwitchesBySelector=initSwitchesBySelector);class NgTabs{constructor(container,options={}){if(!container)throw new Error("NgTabs: 必须提供容器元素");if(this.container="string"==typeof container?document.querySelector(container):container,!this.container)throw new Error(`NgTabs: 未找到容器元素 ${container}`);this.defaultOptions={items:[],defaultActiveKey:"0",tabPosition:"top",type:"line",size:"middle",centered:!1,closable:!1,showCloseButton:!0,showAddButton:!1,addButtonPosition:"end",newTabClosable:!0,newTabShowClose:!0,indicator:{size:"auto",align:"center"},onChange:null,onEdit:null,destroyOnHide:!1,animated:!0,extraContent:null,addIcon:"+",moreIcon:"⋯",style:{},className:""},this.options=this.deepMerge(this.defaultOptions,options),Array.isArray(this.options.items)||(console.warn("NgTabs: items 必须是一个数组，已自动修正"),this.options.items=[]),this.activeKey=this.validateActiveKey(this.options.defaultActiveKey),this.tabs=[],this.inkBar=null,this.prevBtn=null,this.nextBtn=null,this.navList=null,this.navWrap=null,this.addButton=null,this.operations=null,this.isDestroyed=!1,this.handleResize=this.handleResize.bind(this),this.handleTabClick=this.handleTabClick.bind(this),this.handleAddClick=this.handleAddClick.bind(this),this.handlePrevClick=this.handlePrevClick.bind(this),this.handleNextClick=this.handleNextClick.bind(this),this.handleTabCloseClick=this.handleTabCloseClick.bind(this),this.init()}validateActiveKey(key){if(0===this.options.items.length)return"0";if(!this.options.items.some((item,index)=>(item.key||String(index))===key)){return this.options.items[0].key||"0"}return key}deepMerge(target,source){const output=Object.assign({},target);return this.isObject(target)&&this.isObject(source)&&Object.keys(source).forEach(key=>{this.isObject(source[key])?key in target?output[key]=this.deepMerge(target[key],source[key]):Object.assign(output,{[key]:source[key]}):Object.assign(output,{[key]:source[key]})}),output}isObject(item){return item&&"object"==typeof item&&!Array.isArray(item)}init(){if(this.isDestroyed)console.warn("NgTabs: 组件已被销毁，无法重新初始化");else try{this.injectStyles(),this.container.innerHTML="",this.tabsContainer=this.createElement("div",{className:`ng-tabs ng-tabs-${this.options.tabPosition} ng-tabs-${this.options.size} ${this.options.className}`.trim(),style:this.options.style}),"card"===this.options.type&&this.addClass(this.tabsContainer,"ng-tabs-card"),this.options.centered&&this.addClass(this.tabsContainer,"ng-tabs-centered"),this.createNav(),this.createContent(),this.container.appendChild(this.tabsContainer),this.renderTabs(),this.setActiveTab(this.activeKey),this.updateInkBar(),this.bindEvents(),requestAnimationFrame(()=>{this.checkScrollButtons(),setTimeout(()=>this.checkScrollButtons(),100)})}catch(error){throw console.error("NgTabs: 初始化失败",error),error}}createElement(tag,options={}){const element=document.createElement(tag);return options.id&&(element.id=options.id),options.className&&(element.className=options.className),options.text&&(element.textContent=options.text),options.html&&(element.innerHTML=options.html),options.style&&Object.keys(options.style).forEach(key=>{void 0!==options.style[key]&&null!==options.style[key]&&(element.style[key]=options.style[key])}),options.dataset&&Object.keys(options.dataset).forEach(key=>{element.dataset[key]=options.dataset[key]}),options.onClick&&element.addEventListener("click",options.onClick),element}addClass(element,className){element&&className&&!element.classList.contains(className)&&element.classList.add(className)}removeClass(element,className){element&&className&&element.classList.contains(className)&&element.classList.remove(className)}injectStyles(){if(document.getElementById("ng-tabs-styles"))return;const style=this.createElement("style",{id:"ng-tabs-styles",text:this.getStyles()});document.head.appendChild(style)}getStyles(){return"\n      /* NgTabs 基础样式 */\n      .ng-tabs {\n        box-sizing: border-box;\n        margin: 0;\n        padding: 0;\n        color: rgba(0, 0, 0, 0.85);\n        font-size: 14px;\n        font-variant: tabular-nums;\n        line-height: 1.5715;\n        list-style: none;\n        font-feature-settings: 'tnum';\n        position: relative;\n        display: flex;\n        overflow: hidden;\n        width: 100%;\n      }\n      \n      /* 标签位置 */\n      .ng-tabs-top {\n        flex-direction: column;\n      }\n      \n      .ng-tabs-bottom {\n        flex-direction: column-reverse;\n      }\n      \n      .ng-tabs-start {\n        flex-direction: row;\n      }\n      \n      .ng-tabs-end {\n        flex-direction: row-reverse;\n      }\n      \n      /* 导航区域 */\n      .ng-tabs-nav {\n        position: relative;\n        display: flex;\n        flex: none;\n        align-items: center;\n        background: #fff;\n        overflow: hidden;\n      }\n      \n      /* 垂直布局时的导航区域调整 */\n      .ng-tabs-start .ng-tabs-nav,\n      .ng-tabs-end .ng-tabs-nav {\n        flex-direction: column;\n        align-items: stretch;\n      }\n      \n      /* 导航包装器 */\n      .ng-tabs-nav-wrap {\n        position: relative;\n        display: inline-block;\n        display: flex;\n        flex: auto;\n        align-self: stretch;\n        overflow: hidden;\n        white-space: nowrap;\n        transform: translate(0);\n        scroll-behavior: smooth;\n      }\n      \n      .ng-tabs-start .ng-tabs-nav-wrap,\n      .ng-tabs-end .ng-tabs-nav-wrap {\n        flex-direction: column;\n      }\n      \n      .ng-tabs-nav-wrap::before,\n      .ng-tabs-nav-wrap::after {\n        position: absolute;\n        z-index: 1;\n        opacity: 0;\n        transition: opacity 0.3s;\n        content: '';\n        pointer-events: none;\n        width: 20px;\n        height: 100%;\n        top: 0;\n      }\n      \n      .ng-tabs-start .ng-tabs-nav-wrap::before,\n      .ng-tabs-start .ng-tabs-nav-wrap::after,\n      .ng-tabs-end .ng-tabs-nav-wrap::before,\n      .ng-tabs-end .ng-tabs-nav-wrap::after {\n        width: 100%;\n        height: 20px;\n        left: 0;\n      }\n      \n      .ng-tabs-nav-wrap::before {\n        left: 0;\n        background: linear-gradient(to right, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0));\n      }\n      \n      .ng-tabs-nav-wrap::after {\n        right: 0;\n        background: linear-gradient(to left, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0));\n      }\n      \n      .ng-tabs-start .ng-tabs-nav-wrap::before {\n        top: 0;\n        background: linear-gradient(to bottom, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0));\n      }\n      \n      .ng-tabs-start .ng-tabs-nav-wrap::after {\n        bottom: 0;\n        background: linear-gradient(to top, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0));\n      }\n      \n      .ng-tabs-end .ng-tabs-nav-wrap::before {\n        top: 0;\n        background: linear-gradient(to bottom, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0));\n      }\n      \n      .ng-tabs-end .ng-tabs-nav-wrap::after {\n        bottom: 0;\n        background: linear-gradient(to top, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0));\n      }\n      \n      /* 导航列表 */\n      .ng-tabs-nav-list {\n        position: relative;\n        display: flex;\n        transition: transform 0.3s;\n        min-height: 40px;\n      }\n      \n      .ng-tabs-top .ng-tabs-nav-list,\n      .ng-tabs-bottom .ng-tabs-nav-list {\n        flex-direction: row;\n      }\n      \n      .ng-tabs-start .ng-tabs-nav-list,\n      .ng-tabs-end .ng-tabs-nav-list {\n        flex-direction: column;\n        min-width: 80px;\n        width: 100%;\n      }\n      \n      /* 单个标签 */\n      .ng-tabs-tab {\n        position: relative;\n        display: inline-flex;\n        align-items: center;\n        padding: 12px 0;\n        font-size: 14px;\n        background: transparent;\n        border: 0;\n        outline: none;\n        cursor: pointer;\n        transition: color 0.3s, background-color 0.3s;\n        user-select: none;\n        white-space: nowrap;\n        box-sizing: border-box;\n      }\n      \n      .ng-tabs-top .ng-tabs-tab,\n      .ng-tabs-bottom .ng-tabs-tab {\n        margin: 0 32px 0 0;\n        min-height: 40px;\n      }\n      \n      .ng-tabs-start .ng-tabs-tab,\n      .ng-tabs-end .ng-tabs-tab {\n        margin: 0 0 8px 0;\n        padding: 8px 16px;\n        justify-content: flex-start;\n        width: 100%;\n      }\n      \n      .ng-tabs-tab:last-child {\n        margin-right: 0;\n        margin-bottom: 0;\n      }\n      \n      .ng-tabs-tab-btn {\n        display: inline-flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      /* 活动标签 */\n      .ng-tabs-tab-active {\n        color: #1890ff;\n        font-weight: 500;\n      }\n      \n      /* 禁用标签 */\n      .ng-tabs-tab-disabled {\n        color: rgba(0, 0, 0, 0.25);\n        cursor: not-allowed;\n      }\n      \n      /* 标签悬停效果 */\n      .ng-tabs-tab:hover:not(.ng-tabs-tab-disabled) {\n        color: #40a9ff;\n      }\n      \n      /* 指示条 */\n      .ng-tabs-ink-bar {\n        position: absolute;\n        background: #1890ff;\n        pointer-events: none;\n        transition: left 0.3s, top 0.3s, width 0.3s, height 0.3s;\n        z-index: 1;\n      }\n      \n      .ng-tabs-top .ng-tabs-ink-bar {\n        bottom: 0;\n        height: 2px;\n      }\n      \n      .ng-tabs-bottom .ng-tabs-ink-bar {\n        top: 0;\n        height: 2px;\n      }\n      \n      .ng-tabs-start .ng-tabs-ink-bar {\n        right: 0;\n        width: 2px;\n      }\n      \n      .ng-tabs-end .ng-tabs-ink-bar {\n        left: 0;\n        width: 2px;\n      }\n      \n      /* 内容区域 */\n      .ng-tabs-content-holder {\n        flex: 1;\n        min-width: 0;\n        min-height: 0;\n        overflow: hidden;\n      }\n      \n      .ng-tabs-content {\n        position: relative;\n        width: 100%;\n        height: 100%;\n      }\n      \n      .ng-tabs-top .ng-tabs-content-holder,\n      .ng-tabs-bottom .ng-tabs-content-holder {\n        order: 1;\n      }\n      \n      /* 内容项 */\n      .ng-tabs-tabpane {\n        display: none;\n        outline: none;\n        transition: opacity 0.3s;\n        height: 100%;\n        width: 100%;\n      }\n      \n      .ng-tabs-tabpane-active {\n        display: block;\n        animation: ng-tabs-fade-in 0.3s;\n      }\n      \n      @keyframes ng-tabs-fade-in {\n        from { opacity: 0; }\n        to { opacity: 1; }\n      }\n      \n      .ng-tabs-tabpane-hidden {\n        display: none;\n      }\n      \n      /* 卡片式标签 */\n      .ng-tabs-card > .ng-tabs-nav .ng-tabs-tab {\n        margin: 0;\n        padding: 8px 16px;\n        background: #fafafa;\n        border: 1px solid #f0f0f0;\n        border-bottom: 0;\n        border-radius: 8px 8px 0 0;\n        transition: all 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);\n      }\n      \n      .ng-tabs-card.ng-tabs-top > .ng-tabs-nav .ng-tabs-tab {\n        border-bottom: 1px solid #f0f0f0;\n        border-radius: 8px 8px 0 0;\n      }\n      \n      .ng-tabs-card.ng-tabs-bottom > .ng-tabs-nav .ng-tabs-tab {\n        border-top: 1px solid #f0f0f0;\n        border-radius: 0 0 8px 8px;\n      }\n      \n      .ng-tabs-card.ng-tabs-top > .ng-tabs-nav .ng-tabs-tab-active {\n        background: #fff;\n        border-bottom-color: #fff;\n      }\n      \n      .ng-tabs-card.ng-tabs-bottom > .ng-tabs-nav .ng-tabs-tab-active {\n        background: #fff;\n        border-top-color: #fff;\n      }\n      \n      .ng-tabs-card.ng-tabs-start > .ng-tabs-nav .ng-tabs-tab,\n      .ng-tabs-card.ng-tabs-end > .ng-tabs-nav .ng-tabs-tab {\n        margin: 0 0 4px 0;\n        border-radius: 8px 0 0 8px;\n        border-right: 0;\n      }\n      \n      .ng-tabs-card.ng-tabs-start > .ng-tabs-nav .ng-tabs-tab-active {\n        border-right-color: #fff;\n      }\n      \n      .ng-tabs-card.ng-tabs-end > .ng-tabs-nav .ng-tabs-tab {\n        margin: 0 0 4px 0;\n        border-radius: 0 8px 8px 0;\n        border-left: 0;\n      }\n      \n      .ng-tabs-card.ng-tabs-end > .ng-tabs-nav .ng-tabs-tab-active {\n        border-left-color: #fff;\n      }\n      \n      .ng-tabs-card > .ng-tabs-nav .ng-tabs-ink-bar {\n        visibility: hidden;\n      }\n      \n      /* 关闭按钮 */\n      .ng-tabs-tab-close {\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        width: 16px;\n        height: 16px;\n        margin-left: 6px;\n        color: rgba(0, 0, 0, 0.45);\n        font-size: 12px;\n        background: transparent;\n        border: 0;\n        border-radius: 50%;\n        outline: none;\n        cursor: pointer;\n        transition: all 0.3s;\n        flex-shrink: 0;\n      }\n      \n      .ng-tabs-tab-close:hover {\n        color: rgba(0, 0, 0, 0.85);\n        background-color: rgba(0, 0, 0, 0.06);\n      }\n      \n      /* 关闭按钮隐藏状态 */\n      .ng-tabs-tab-close-hidden {\n        display: none !important;\n      }\n      \n      /* 滚动按钮 */\n      .ng-tabs-nav-more {\n        display: none;\n        align-items: center;\n        justify-content: center;\n        padding: 8px 12px;\n        background: #fff;\n        border: 1px solid #f0f0f0;\n        cursor: pointer;\n        transition: all 0.3s;\n        z-index: 2;\n        flex-shrink: 0;\n        min-width: 32px;\n        min-height: 32px;\n      }\n      \n      .ng-tabs-nav-more:hover {\n        color: #1890ff;\n        border-color: #1890ff;\n      }\n      \n      .ng-tabs-nav-more-visible {\n        display: flex;\n      }\n      \n      .ng-tabs-nav-operations {\n        display: flex;\n        flex-shrink: 0;\n        align-items: center;\n      }\n      \n      .ng-tabs-start .ng-tabs-nav-operations,\n      .ng-tabs-end .ng-tabs-nav-operations {\n        flex-direction: column;\n        justify-content: center;\n        width: 100%;\n      }\n      \n      .ng-tabs-nav-operations-hidden {\n        display: none !important;\n      }\n      \n      /* 导航包装器的ping效果 */\n      .ng-tabs-nav-wrap-ping-left::before,\n      .ng-tabs-nav-wrap-ping-right::after,\n      .ng-tabs-start.ng-tabs-nav-wrap-ping-left::before,\n      .ng-tabs-start.ng-tabs-nav-wrap-ping-right::after,\n      .ng-tabs-end.ng-tabs-nav-wrap-ping-left::before,\n      .ng-tabs-end.ng-tabs-nav-wrap-ping-right::after {\n        opacity: 1;\n      }\n      \n      /* 标签居中 */\n      .ng-tabs-centered > .ng-tabs-nav .ng-tabs-nav-list {\n        justify-content: center;\n      }\n      \n      /* 尺寸 */\n      .ng-tabs-small .ng-tabs-tab {\n        padding: 8px 0;\n        font-size: 12px;\n        min-height: 32px;\n      }\n      \n      .ng-tabs-small .ng-tabs-nav-list {\n        min-height: 32px;\n      }\n      \n      .ng-tabs-large .ng-tabs-tab {\n        padding: 16px 0;\n        font-size: 16px;\n        min-height: 48px;\n      }\n      \n      .ng-tabs-large .ng-tabs-nav-list {\n        min-height: 48px;\n      }\n      \n      /* 附加内容 */\n      .ng-tabs-extra-content {\n        display: flex;\n        align-items: center;\n        margin-left: auto;\n        padding: 0 12px;\n        border-left: 1px solid #f0f0f0;\n        flex-shrink: 0;\n      }\n      \n      .ng-tabs-start .ng-tabs-extra-content,\n      .ng-tabs-end .ng-tabs-extra-content {\n        margin-left: 0;\n        margin-top: auto;\n        padding: 12px 0;\n        border-left: 0;\n        border-top: 1px solid #f0f0f0;\n        width: 100%;\n        justify-content: center;\n      }\n      \n      /* 添加按钮 */\n      .ng-tabs-add {\n        display: none;\n        align-items: center;\n        justify-content: center;\n        min-width: 40px;\n        min-height: 40px;\n        background: #fafafa;\n        border: 1px solid #f0f0f0;\n        border-radius: 2px;\n        outline: none;\n        cursor: pointer;\n        transition: all 0.3s;\n        font-size: 16px;\n        color: #595959;\n        flex-shrink: 0;\n      }\n      \n      .ng-tabs-add:hover {\n        color: #1890ff;\n        border-color: #1890ff;\n      }\n      \n      .ng-tabs-add-visible {\n        display: flex;\n      }\n      \n      /* 水平布局下的添加按钮 */\n      .ng-tabs-top .ng-tabs-add,\n      .ng-tabs-bottom .ng-tabs-add {\n        height: 100%;\n        margin-left: 4px;\n      }\n      \n      /* 垂直布局下的添加按钮 */\n      .ng-tabs-start .ng-tabs-add,\n      .ng-tabs-end .ng-tabs-add {\n        width: 100%;\n        margin-top: 4px;\n        margin-left: 0;\n      }\n      \n      /* 添加按钮在导航区域的起始位置 */\n      .ng-tabs-add-start {\n        order: -1;\n      }\n      \n      /* 添加按钮在导航区域的结束位置 */\n      .ng-tabs-add-end {\n        order: 1;\n      }\n      \n      /* 移动端适配 */\n      @media (max-width: 768px) {\n        .ng-tabs-start,\n        .ng-tabs-end {\n          flex-direction: column;\n        }\n        \n        .ng-tabs-start .ng-tabs-nav,\n        .ng-tabs-end .ng-tabs-nav {\n          min-width: 100%;\n          flex-direction: row;\n        }\n        \n        .ng-tabs-start .ng-tabs-nav-list,\n        .ng-tabs-end .ng-tabs-nav-list {\n          flex-direction: row;\n        }\n        \n        .ng-tabs-start .ng-tabs-tab,\n        .ng-tabs-end .ng-tabs-tab {\n          margin: 0 16px 0 0;\n          padding: 8px 0;\n          width: auto;\n        }\n        \n        .ng-tabs-start .ng-tabs-add,\n        .ng-tabs-end .ng-tabs-add {\n          width: auto;\n          margin-top: 0;\n          margin-left: 4px;\n        }\n        \n        .ng-tabs-start .ng-tabs-extra-content,\n        .ng-tabs-end .ng-tabs-extra-content {\n          width: auto;\n          margin-top: 0;\n          margin-left: auto;\n          padding: 0 12px;\n          border-top: 0;\n          border-left: 1px solid #f0f0f0;\n        }\n      }\n    "}createNav(){this.nav=this.createElement("div",{className:"ng-tabs-nav"}),this.navWrap=this.createElement("div",{className:"ng-tabs-nav-wrap"}),this.navList=this.createElement("div",{className:"ng-tabs-nav-list"}),this.inkBar=this.createElement("div",{className:"ng-tabs-ink-bar"}),this.prevBtn=this.createElement("button",{className:"ng-tabs-nav-more ng-tabs-nav-prev",html:'<span class="ng-tabs-nav-more-icon">‹</span>',onClick:this.handlePrevClick}),this.nextBtn=this.createElement("button",{className:"ng-tabs-nav-more ng-tabs-nav-next",html:'<span class="ng-tabs-nav-more-icon">›</span>',onClick:this.handleNextClick}),this.operations=this.createElement("div",{className:"ng-tabs-nav-operations ng-tabs-nav-operations-hidden"}),this.options.extraContent&&(this.extraContent=this.createElement("div",{className:"ng-tabs-extra-content",html:this.options.extraContent})),this.options.showAddButton&&(this.addButton=this.createElement("button",{className:`ng-tabs-add ng-tabs-add-${this.options.addButtonPosition} ng-tabs-add-visible`,html:this.options.addIcon,dataset:{action:"add"},onClick:this.handleAddClick})),this.navList.appendChild(this.inkBar),this.navWrap.appendChild(this.navList),this.operations.appendChild(this.prevBtn),this.operations.appendChild(this.nextBtn),this.rearrangeNav(),this.tabsContainer.appendChild(this.nav)}rearrangeNav(){this.nav.innerHTML="","top"===this.options.tabPosition||"bottom"===this.options.tabPosition?(this.addButton&&"start"===this.options.addButtonPosition&&this.nav.appendChild(this.addButton),this.nav.appendChild(this.operations),this.nav.appendChild(this.navWrap),this.addButton&&"end"===this.options.addButtonPosition&&this.nav.appendChild(this.addButton),this.options.extraContent&&this.nav.appendChild(this.extraContent)):(this.addButton&&"start"===this.options.addButtonPosition&&this.nav.appendChild(this.addButton),this.nav.appendChild(this.navWrap),this.addButton&&"end"===this.options.addButtonPosition&&this.nav.appendChild(this.addButton),this.nav.appendChild(this.operations),this.options.extraContent&&this.nav.appendChild(this.extraContent))}createContent(){this.contentHolder=this.createElement("div",{className:"ng-tabs-content-holder"}),this.content=this.createElement("div",{className:"ng-tabs-content"}),this.contentHolder.appendChild(this.content),this.tabsContainer.appendChild(this.contentHolder)}renderTabs(){if(this.navList.querySelectorAll(".ng-tabs-tab:not(.ng-tabs-ink-bar)").forEach(tab=>tab.remove()),this.content.innerHTML="",this.tabs=[],0===this.options.items.length){const emptyTab=this.createElement("div",{className:"ng-tabs-tab ng-tabs-tab-disabled",text:"无标签页"});this.navList.insertBefore(emptyTab,this.inkBar);const emptyPane=this.createElement("div",{className:"ng-tabs-tabpane ng-tabs-tabpane-active",text:"暂无内容"});return void this.content.appendChild(emptyPane)}this.options.items.forEach((item,index)=>{try{const key=item.key||String(index),tab=this.createElement("div",{className:"ng-tabs-tab "+(item.disabled?"ng-tabs-tab-disabled":""),dataset:{key:key}}),tabBtn=this.createElement("span",{className:"ng-tabs-tab-btn",html:item.label||`Tab ${index+1}`});tab.appendChild(tabBtn);const shouldShowClose=this.shouldShowCloseButton(item);if(shouldShowClose){const closeBtn=this.createElement("button",{className:"ng-tabs-tab-close",html:"×",dataset:{key:key}});tab.appendChild(closeBtn)}this.navList.insertBefore(tab,this.inkBar);const pane=this.createElement("div",{className:"ng-tabs-tabpane ng-tabs-tabpane-hidden",dataset:{key:key}});if("string"==typeof item.content)pane.innerHTML=item.content;else if(item.content instanceof HTMLElement)pane.appendChild(item.content);else if("function"==typeof item.content){const content=item.content();"string"==typeof content?pane.innerHTML=content:content instanceof HTMLElement?pane.appendChild(content):pane.textContent="内容加载失败"}else void 0!==item.content&&null!==item.content?pane.textContent=String(item.content):pane.textContent=`Content of tab ${index+1}`;this.content.appendChild(pane),this.tabs.push({key:key,tabElement:tab,paneElement:pane,disabled:item.disabled||!1,closable:void 0!==item.closable?item.closable:this.options.closable,showClose:shouldShowClose,isNewTab:item.isNewTab||!1})}catch(error){console.error("NgTabs: 渲染标签页失败",error,item)}})}shouldShowCloseButton(item){return!!this.options.showCloseButton&&(!(item.isNewTab&&void 0!==this.options.newTabShowClose&&!this.options.newTabShowClose)&&("boolean"==typeof item.closable?item.closable:item.isNewTab&&void 0!==this.options.newTabClosable?this.options.newTabClosable:this.options.closable))}setActiveTab(key){if(0===this.tabs.length)return;const targetTab=this.tabs.find(tab=>tab.key===key);if(targetTab&&!targetTab.disabled&&(this.tabs.forEach(tab=>{this.removeClass(tab.tabElement,"ng-tabs-tab-active"),this.addClass(tab.paneElement,"ng-tabs-tabpane-hidden"),this.removeClass(tab.paneElement,"ng-tabs-tabpane-active")}),this.addClass(targetTab.tabElement,"ng-tabs-tab-active"),this.removeClass(targetTab.paneElement,"ng-tabs-tabpane-hidden"),this.addClass(targetTab.paneElement,"ng-tabs-tabpane-active"),this.activeKey=key,this.updateInkBar(),requestAnimationFrame(()=>{this.scrollToActiveTab()}),this.options.onChange&&"function"==typeof this.options.onChange))try{this.options.onChange(key)}catch(error){console.error("NgTabs: onChange回调执行失败",error)}}updateInkBar(){const activeTab=this.tabs.find(tab=>tab.key===this.activeKey);activeTab&&requestAnimationFrame(()=>{try{const tabRect=activeTab.tabElement.getBoundingClientRect(),navListRect=this.navList.getBoundingClientRect();let inkBarSize="auto";if("auto"!==this.options.indicator.size&&(inkBarSize=this.options.indicator.size),"top"===this.options.tabPosition||"bottom"===this.options.tabPosition){const left=tabRect.left-navListRect.left,width="auto"===inkBarSize?tabRect.width:inkBarSize;let finalLeft=left;"center"===this.options.indicator.align?finalLeft=left+(tabRect.width-parseFloat(width))/2:"right"===this.options.indicator.align&&(finalLeft=left+tabRect.width-parseFloat(width)),this.inkBar.style.left=`${finalLeft}px`,this.inkBar.style.width=width,this.inkBar.style.height="2px",this.inkBar.style.top=""}else{const top=tabRect.top-navListRect.top,height="auto"===inkBarSize?tabRect.height:inkBarSize;let finalTop=top;"center"===this.options.indicator.align?finalTop=top+(tabRect.height-parseFloat(height))/2:"bottom"===this.options.indicator.align&&(finalTop=top+tabRect.height-parseFloat(height)),this.inkBar.style.top=`${finalTop}px`,this.inkBar.style.height=height,this.inkBar.style.width="2px",this.inkBar.style.left=""}}catch(error){console.error("NgTabs: 更新指示条失败",error)}})}handleResize(){this.updateInkBar(),this.checkScrollButtons()}handleTabClick(e){const tabElement=e.target.closest(".ng-tabs-tab"),closeButton=e.target.closest(".ng-tabs-tab-close");if(closeButton){e.stopPropagation();const key=closeButton.dataset.key;return void this.handleTabClose(key)}if(tabElement&&!tabElement.classList.contains("ng-tabs-tab-disabled")){const key=tabElement.dataset.key;key&&key!==this.activeKey&&this.setActiveTab(key)}}handleTabCloseClick(e){e.stopPropagation();const closeButton=e.target.closest(".ng-tabs-tab-close");if(closeButton){const key=closeButton.dataset.key;this.handleTabClose(key)}}handleAddClick(){this.handleAddTab()}handlePrevClick(){this.scroll("prev")}handleNextClick(){this.scroll("next")}bindEvents(){this.navList.addEventListener("click",this.handleTabClick),this.navList.addEventListener("click",this.handleTabCloseClick),window.addEventListener("resize",this.handleResize)}scrollToActiveTab(){const activeTab=this.tabs.find(tab=>tab.key===this.activeKey);if(activeTab)try{const tabRect=activeTab.tabElement.getBoundingClientRect(),navWrapRect=this.navWrap.getBoundingClientRect();"top"===this.options.tabPosition||"bottom"===this.options.tabPosition?tabRect.right>navWrapRect.right?this.navList.scrollLeft+=tabRect.right-navWrapRect.right+10:tabRect.left<navWrapRect.left&&(this.navList.scrollLeft-=navWrapRect.left-tabRect.left+10):tabRect.bottom>navWrapRect.bottom?this.navList.scrollTop+=tabRect.bottom-navWrapRect.bottom+10:tabRect.top<navWrapRect.top&&(this.navList.scrollTop-=navWrapRect.top-tabRect.top+10),this.checkScrollButtons()}catch(error){console.error("NgTabs: 滚动到活动标签失败",error)}}checkScrollButtons(){if(this.navList&&this.navWrap)try{const hasHorizontalScroll=this.navList.scrollWidth>this.navWrap.clientWidth+1,hasVerticalScroll=this.navList.scrollHeight>this.navWrap.clientHeight+1;if("top"===this.options.tabPosition||"bottom"===this.options.tabPosition)if(hasHorizontalScroll){this.addClass(this.prevBtn,"ng-tabs-nav-more-visible"),this.addClass(this.nextBtn,"ng-tabs-nav-more-visible"),this.removeClass(this.operations,"ng-tabs-nav-operations-hidden");const isAtStart=this.navList.scrollLeft<=1,isAtEnd=Math.ceil(this.navList.scrollLeft+this.navWrap.clientWidth)>=this.navList.scrollWidth-1;isAtStart?this.removeClass(this.navWrap,"ng-tabs-nav-wrap-ping-left"):this.addClass(this.navWrap,"ng-tabs-nav-wrap-ping-left"),isAtEnd?this.removeClass(this.navWrap,"ng-tabs-nav-wrap-ping-right"):this.addClass(this.navWrap,"ng-tabs-nav-wrap-ping-right")}else this.removeClass(this.prevBtn,"ng-tabs-nav-more-visible"),this.removeClass(this.nextBtn,"ng-tabs-nav-more-visible"),this.addClass(this.operations,"ng-tabs-nav-operations-hidden"),this.removeClass(this.navWrap,"ng-tabs-nav-wrap-ping-left"),this.removeClass(this.navWrap,"ng-tabs-nav-wrap-ping-right");else if(hasVerticalScroll){this.addClass(this.prevBtn,"ng-tabs-nav-more-visible"),this.addClass(this.nextBtn,"ng-tabs-nav-more-visible"),this.removeClass(this.operations,"ng-tabs-nav-operations-hidden");const isAtStart=this.navList.scrollTop<=1,isAtEnd=Math.ceil(this.navList.scrollTop+this.navWrap.clientHeight)>=this.navList.scrollHeight-1;isAtStart?this.removeClass(this.navWrap,"ng-tabs-nav-wrap-ping-left"):this.addClass(this.navWrap,"ng-tabs-nav-wrap-ping-left"),isAtEnd?this.removeClass(this.navWrap,"ng-tabs-nav-wrap-ping-right"):this.addClass(this.navWrap,"ng-tabs-nav-wrap-ping-right")}else this.removeClass(this.prevBtn,"ng-tabs-nav-more-visible"),this.removeClass(this.nextBtn,"ng-tabs-nav-more-visible"),this.addClass(this.operations,"ng-tabs-nav-operations-hidden"),this.removeClass(this.navWrap,"ng-tabs-nav-wrap-ping-left"),this.removeClass(this.navWrap,"ng-tabs-nav-wrap-ping-right")}catch(error){console.error("NgTabs: 检查滚动按钮状态失败",error)}}scroll(direction){if(!this.navList)return;try{if("top"===this.options.tabPosition||"bottom"===this.options.tabPosition){const currentScroll=this.navList.scrollLeft,newScroll="next"===direction?currentScroll+200:currentScroll-200;this.navList.scrollLeft=newScroll}else{const currentScroll=this.navList.scrollTop,newScroll="next"===direction?currentScroll+200:currentScroll-200;this.navList.scrollTop=newScroll}setTimeout(()=>this.checkScrollButtons(),50)}catch(error){console.error("NgTabs: 滚动标签失败",error)}}handleTabClose(key){const index=this.options.items.findIndex(item=>(item.key||String(this.options.items.indexOf(item)))===key);if(-1!==index){if(this.options.onEdit&&"function"==typeof this.options.onEdit)try{this.options.onEdit(key,"remove")}catch(error){console.error("NgTabs: onEdit回调执行失败",error)}if(key===this.activeKey){const newIndex=Math.max(0,index-1),newKey=this.options.items[newIndex]?.key||String(newIndex);this.setActiveTab(newKey)}if(this.options.items.splice(index,1),this.renderTabs(),!this.tabs.find(tab=>tab.key===this.activeKey)&&this.tabs.length>0){const firstKey=this.tabs[0].key;this.setActiveTab(firstKey)}this.updateInkBar(),requestAnimationFrame(()=>{this.checkScrollButtons()})}else console.warn(`NgTabs: 未找到要关闭的标签 ${key}`)}handleAddTab(){if(this.options.onEdit&&"function"==typeof this.options.onEdit)try{this.options.onEdit(null,"add")}catch(error){console.error("NgTabs: onEdit回调执行失败",error)}else{const newIndex=this.options.items.length,newKey=`tab-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,newTabItem={key:newKey,label:`New Tab ${newIndex+1}`,content:`Content of new tab ${newIndex+1}`,isNewTab:!0,closable:this.options.newTabClosable};this.options.items.push(newTabItem),this.renderTabs(),this.setActiveTab(newKey),this.checkScrollButtons()}}updateItem(key,newItem){const index=this.options.items.findIndex(item=>(item.key||String(this.options.items.indexOf(item)))===key);return-1!==index&&(this.options.items[index]={...this.options.items[index],...newItem},this.renderTabs(),this.setActiveTab(this.activeKey),this.checkScrollButtons(),!0)}addItem(item,index=-1){try{return void 0===item.isNewTab&&(item.isNewTab=!1),-1===index||index>=this.options.items.length?this.options.items.push(item):this.options.items.splice(index,0,item),this.renderTabs(),this.checkScrollButtons(),!0}catch(error){return console.error("NgTabs: 添加标签项失败",error),!1}}removeItem(key){this.handleTabClose(key)}setTabPosition(position){["top","bottom","start","end"].includes(position)||(console.warn(`NgTabs: 无效的标签位置 ${position}，使用默认值 top`),position="top"),this.options.tabPosition=position,["top","bottom","start","end"].forEach(pos=>{this.removeClass(this.tabsContainer,`ng-tabs-${pos}`)}),this.addClass(this.tabsContainer,`ng-tabs-${position}`),this.rearrangeNav(),requestAnimationFrame(()=>{this.updateInkBar(),this.checkScrollButtons()})}setType(type){["line","card"].includes(type)||(console.warn(`NgTabs: 无效的标签类型 ${type}，使用默认值 line`),type="line"),this.options.type=type,"card"===type?this.addClass(this.tabsContainer,"ng-tabs-card"):this.removeClass(this.tabsContainer,"ng-tabs-card"),this.renderTabs(),this.setActiveTab(this.activeKey)}setSize(size){["small","middle","large"].includes(size)||(console.warn(`NgTabs: 无效的标签尺寸 ${size}，使用默认值 middle`),size="middle"),this.options.size=size,["small","middle","large"].forEach(s=>{this.removeClass(this.tabsContainer,`ng-tabs-${s}`)}),this.addClass(this.tabsContainer,`ng-tabs-${size}`)}setCentered(centered){this.options.centered=!!centered,centered?this.addClass(this.tabsContainer,"ng-tabs-centered"):this.removeClass(this.tabsContainer,"ng-tabs-centered")}setClosable(closable){this.options.closable=!!closable,this.renderTabs(),this.setActiveTab(this.activeKey)}setShowCloseButton(showCloseButton){this.options.showCloseButton=!!showCloseButton,this.renderTabs(),this.setActiveTab(this.activeKey)}setNewTabClosable(newTabClosable){this.options.newTabClosable=!!newTabClosable}setNewTabShowClose(newTabShowClose){this.options.newTabShowClose=!!newTabShowClose}setShowAddButton(showAddButton){this.options.showAddButton=!!showAddButton,showAddButton&&!this.addButton?(this.addButton=this.createElement("button",{className:`ng-tabs-add ng-tabs-add-${this.options.addButtonPosition} ng-tabs-add-visible`,html:this.options.addIcon,dataset:{action:"add"},onClick:this.handleAddClick}),this.rearrangeNav()):!showAddButton&&this.addButton&&(this.addButton.remove(),this.addButton=null,this.rearrangeNav())}setAddButtonPosition(position){["start","end"].includes(position)||(console.warn(`NgTabs: 无效的添加按钮位置 ${position}，使用默认值 end`),position="end"),position!==this.options.addButtonPosition&&(this.options.addButtonPosition=position,this.addButton&&(this.removeClass(this.addButton,"ng-tabs-add-start"),this.removeClass(this.addButton,"ng-tabs-add-end"),this.addClass(this.addButton,`ng-tabs-add-${position}`),this.rearrangeNav()))}setIndicator(indicator){this.options.indicator={...this.options.indicator,...indicator},this.updateInkBar()}setExtraContent(content){this.options.extraContent=content,this.extraContent?content?(this.extraContent.innerHTML=content,this.removeClass(this.extraContent,"ng-tabs-nav-operations-hidden")):(this.extraContent.innerHTML="",this.addClass(this.extraContent,"ng-tabs-nav-operations-hidden")):content&&(this.extraContent=this.createElement("div",{className:"ng-tabs-extra-content",html:content}),this.rearrangeNav())}getActiveKey(){return this.activeKey}getItems(){return[...this.options.items]}getTabCount(){return this.options.items.length}refresh(){this.isDestroyed?console.warn("NgTabs: 组件已被销毁，无法刷新"):(this.renderTabs(),this.setActiveTab(this.activeKey),this.updateInkBar(),this.checkScrollButtons())}destroy(){this.isDestroyed||(this.navList.removeEventListener("click",this.handleTabClick),this.navList.removeEventListener("click",this.handleTabCloseClick),window.removeEventListener("resize",this.handleResize),this.addButton&&this.addButton.removeEventListener("click",this.handleAddClick),this.prevBtn&&this.prevBtn.removeEventListener("click",this.handlePrevClick),this.nextBtn&&this.nextBtn.removeEventListener("click",this.handleNextClick),this.container.innerHTML="",this.tabs=[],this.activeKey="0",this.addButton=null,this.extraContent=null,this.isDestroyed=!0)}}"undefined"!=typeof module&&module.exports?module.exports=NgTabs:"function"==typeof define&&define.amd?define([],function(){return NgTabs}):window.NgTabs=NgTabs;class TimelineComponent{constructor(containerId,options={}){if(this.container=document.getElementById(containerId),!this.container)throw new Error(`容器元素 #${containerId} 不存在`);this.defaultOptions={mode:"vertical",position:"alternate",lineColor:"#f0f0f0",lineWidth:2,dotSize:10,dotBorderWidth:2,pending:null,reverse:!1,dateFormat:"YYYY-MM-DD",showTooltips:!0,clickable:!0,animation:!0,maxEvents:50,timelinePosition:"center",completedStyle:"filled",incompleteStyle:"outline",pendingStyle:"spinning"},this.options={...this.defaultOptions,...options},this.events=[],this.tooltip=null,this._initialized=!1,this._eventHandlers=new Map,this._init()}_init(){this._createTooltip(),this._addStyles(),this.render(),this._initialized=!0}_createTooltip(){this.tooltip=document.createElement("div"),this.tooltip.className="timeline-tooltip",this.tooltip.style.cssText="\n            position: absolute;\n            background: rgba(0, 0, 0, 0.75);\n            color: white;\n            padding: 6px 12px;\n            border-radius: 4px;\n            font-size: 12px;\n            z-index: 1000;\n            white-space: nowrap;\n            pointer-events: none;\n            opacity: 0;\n            transition: opacity 0.3s;\n            max-width: 250px;\n            word-wrap: break-word;\n            white-space: normal;\n            line-height: 1.5;\n        ",document.body.appendChild(this.tooltip)}_addStyles(){const styleId="timeline-component-fixed-styles";if(document.getElementById(styleId))return;const style=document.createElement("style");style.id=styleId,style.textContent="\n            /* 时间轴容器 */\n            .timeline-container {\n                position: relative;\n                width: 100%;\n                margin: 0 auto;\n            }\n            \n            /* 时间轴 */\n            .timeline {\n                margin: 0;\n                padding: 20px 0;\n                list-style: none;\n                position: relative;\n            }\n            \n            /* 垂直时间轴 - 中央时间线 */\n            .timeline-vertical {\n                position: relative;\n            }\n            \n            .timeline-vertical::before {\n                content: '';\n                position: absolute;\n                top: 0;\n                bottom: 0;\n                left: 50%;\n                transform: translateX(-50%);\n                width: var(--timeline-line-width, 2px);\n                background: var(--timeline-line-color, #f0f0f0);\n                z-index: 1;\n            }\n            \n            /* 水平时间轴 - 中央时间线 */\n            .timeline-horizontal {\n                display: flex;\n                padding: 40px 20px;\n                position: relative;\n                overflow-x: auto;\n            }\n            \n            .timeline-horizontal::before {\n                content: '';\n                position: absolute;\n                left: 20px;\n                right: 20px;\n                top: 50%;\n                transform: translateY(-50%);\n                height: var(--timeline-line-width, 2px);\n                background: var(--timeline-line-color, #f0f0f0);\n                z-index: 1;\n            }\n            \n            /* 时间轴项 */\n            .timeline-item {\n                position: relative;\n                margin-bottom: 20px;\n                z-index: 2;\n            }\n            \n            .timeline-item:last-child {\n                margin-bottom: 0;\n            }\n            \n            .timeline-item-horizontal {\n                flex: 1;\n                min-width: 200px;\n                margin-bottom: 0;\n            }\n            \n            /* 时间轴节点（关键修复） */\n            .timeline-dot-container {\n                position: absolute;\n                z-index: 3;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n            \n            /* 垂直时间轴的节点位置 */\n            .timeline-vertical .timeline-dot-container {\n                top: 0;\n                width: var(--timeline-dot-size, 10px);\n                height: 20px;\n                left: 50%;\n                transform: translateX(-50%);\n            }\n            \n            /* 水平时间轴的节点位置 */\n            .timeline-horizontal .timeline-dot-container {\n                left: 0;\n                right: 0;\n                height: var(--timeline-dot-size, 10px);\n                top: 50%;\n                transform: translateY(-50%);\n            }\n            \n            /* 节点基础样式 */\n            .timeline-dot {\n                width: var(--timeline-dot-size, 10px);\n                height: var(--timeline-dot-size, 10px);\n                border-radius: 50%;\n                border: var(--dot-border-width, 2px) solid;\n                box-sizing: border-box;\n                position: relative;\n                z-index: 4;\n                transition: all 0.3s;\n            }\n            \n            /* 实心节点 - 已办 */\n            .timeline-dot-filled {\n                background-color: var(--dot-color, #1890ff);\n                border-color: var(--dot-color, #1890ff);\n            }\n            \n            /* 空心节点 - 未办 */\n            .timeline-dot-outline {\n                background-color: white;\n                border-color: var(--dot-color, #d9d9d9);\n            }\n            \n            /* 旋转节点 - 待办 */\n            .timeline-dot-spinning {\n                background-color: white;\n                border-color: var(--dot-color, #1890ff);\n                border-top-color: transparent;\n                animation: spin 1s linear infinite;\n            }\n            \n            /* 圆角矩形节点 */\n            .timeline-dot-rounded-rect {\n                border-radius: 4px;\n            }\n            \n            /* 方形节点 */\n            .timeline-dot-square {\n                border-radius: 2px;\n            }\n            \n            /* 事件内容区域 */\n            .timeline-content {\n                position: relative;\n                color: rgba(0, 0, 0, 0.85);\n                line-height: 1.5;\n            }\n            \n            /* 垂直时间轴的内容位置 */\n            .timeline-vertical .timeline-content {\n                width: 45%;\n                padding: 0 16px;\n            }\n            \n            .timeline-vertical .timeline-item-left .timeline-content {\n                margin-left: 0;\n                margin-right: auto;\n                text-align: right;\n            }\n            \n            .timeline-vertical .timeline-item-right .timeline-content {\n                margin-left: auto;\n                margin-right: 0;\n                text-align: left;\n            }\n            \n            /* 交替布局 */\n            .timeline-position-alternate .timeline-vertical .timeline-item:nth-child(odd) .timeline-content {\n                margin-left: 0;\n                margin-right: auto;\n                text-align: right;\n            }\n            \n            .timeline-position-alternate .timeline-vertical .timeline-item:nth-child(even) .timeline-content {\n                margin-left: auto;\n                margin-right: 0;\n                text-align: left;\n            }\n            \n            /* 左侧布局 */\n            .timeline-position-left .timeline-vertical .timeline-content {\n                margin-left: 0;\n                margin-right: auto;\n                text-align: right;\n                width: calc(100% - 30px);\n            }\n            \n            /* 右侧布局 */\n            .timeline-position-right .timeline-vertical::before {\n                left: 30px;\n            }\n            \n            .timeline-position-right .timeline-vertical .timeline-dot-container {\n                left: 30px;\n            }\n            \n            .timeline-position-right .timeline-vertical .timeline-content {\n                margin-left: 60px;\n                margin-right: 0;\n                text-align: left;\n                width: calc(100% - 60px);\n            }\n            \n            /* 水平时间轴的内容位置 */\n            .timeline-horizontal .timeline-content {\n                margin-top: 30px;\n                text-align: center;\n                padding: 0 10px;\n            }\n            \n            .timeline-horizontal .timeline-item-top .timeline-content {\n                margin-top: -60px;\n                margin-bottom: auto;\n            }\n            \n            .timeline-horizontal .timeline-item-bottom .timeline-content {\n                margin-top: 30px;\n                margin-bottom: 0;\n            }\n            \n            /* 事件标题 */\n            .timeline-title {\n                font-weight: 500;\n                font-size: 14px;\n                margin-bottom: 4px;\n                color: rgba(0, 0, 0, 0.85);\n            }\n            \n            .timeline-title-clickable {\n                cursor: pointer;\n                transition: color 0.3s;\n            }\n            \n            .timeline-title-clickable:hover {\n                color: #1890ff;\n            }\n            \n            /* 事件描述 */\n            .timeline-description {\n                font-size: 13px;\n                color: rgba(0, 0, 0, 0.45);\n                margin-bottom: 8px;\n            }\n            \n            /* 事件时间 */\n            .timeline-time {\n                font-size: 12px;\n                color: rgba(0, 0, 0, 0.45);\n            }\n            \n            /* 自定义图标 */\n            .timeline-custom-dot {\n                width: var(--timeline-dot-size, 10px);\n                height: var(--timeline-dot-size, 10px);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: calc(var(--timeline-dot-size, 10px) - 4px);\n            }\n            \n            /* 图标节点 */\n            .timeline-dot-icon {\n                background-color: white;\n                border-color: var(--dot-color, #1890ff);\n            }\n            \n            /* 加载动画 */\n            @keyframes spin {\n                0% { transform: rotate(0deg); }\n                100% { transform: rotate(360deg); }\n            }\n            \n            .timeline-loading {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                width: calc(var(--timeline-dot-size, 10px) - 4px);\n                height: calc(var(--timeline-dot-size, 10px) - 4px);\n                margin: -8px 0 0 -8px;\n                border: var(--dot-border-width, 2px) solid #1890ff;\n                border-top-color: transparent;\n                border-radius: 50%;\n                animation: spin 1s linear infinite;\n            }\n            \n            /* 响应式设计 */\n            @media (max-width: 768px) {\n                .timeline-vertical::before {\n                    left: 20px;\n                }\n                \n                .timeline-vertical .timeline-dot-container {\n                    left: 20px;\n                }\n                \n                .timeline-vertical .timeline-content {\n                    width: calc(100% - 60px);\n                    margin-left: 60px !important;\n                    margin-right: 0 !important;\n                    text-align: left !important;\n                }\n                \n                .timeline-horizontal {\n                    flex-direction: column;\n                }\n                \n                .timeline-horizontal::before {\n                    left: 50%;\n                    top: 20px;\n                    width: 2px;\n                    height: calc(100% - 40px);\n                    transform: translateX(-50%);\n                }\n                \n                .timeline-horizontal .timeline-dot-container {\n                    left: 50%;\n                    top: 20px;\n                    transform: translateX(-50%);\n                }\n                \n                .timeline-horizontal .timeline-content {\n                    margin-left: 60px;\n                    margin-top: 0;\n                    text-align: left;\n                }\n            }\n            \n            /* 时间轴位置 */\n            .timeline-align-center {\n                margin-left: auto;\n                margin-right: auto;\n            }\n            \n            .timeline-align-left {\n                margin-right: auto;\n                margin-left: 0;\n            }\n            \n            .timeline-align-right {\n                margin-left: auto;\n                margin-right: 0;\n            }\n        ",document.head.appendChild(style)}setEvents(events){if(!Array.isArray(events))throw new Error("events参数必须是一个数组");return events.length>this.options.maxEvents&&(console.warn(`事件数量超过最大限制(${this.options.maxEvents})`),events=events.slice(0,this.options.maxEvents)),this.events=events.map((event,index)=>({...event,id:event.id||`timeline-event-${Date.now()}-${index}`,color:event.color||"#1890ff",status:event.status||"incomplete",dotStyle:event.dotStyle||"circle",completedStyle:event.completedStyle||this.options.completedStyle,incompleteStyle:event.incompleteStyle||this.options.incompleteStyle,pendingStyle:event.pendingStyle||this.options.pendingStyle})),this.options.reverse&&this.events.reverse(),this.render(),this}render(){this.container.innerHTML="";const timelineContainer=document.createElement("div");timelineContainer.className="timeline-container";const timeline=document.createElement("ul");if(timeline.className=`timeline timeline-${this.options.mode} timeline-position-${this.options.position} timeline-align-${this.options.timelinePosition}`,timeline.style.setProperty("--timeline-line-color",this.options.lineColor),timeline.style.setProperty("--timeline-line-width",`${this.options.lineWidth}px`),timeline.style.setProperty("--timeline-dot-size",`${this.options.dotSize}px`),timeline.style.setProperty("--dot-border-width",`${this.options.dotBorderWidth}px`),this.events.forEach((event,index)=>{const eventElement=this._createEventElement(event,index);timeline.appendChild(eventElement)}),this.options.pending){const pendingElement=this._createPendingElement();timeline.appendChild(pendingElement)}return timelineContainer.appendChild(timeline),this.container.appendChild(timelineContainer),this.options.animation&&this._animateEvents(),this}_createEventElement(event,index){const item=document.createElement("li");item.className=`timeline-item timeline-item-${this.options.mode} ${this._getItemPositionClass(index)}`,item.dataset.eventId=event.id;const dotContainer=document.createElement("div");dotContainer.className="timeline-dot-container";const dot=this._createEventDot(event);dotContainer.appendChild(dot);const content=this._createEventContent(event);return item.appendChild(dotContainer),item.appendChild(content),this.options.clickable&&(event.onClick||this._eventHandlers.has(event.id))&&(item.style.cursor="pointer",item.addEventListener("click",e=>{e.stopPropagation(),this._handleEventClick(event,e)})),this.options.showTooltips&&event.tooltip&&this._addTooltip(item,event.tooltip),item}_createEventDot(event){const dot=document.createElement("div");let dotClass="timeline-dot";if(event.icon){dotClass+=" timeline-dot-icon";const customDot=document.createElement("div");customDot.className="timeline-custom-dot",customDot.innerHTML=event.icon,dot.appendChild(customDot)}else{let styleClass="";switch(event.status){case"completed":styleClass=event.completedStyle||this.options.completedStyle;break;case"incomplete":styleClass=event.incompleteStyle||this.options.incompleteStyle;break;case"pending":styleClass=event.pendingStyle||this.options.pendingStyle;break;default:styleClass="outline"}dotClass+=` timeline-dot-${styleClass}`}return dotClass+=` timeline-dot-${event.dotStyle||"circle"}`,dot.className=dotClass,dot.style.setProperty("--dot-color",event.color||"#1890ff"),dot}_createEventContent(event){const content=document.createElement("div");if(content.className="timeline-content",event.title){const title=document.createElement("div");title.className="timeline-title",event.onTitleClick&&(title.classList.add("timeline-title-clickable"),title.addEventListener("click",e=>{e.stopPropagation(),event.onTitleClick(event,e)})),title.textContent=event.title,content.appendChild(title)}if(event.description){const description=document.createElement("div");description.className="timeline-description",description.textContent=event.description,content.appendChild(description)}if(event.time){const time=document.createElement("div");time.className="timeline-time",time.textContent=this._formatDate(event.time),content.appendChild(time)}if(event.content)if("string"==typeof event.content){const customContent=document.createElement("div");customContent.innerHTML=event.content,content.appendChild(customContent)}else content.appendChild(event.content);return content}_getItemPositionClass(index){const{mode:mode,position:position}=this.options;return"vertical"===mode?"alternate"===position?index%2==0?"left":"right":position:"alternate"===position?index%2==0?"top":"bottom":position}_createPendingElement(){const item=document.createElement("li");item.className=`timeline-item timeline-item-${this.options.mode} timeline-item-pending`;const dotContainer=document.createElement("div");dotContainer.className="timeline-dot-container";const dot=document.createElement("div");dot.className="timeline-dot timeline-dot-spinning",dot.style.setProperty("--dot-color","#1890ff"),dotContainer.appendChild(dot);const content=document.createElement("div");return content.className="timeline-content","string"==typeof this.options.pending?content.textContent=this.options.pending:content.appendChild(this.options.pending),item.appendChild(dotContainer),item.appendChild(content),item}_formatDate(dateInput){if(!dateInput)return"";let date;if("string"==typeof dateInput)date=new Date(dateInput);else{if(!(dateInput instanceof Date))return String(dateInput);date=dateInput}if(isNaN(date.getTime()))return"无效日期";const format=this.options.dateFormat;if("relative"===format)return this._getRelativeTime(date);const year=date.getFullYear(),month=String(date.getMonth()+1).padStart(2,"0"),day=String(date.getDate()).padStart(2,"0"),hours=String(date.getHours()).padStart(2,"0"),minutes=String(date.getMinutes()).padStart(2,"0"),seconds=String(date.getSeconds()).padStart(2,"0");switch(format){case"YYYY-MM-DD":return`${year}-${month}-${day}`;case"MM/DD/YYYY":return`${month}/${day}/${year}`;case"DD/MM/YYYY":return`${day}/${month}/${year}`;case"YYYY年MM月DD日":return`${year}年${month}月${day}日`;case"YYYY-MM-DD HH:mm":return`${year}-${month}-${day} ${hours}:${minutes}`;case"YYYY-MM-DD HH:mm:ss":return`${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;case"MM/DD/YYYY HH:mm":return`${month}/${day}/${year} ${hours}:${minutes}`;case"HH:mm":return`${hours}:${minutes}`;default:return format.replace("YYYY",year).replace("MM",month).replace("DD",day).replace("HH",hours).replace("mm",minutes).replace("ss",seconds)}}_getRelativeTime(date){const diffMs=new Date-date,diffDays=Math.floor(diffMs/864e5);if(0===diffDays){const diffHours=Math.floor(diffMs/36e5);if(diffHours>0)return`${diffHours}小时前`;const diffMinutes=Math.floor(diffMs/6e4);return diffMinutes>0?`${diffMinutes}分钟前`:"刚刚"}return 1===diffDays?"昨天":diffDays>0?`${diffDays}天前`:""}_handleEventClick(event,e){event.onClick&&event.onClick(event,e);const handler=this._eventHandlers.get(event.id);handler&&handler(event,e)}_addTooltip(element,text){element.addEventListener("mouseenter",e=>{this.tooltip.textContent=text,this.tooltip.style.opacity="1";const rect=element.getBoundingClientRect(),scrollTop=window.pageYOffset||document.documentElement.scrollTop;this.tooltip.style.top=rect.top+scrollTop-this.tooltip.offsetHeight-10+"px",this.tooltip.style.left=rect.left+rect.width/2-this.tooltip.offsetWidth/2+"px"}),element.addEventListener("mouseleave",()=>{this.tooltip.style.opacity="0"})}_animateEvents(){this.container.querySelectorAll(".timeline-item").forEach((item,index)=>{item.style.opacity="0",item.style.transform="translateY(10px)",setTimeout(()=>{item.style.transition="opacity 0.3s, transform 0.3s",item.style.opacity="1",item.style.transform="translateY(0)"},100*index)})}addEvent(event,onClick=null){if(this.events.length>=this.options.maxEvents)return console.warn(`已达到最大事件数量(${this.options.maxEvents})`),null;const newEvent={...event,id:event.id||`timeline-event-${Date.now()}-${this.events.length}`,color:event.color||"#1890ff",status:event.status||"incomplete",dotStyle:event.dotStyle||"circle",completedStyle:event.completedStyle||this.options.completedStyle,incompleteStyle:event.incompleteStyle||this.options.incompleteStyle,pendingStyle:event.pendingStyle||this.options.pendingStyle};return this.events.push(newEvent),onClick&&this._eventHandlers.set(newEvent.id,onClick),this.render(),newEvent.id}updateEventStatus(eventId,status){const eventIndex=this.events.findIndex(e=>e.id===eventId);return-1!==eventIndex&&(this.events[eventIndex].status=status,this.render()),this}updateEvent(eventId,eventData){const eventIndex=this.events.findIndex(e=>e.id===eventId);return-1!==eventIndex&&(this.events[eventIndex]={...this.events[eventIndex],...eventData,id:eventId},this.render()),this}removeEvent(eventId){const eventIndex=this.events.findIndex(e=>e.id===eventId);return-1!==eventIndex&&(this.events.splice(eventIndex,1),this._eventHandlers.delete(eventId),this.render()),this}onEventClick(eventId,handler){return this._eventHandlers.set(eventId,handler),this}updateOptions(options){return this.options={...this.options,...options},this.render(),this}clear(){return this.events=[],this._eventHandlers.clear(),this.render(),this}destroy(){return this.tooltip&&this.tooltip.parentNode&&this.tooltip.parentNode.removeChild(this.tooltip),this.container.innerHTML="",this.events=[],this._eventHandlers.clear(),this._initialized=!1,this}getEvents(){return[...this.events]}getEvent(eventId){return this.events.find(event=>event.id===eventId)||null}getOptions(){return{...this.options}}isInitialized(){return this._initialized}}class NGTreeExpandPanel{constructor(options={}){this.config={defaultLevels:5,maxCustomLevel:25,toolbarSelector:"div.udp-panel-title#_rq_",containerSelector:".row-hover.rows-container.editable",animationDelay:100,position:{index:0,side:"after"},margin:{left:"0 1% 0 1%",right:""},defaultState:"expanded",defaultLevel:1,...options},this.config.position={index:0,side:"after",...this.config.position},this.config.margin={left:"0 1% 0 1%",right:"",...this.config.margin},this.state={isExpanded:!1,currentLevel:this.config.defaultLevel},this.elements={panel:null,panelBody:null,levelInput:null,expandBtn:null,buttons:[]},this.init()}init(){this.toolbarDiv=document.querySelector(this.config.toolbarSelector),this.toolbarDiv?(this.createPanel(),this.bindEvents(),this.initializeDefaultState()):console.error(`未找到工具栏容器: ${this.config.toolbarSelector}`)}createPanel(){const panel=document.createElement("div");panel.className="x-panel x-box-item x-panel-default",panel.id="tree-expand-panel";const marginStyle=`${this.config.margin.left} ${this.config.margin.right}`.trim();panel.style.cssText=`\n      margin: ${marginStyle};\n      height: 40px;\n      width: auto;\n      min-width: ${480+40*(this.config.defaultLevels-5)}px;\n      background: #f8f9fa;\n      border-radius: 4px;\n      box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n      border: 1px solid #d1d7dc;\n      overflow: hidden;\n      display: inline-flex;\n      align-items: center;\n      padding: 0 15px;\n    `;const levelLabel=document.createElement("span");levelLabel.textContent="层级",levelLabel.style.cssText='\n      font-family: "Microsoft YaHei", sans-serif;\n      font-size: 14px;\n      color: #333;\n      margin-right: 10px;\n      white-space: nowrap;\n    ',panel.appendChild(levelLabel);const panelBody=document.createElement("div");panelBody.id="tree-expand-panel-body",panelBody.style.cssText="\n      height: 100%;\n      display: flex;\n      align-items: center;\n      position: relative;\n    ",this.createLevelButtons(panelBody),this.createExpandButton(panelBody),this.createSeparator(panelBody),this.createToButton(panelBody),this.createLevelInput(panelBody),this.createLayerLabel(panelBody),panel.appendChild(panelBody),this.insertPanel(panel),this.elements.panel=panel,this.elements.panelBody=panelBody}createLevelButtons(container){for(let i=1;i<=this.config.defaultLevels;i++){const button=this.createButton(`level-btn-${i}`,i.toString(),40*(i-1),i);this.elements.buttons.push(button),container.appendChild(button)}}createButton(id,text,left,level){const btn=document.createElement("div");btn.className="x-btn x-box-item",btn.id=id,btn.style.cssText=`\n      position: absolute;\n      left: ${left}px;\n      height: 30px;\n      width: 30px;\n      background: #fff;\n      border-radius: 4px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      box-shadow: 0 1px 2px rgba(0,0,0,0.1);\n      border: 1px solid #d1d7dc;\n      user-select: none;\n      font-family: "Microsoft YaHei", sans-serif;\n    `,btn.onmouseenter=()=>{btn.style.background="#f0f5ff",btn.style.borderColor="#409eff"},btn.onmouseleave=()=>{btn.style.background="#fff",btn.style.borderColor="#d1d7dc"},btn.onmousedown=()=>{btn.style.transform="translateY(1px)"},btn.onmouseup=()=>{btn.style.transform="translateY(0)"};const btnInner=document.createElement("span");return btnInner.textContent=text,btnInner.style.cssText="\n      font-size: 14px;\n      color: #333;\n    ",btn.appendChild(btnInner),btn.addEventListener("click",()=>{this.onLevelButtonClick(level)}),btn}createExpandButton(container){const expandBtnLeft=40*this.config.defaultLevels,expandBtn=this.createButton("expandAllTreeBtn","展开",expandBtnLeft,0);expandBtn.style.width="50px",expandBtn.style.background="#409eff",expandBtn.style.color="#fff",expandBtn.style.borderColor="#409eff",expandBtn.firstChild.style.color="#fff",expandBtn.onmouseenter=()=>{expandBtn.style.background="#66b1ff",expandBtn.style.borderColor="#66b1ff"},expandBtn.onmouseleave=()=>{expandBtn.style.background="#409eff",expandBtn.style.borderColor="#409eff"},expandBtn.addEventListener("click",()=>{this.onExpandButtonClick()}),container.appendChild(expandBtn),this.elements.expandBtn=expandBtn}createSeparator(container){const separatorLeft=40*this.config.defaultLevels+70,separator=document.createElement("div");separator.style.cssText=`\n      position: absolute;\n      left: ${separatorLeft}px;\n      height: 25px;\n      width: 1px;\n      background-color: #d1d7dc;\n      margin: 0 2%;\n    `,container.appendChild(separator)}createToButton(container){const toButtonLeft=40*this.config.defaultLevels+70+20,toButton=document.createElement("div");toButton.className="x-btn x-box-item",toButton.id="toButton",toButton.textContent="To",toButton.style.cssText=`\n      position: absolute;\n      left: ${toButtonLeft}px;\n      height: 30px;\n      width: 40px;\n      background: #409eff;\n      border-radius: 4px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      border: 1px solid #409eff;\n      user-select: none;\n      font-family: "Microsoft YaHei", sans-serif;\n      color: #fff;\n    `,toButton.onmouseenter=()=>{toButton.style.background="#66b1ff",toButton.style.borderColor="#66b1ff"},toButton.onmouseleave=()=>{toButton.style.background="#409eff",toButton.style.borderColor="#409eff"},toButton.onmousedown=()=>{toButton.style.transform="translateY(1px)"},toButton.onmouseup=()=>{toButton.style.transform="translateY(0)"},toButton.addEventListener("click",()=>{this.onToButtonClick()}),container.appendChild(toButton)}createLevelInput(container){const inputLeft=40*this.config.defaultLevels+70+20+50,levelInput=document.createElement("input");levelInput.type="text",levelInput.id="levelInput",levelInput.placeholder=`${this.config.defaultLevels+1}-${this.config.maxCustomLevel}`,levelInput.style.cssText=`\n      position: absolute;\n      left: ${inputLeft}px;\n      width: 50px;\n      height: 26px;\n      border: 1px solid #d1d7dc;\n      border-radius: 4px;\n      padding: 0 5px;\n      font-family: "Microsoft YaHei", sans-serif;\n      font-size: 14px;\n    `,levelInput.addEventListener("input",e=>{e.target.value=e.target.value.replace(/[^0-9]/g,"")}),container.appendChild(levelInput),this.elements.levelInput=levelInput}createLayerLabel(container){const labelLeft=40*this.config.defaultLevels+70+20+50+60,layerLabel=document.createElement("span");layerLabel.textContent="层",layerLabel.style.cssText=`\n      position: absolute;\n      left: ${labelLeft}px;\n      font-family: "Microsoft YaHei", sans-serif;\n      font-size: 14px;\n      color: #333;\n      margin-right: 5px;\n      white-space: nowrap;\n    `,container.appendChild(layerLabel)}insertPanel(panel){const children=this.toolbarDiv.children,targetIndex=Math.min(this.config.position.index,children.length);"before"===this.config.position.side?0===targetIndex?this.toolbarDiv.insertBefore(panel,this.toolbarDiv.firstChild):targetIndex<children.length?this.toolbarDiv.insertBefore(panel,children[targetIndex]):this.toolbarDiv.appendChild(panel):targetIndex>=children.length?this.toolbarDiv.appendChild(panel):this.toolbarDiv.insertBefore(panel,children[targetIndex+1])}bindEvents(){}onLevelButtonClick(level){console.log(`点击了层级按钮: ${level}`),this.state.currentLevel=level,console.log("当前层级状态:",this.state),1==level?this.collapseAll():this.expandToLevel(level-1)}onExpandButtonClick(){this.state.isExpanded=!this.state.isExpanded,this.state.isExpanded?(this.elements.expandBtn.firstChild.textContent="收起",console.log("执行了展开操作"),this.expandAll()):(this.elements.expandBtn.firstChild.textContent="展开",console.log("执行了收起操作"),this.collapseAll()),console.log("当前展开状态:",this.state.isExpanded)}onToButtonClick(){const inputValue=this.elements.levelInput.value;if(!inputValue)return void this.showToast("请输入层级数字");const level=parseInt(inputValue);if(level<this.config.defaultLevels+1||level>this.config.maxCustomLevel)return void this.showToast(`请输入${this.config.defaultLevels+1}到${this.config.maxCustomLevel}之间的数字`);const actualLevel=level-1;console.log(`展开到自定义层级: ${level} (实际参数: ${actualLevel})`),this.expandToLevel(actualLevel)}expandToLevel(level=0){if(level<=0)return;const collapseRecursive=callback=>{const container=document.querySelector(this.config.containerSelector);if(!container)return void console.log("未找到容器");const elements=container.querySelectorAll(".udp-row-expand-icon.udp-row-expand-icon-expanded");elements.length>0?(console.log(`找到 ${elements.length} 个展开元素，正在收起...`),elements.forEach(el=>el.click()),setTimeout(()=>collapseRecursive(callback),this.config.animationDelay)):(console.log("所有元素已收起"),callback&&callback())},startLevelExpansion=(currentLevel=0)=>{if(currentLevel>=level)return void console.log(`已展开到第 ${level} 层，停止`);const container=document.querySelector(this.config.containerSelector);if(!container)return void console.log("未找到容器");const elements=container.querySelectorAll(".udp-row-expand-icon.udp-row-expand-icon-collapsed");elements.length>0?(console.log(`展开第 ${currentLevel+1} 层，找到 ${elements.length} 个元素`),elements.forEach(el=>el.click()),setTimeout(()=>startLevelExpansion(currentLevel+1),this.config.animationDelay)):console.log(`第 ${currentLevel+1} 层无更多可展开元素，提前终止`)};collapseRecursive(()=>startLevelExpansion())}expandAll(){const container=document.querySelector(this.config.containerSelector);if(!container)return void console.log("未找到容器");const elements=container.querySelectorAll(".udp-row-expand-icon.udp-row-expand-icon-collapsed");elements.length>0?(console.log(`找到 ${elements.length} 个折叠元素，正在展开...`),elements.forEach(el=>el.click()),setTimeout(()=>this.expandAll(),this.config.animationDelay)):console.log("所有元素已展开")}collapseAll(){const container=document.querySelector(this.config.containerSelector);if(!container)return void console.log("未找到容器");const elements=container.querySelectorAll(".udp-row-expand-icon.udp-row-expand-icon-expanded");elements.length>0?(console.log(`找到 ${elements.length} 个展开元素，正在收起...`),elements.forEach(el=>el.click()),setTimeout(()=>this.collapseAll(),this.config.animationDelay)):console.log("所有元素已收起")}initializeDefaultState(){console.log(`初始化默认状态: ${this.config.defaultState}, 层级: ${this.config.defaultLevel}`),setTimeout(()=>{switch(this.config.defaultState){case"collapsed":this.collapseAll(),this.state.isExpanded=!1,this.elements.expandBtn.firstChild.textContent="展开",this.state.currentLevel=1;break;case"level":this.config.defaultLevel>=1&&this.config.defaultLevel<=this.config.defaultLevels?(1===this.config.defaultLevel?(this.collapseAll(),this.state.currentLevel=1):(this.expandToLevel(this.config.defaultLevel-1),this.state.currentLevel=this.config.defaultLevel),this.state.isExpanded=this.config.defaultLevel>1,this.elements.expandBtn.firstChild.textContent=this.state.isExpanded?"收起":"展开"):(console.warn(`默认层级 ${this.config.defaultLevel} 超出范围，使用层级1`),this.collapseAll(),this.state.currentLevel=1,this.state.isExpanded=!1,this.elements.expandBtn.firstChild.textContent="展开");break;default:this.expandAll(),this.state.isExpanded=!0,this.elements.expandBtn.firstChild.textContent="收起",this.state.currentLevel=this.config.defaultLevels}},100)}showToast(message){console.log("提示:",message),alert(message)}setState(state,level){switch(state){case"collapsed":this.collapseAll(),this.state.isExpanded=!1,this.elements.expandBtn.firstChild.textContent="展开",this.state.currentLevel=1;break;case"level":level&&level>=1&&level<=this.config.maxCustomLevel&&(1===level?this.collapseAll():this.expandToLevel(level-1),this.state.currentLevel=level,this.state.isExpanded=level>1,this.elements.expandBtn.firstChild.textContent=this.state.isExpanded?"收起":"展开");break;case"expanded":this.expandAll(),this.state.isExpanded=!0,this.elements.expandBtn.firstChild.textContent="收起",this.state.currentLevel=this.config.defaultLevels}}updateOptions(newOptions){this.destroy(),this.config={...this.config,...newOptions},this.init()}destroy(){this.elements.panel&&this.elements.panel.parentNode&&this.elements.panel.parentNode.removeChild(this.elements.panel),this.elements={panel:null,panelBody:null,levelInput:null,expandBtn:null,buttons:[]},this.toolbarDiv=null}}const NGTreeExpandPanelExample={basic:function(options={}){return new NGTreeExpandPanel({defaultLevels:5,toolbarSelector:"div.udp-panel-title#_rq_",containerSelector:".row-hover.rows-container.editable",defaultState:"expanded",...options})},customLevels:function(options={}){return new NGTreeExpandPanel({defaultLevels:7,maxCustomLevel:30,toolbarSelector:"div.udp-panel-title#_rq_",containerSelector:".row-hover.rows-container.editable",defaultState:"level",defaultLevel:2,...options})},customSelectors:function(toolbarSelector,containerSelector,options={}){return new NGTreeExpandPanel({...{defaultLevels:5,toolbarSelector:toolbarSelector||"div.udp-panel-title#_rq_",containerSelector:containerSelector||".row-hover.rows-container.editable",defaultState:"collapsed"},...options})}};"undefined"!=typeof module&&module.exports&&(module.exports={NGTreeExpandPanel:NGTreeExpandPanel,NGTreeExpandPanelExample:NGTreeExpandPanelExample}),"undefined"!=typeof window&&(window.NGTreeExpandPanel=NGTreeExpandPanel,window.NGTreeExpandPanelExample=NGTreeExpandPanelExample);