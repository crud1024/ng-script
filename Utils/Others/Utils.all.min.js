(function(){
"use strict";
var __modules = {};
__modules["./ListToLayer/V1/ListToLayer.js"] = function(module, exports, require){

function ListToLayer(list, options = {}) {

const defaultOptions = {
idKey: "s_tree_id",
parentKey: "s_tree_pid",
childrenKey: "children",
fieldMapping: null,
};


const config = { ...defaultOptions, ...options };
const { idKey, parentKey, childrenKey, fieldMapping } = config;


if (!list || !Array.isArray(list) || list.length === 0) {
return [];
}


const mapFields = (node) => {
if (!fieldMapping) return { ...node };

const mappedNode = {};


const specialKeys = [childrenKey];


Object.keys(node).forEach((key) => {

if (fieldMapping[key] !== undefined) {
mappedNode[fieldMapping[key]] = node[key];
}

else if (!specialKeys.includes(key)) {
mappedNode[key] = node[key];
}
});

return mappedNode;
};


const nodeMap = list.reduce((acc, node) => {
const mappedNode = mapFields(node);
const nodeId = node[idKey];


if (nodeId !== undefined && nodeId !== null) {
acc[nodeId] = {
...mappedNode,
[childrenKey]: [],
};
}
return acc;
}, {});


const roots = [];


list.forEach((node) => {
const currentNode = nodeMap[node[idKey]];
const parentId = node[parentKey];


if (!currentNode) return;


if (parentId !== undefined && parentId !== null && nodeMap[parentId]) {

nodeMap[parentId][childrenKey].push(currentNode);
} else {

roots.push(currentNode);
}
});

return roots;
}

};
__modules["./OrgOrProJectTreeEventBinder/V1/OrgOrProJectTreeEventBinder.js"] = function(module, exports, require){

class TreeCodeEventBinder {

constructor(options = {}) {
this.options = {
treeContainerSelector: ".ant-tree-list-holder-inner",
retryDelay: 1000,
...options,
};

this.observer = null;
this.isInitialized = false;
}


static extractNumberCodeFromTitle(title) {
if (!title) return null;
const match = title.match(/\[(\d+)\]/);
return match ? match[1] : null;
}


static extractIdentifierCodeFromTitle(title) {
if (!title) return null;


const pattern1 = /([A-Za-z]+)-([A-Za-z]+)-(\d+)/;


const pattern2 = /([A-Za-z]+)-(\d+)-(\d+)/;


const pattern3 = /([A-Za-z0-9]+(?:-[A-Za-z0-9]+){2,})/;


let match = title.match(pattern1);
if (match) {
return match[0];
}

match = title.match(pattern2);
if (match) {
return match[0];
}


match = title.match(pattern3);
if (match) {

const parts = match[0].split("-");
if (parts.length >= 3) {
return match[0];
}
}

return null;
}


_addTreeItemClickEvents() {
const treeContainer = document.querySelector(
this.options.treeContainerSelector
);

if (!treeContainer) {
console.warn(`未找到树容器: ${this.options.treeContainerSelector}`);
setTimeout(() => this._addTreeItemClickEvents(), this.options.retryDelay);
return;
}

const treeItems = treeContainer.querySelectorAll('div[role="treeitem"]');

if (treeItems.length === 0) {
console.warn("树容器中没有找到树节点");
setTimeout(() => this._addTreeItemClickEvents(), this.options.retryDelay);
return;
}

treeItems.forEach((treeItem, index) => {
if (treeItem.hasAttribute("data-code-event-added")) {
return;
}

treeItem.setAttribute("data-code-event-added", "true");
const originalClickHandler = treeItem.onclick;

treeItem.addEventListener("click", (event) => {
this._handleTreeItemClick(treeItem, index, originalClickHandler, event);
});
});

console.log(`成功为 ${treeItems.length} 个树节点绑定了事件`);
}


_handleTreeItemClick(treeItem, index, originalClickHandler, event) {
console.log(`点击了树节点 ${index + 1}`);

const spans = treeItem.querySelectorAll("span");
let foundNumberCode = null;
let foundIdentifierCode = null;

for (let span of spans) {
const title = span.getAttribute("title");
if (title) {

if (!foundNumberCode) {
foundNumberCode =
TreeCodeEventBinder.extractNumberCodeFromTitle(title);
if (foundNumberCode) {
this._triggerNumberCodeEvent(foundNumberCode, title);
}
}


if (!foundIdentifierCode) {
foundIdentifierCode =
TreeCodeEventBinder.extractIdentifierCodeFromTitle(title);
if (foundIdentifierCode) {
this._triggerIdentifierCodeEvent(foundIdentifierCode, title);
}
}


if (foundNumberCode && foundIdentifierCode) {
break;
}
}
}


this._logExtractionResult(foundNumberCode, foundIdentifierCode);


if (originalClickHandler) {
try {
originalClickHandler.call(treeItem, event);
} catch (e) {
console.error("执行原有点击事件时出错:", e);
}
}
}


_triggerNumberCodeEvent(numberCode, sourceTitle) {
console.log(`提取到数字编码: ${numberCode} (来自title: "${sourceTitle}")`);

if (typeof this.options.onNumberCodeExtracted === "function") {
this.options.onNumberCodeExtracted(numberCode, sourceTitle);
}
}


_triggerIdentifierCodeEvent(identifierCode, sourceTitle) {
console.log(
`提取到标识符编码: ${identifierCode} (来自title: "${sourceTitle}")`
);

if (typeof this.options.onIdentifierCodeExtracted === "function") {
this.options.onIdentifierCodeExtracted(identifierCode, sourceTitle);
}
}


_logExtractionResult(foundNumberCode, foundIdentifierCode) {
if (!foundNumberCode && !foundIdentifierCode) {
console.log("未找到任何编码格式");
} else if (!foundNumberCode) {
console.log("未找到数字编码，但找到了标识符编码");
} else if (!foundIdentifierCode) {
console.log("未找到标识符编码，但找到了数字编码");
}
}


_observeTreeChanges() {
if (this.observer) {
this.observer.disconnect();
}

this.observer = new MutationObserver((mutations) => {
mutations.forEach((mutation) => {
if (mutation.type === "childList" && mutation.addedNodes.length > 0) {
let hasTreeItems = false;
mutation.addedNodes.forEach((node) => {
if (node.nodeType === 1) {
if (node.matches && node.matches('div[role="treeitem"]')) {
hasTreeItems = true;
}
if (
node.querySelector &&
node.querySelector('div[role="treeitem"]')
) {
hasTreeItems = true;
}
}
});

if (hasTreeItems) {
setTimeout(() => this._addTreeItemClickEvents(), 100);
}
}
});
});

this.observer.observe(document.body, {
childList: true,
subtree: true,
});
}


init() {
if (this.isInitialized) {
console.warn("TreeCodeEventBinder 已经初始化过了");
return;
}

setTimeout(() => {
this._addTreeItemClickEvents();
this._observeTreeChanges();
this.isInitialized = true;
console.log("TreeCodeEventBinder 初始化完成");
}, 500);
}


destroy() {
if (this.observer) {
this.observer.disconnect();
this.observer = null;
}


const treeContainer = document.querySelector(
this.options.treeContainerSelector
);
if (treeContainer) {
const treeItems = treeContainer.querySelectorAll(
'div[role="treeitem"][data-code-event-added]'
);
treeItems.forEach((item) => {
item.removeAttribute("data-code-event-added");
item.onclick = null;
});
}

this.isInitialized = false;
console.log("TreeCodeEventBinder 已销毁");
}


rebind() {
this.destroy();
this.init();
}


triggerNumberCodeEvent(code) {
if (typeof this.options.onNumberCodeExtracted === "function") {
this.options.onNumberCodeExtracted(code, "手动触发");
}
}


triggerIdentifierCodeEvent(code) {
if (typeof this.options.onIdentifierCodeExtracted === "function") {
this.options.onIdentifierCodeExtracted(code, "手动触发");
}
}
}


if (typeof module !== "undefined" && module.exports) {
module.exports = TreeCodeEventBinder;
} else if (typeof define === "function" && define.amd) {
define("TreeCodeEventBinder", [], () => TreeCodeEventBinder);
} else {
window.TreeCodeEventBinder = TreeCodeEventBinder;
}

};

var __cache = {};
function __require(id){ if(__cache[id]) return __cache[id].exports; var module = {exports:{}}; __cache[id]=module; __modules[id](module, module.exports, __require); return module.exports; }
var G = (typeof window!=="undefined"?window:(typeof globalThis!=="undefined"?globalThis:global));
G.NG = G.NG || {}; G.NG.Utils = G.NG.Utils || {};
G.NG.Utils["ListToLayer/V1/ListToLayer"] = __require("./ListToLayer/V1/ListToLayer.js");
G.NG.Utils["OrgOrProJectTreeEventBinder/V1/OrgOrProJectTreeEventBinder"] = __require("./OrgOrProJectTreeEventBinder/V1/OrgOrProJectTreeEventBinder.js");

})();